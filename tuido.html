<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃºi Äá»“ NhÃ  ThÃ¡m Hiá»ƒm - EduRobot</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #FF9800; --gold: #FFD700; --bg-dark: #1a1a1a; }
        body { margin: 0; padding: 0; font-family: 'Lexend', sans-serif; background-color: var(--bg-dark); color: white; min-height: 100vh; display: flex; flex-direction: column; }
        .container { padding: 20px; max-width: 900px; margin: auto; flex: 1; width: 95%; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .header h1 { font-family: 'Bungee'; color: var(--gold); margin: 0; font-size: 1.8rem; text-shadow: 2px 2px #000; }
        
        .medal-section { display: flex; justify-content: space-around; background: #2c2c2c; padding: 20px; border-radius: 20px; margin-bottom: 30px; border: 1px solid #444; box-shadow: inset 0 0 10px #000; }
        .medal-item { text-align: center; }
        .medal-icon { font-size: 2.5rem; display: block; filter: drop-shadow(0 0 5px rgba(255,215,0,0.3)); }
        .medal-count { font-size: 1.8rem; font-weight: bold; color: var(--gold); }
        .medal-label { font-size: 0.8rem; color: #aaa; text-transform: uppercase; }

        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; margin-top: 20px; }
        .item-card { background: #2c2c2c; border-radius: 15px; padding: 15px; text-align: center; border: 2px solid #333; transition: 0.3s; filter: grayscale(100%); opacity: 0.4; position: relative; }
        
        .item-card.unlocked { filter: grayscale(0%); opacity: 1; border-color: var(--primary); background: radial-gradient(circle, #444 0%, #2c2c2c 100%); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .item-card.unlocked:hover { transform: translateY(-5px); border-color: var(--gold); }
        
        .item-card .icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .item-card .name { font-size: 0.85rem; font-weight: bold; height: 40px; display: flex; align-items: center; justify-content: center; line-height: 1.2; }
        .item-card .status { font-size: 0.75rem; color: var(--primary); font-weight: bold; margin-top: 5px; }
        
        .section-title { color: var(--primary); font-family: 'Bungee'; font-size: 1.1rem; margin-top: 30px; border-left: 5px solid var(--primary); padding-left: 10px; margin-bottom: 15px; }
        .btn-back { display: inline-block; margin: 30px 0; background: var(--primary); color: black; text-decoration: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1rem; transition: 0.3s; box-shadow: 0 4px 0 #bf7100; }
        .btn-back:hover { background: var(--gold); transform: translateY(-2px); box-shadow: 0 6px 0 #d4af37; }
        .btn-back:active { transform: translateY(2px); box-shadow: 0 0 0; }
        
        .game-footer { background: #111; padding: 20px; text-align: center; border-top: 4px solid var(--primary); color: #888; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>TÃšI Äá»’ NHÃ€ THÃM HIá»‚M</h1>
        <p>ğŸ‘¤ NhÃ  thÃ¡m hiá»ƒm: <span id="student-name" style="color:var(--gold); font-weight: bold;">Äang káº¿t ná»‘i...</span></p>
    </div>

    <div class="medal-section">
        <div class="medal-item"><span class="medal-icon">ğŸ¥‡</span><div id="gold-count" class="medal-count">0</div><div class="medal-label">VÃ ng</div></div>
        <div class="medal-item"><span class="medal-icon">ğŸ¥ˆ</span><div id="silver-count" class="medal-count">0</div><div class="medal-label">Báº¡c</div></div>
        <div class="medal-item"><span class="medal-icon">ğŸ¥‰</span><div id="bronze-count" class="medal-count">0</div><div class="medal-label">Äá»“ng</div></div>
    </div>

    <div class="section-title">ğŸ’ Váº¬T PHáº¨M ÄÃƒ THU THáº¬P</div>
    <div class="item-grid" id="item-list">
        </div>

    <center><a href="index.html" class="btn-back">QUAY Láº I Báº¢N Äá»’</a></center>
</div>

<footer class="game-footer">
    <div>Â© 2026 EduRobot - Há»‡ thá»‘ng Há»c táº­p ThÃ´ng minh</div>
    <div style="font-size: 0.7rem; margin-top: 5px;">GiÃ¡o viÃªn: LÃª ThÃ nh Long</div>
</footer>

<script>
    // 1. Cáº¥u hÃ¬nh Firebase
    const firebaseConfig = {
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. Danh sÃ¡ch váº­t pháº©m toÃ n bá»™ tá»« tuáº§n 19-35
    const ITEMS_DATA = {
        19: { name: "á»ng nhÃ²m LÅ©ng CÃº", icon: "ğŸ”­", deadline: "2026-01-18" },
        20: { name: "CÃ¢n tiá»ƒu ly", icon: "âš–ï¸", deadline: "2026-01-25" },
        21: { name: "MÃ¡y tÃ­nh bá» tÃºi", icon: "ğŸ“Ÿ", deadline: "2026-02-01" },
        22: { name: "Báº£n Ä‘á»“ Thá»§ Ä‘Ã´", icon: "ğŸ—ºï¸", deadline: "2026-02-08" },
        23: { name: "ThÆ°á»›c cuá»™n", icon: "ğŸ“", deadline: "2026-02-15" },
        24: { name: "MÅ© báº£o há»™", icon: "ğŸ—ï¸", deadline: "2026-02-22" },
        25: { name: "QuÃ  cá»‘ Ä‘Ã´ Huáº¿", icon: "ğŸ", deadline: "2026-03-01" },
        26: { name: "Äá»“ng há»“ cÃ¡t", icon: "â³", deadline: "2026-03-08" },
        27: { name: "Com-pa báº¡c", icon: "ğŸ“", deadline: "2026-03-15" },
        28: { name: "BÃ¡nh lÃ¡i tÃ u", icon: "ğŸ¡", deadline: "2026-03-22" },
        29: { name: "ÄÃ¨n pin hang Ä‘á»™ng", icon: "ğŸ”¦", deadline: "2026-03-29" },
        30: { name: "MÃ´ hÃ¬nh Bitexco", icon: "ğŸ¢", deadline: "2026-04-05" },
        31: { name: "La bÃ n sá»‘", icon: "ğŸ§­", deadline: "2026-04-12" },
        32: { name: "VÃ© tÃ u cao tá»‘c", icon: "ğŸ«", deadline: "2026-04-19" },
        33: { name: "MÅ© tai bÃ¨o", icon: "ğŸ‘’", deadline: "2026-04-26" },
        34: { name: "Cá» vá» Ä‘Ã­ch", icon: "ğŸš©", deadline: "2026-05-03" },
        35: { name: "HuÃ¢n chÆ°Æ¡ng Chiáº¿n tháº¯ng", icon: "ğŸ–ï¸", deadline: "2026-05-10" }
    };

    const currentStudent = localStorage.getItem('studentName');

    async function loadInventory() {
        if (!currentStudent) {
            alert("Vui lÃ²ng Ä‘Äƒng kÃ½ tÃªn táº¡i Báº£n Ä‘á»“ trÆ°á»›c!");
            window.location.href = "index.html";
            return;
        }
        document.getElementById('student-name').innerText = currentStudent;

        let medals = { gold: 0, silver: 0, bronze: 0 };
        const itemContainer = document.getElementById('item-list');
        itemContainer.innerHTML = '';

        // Táº£i toÃ n bá»™ báº£ng scores Ä‘á»ƒ xá»­ lÃ½
        const snapshot = await db.ref('scores').once('value');
        const allScores = snapshot.val() || {};

        for (let week = 19; week <= 35; week++) {
            const item = ITEMS_DATA[week];
            const weekKey = "Tuan_" + week;
            const weekData = allScores[weekKey] || {};
            
            let unlocked = false;
            let medalIcon = "";

            // TÃ¬m káº¿t quáº£ tá»‘t nháº¥t cá»§a há»c sinh (khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng)
            const results = Object.values(weekData).filter(s => 
                (s.fullName || s.name || "").trim().toLowerCase() === currentStudent.trim().toLowerCase()
            );

            if (results.length > 0) {
                results.sort((a, b) => b.score - a.score);
                const best = results[0];
                const score = best.score;

                // 1. Äiá»u kiá»‡n má»Ÿ khÃ³a váº­t pháº©m (Äiá»ƒm >= 50)
                if (score >= 50) unlocked = true;

                // 2. Logic Huy chÆ°Æ¡ng (Dá»±a trÃªn deadline vÃ  Ä‘iá»ƒm)
                const deadline = new Date(item.deadline + "T23:59:59");
                const submitDate = best.date ? parseVietnameseDate(best.date) : new Date();

                if (submitDate <= deadline) {
                    if (score === 100) { medals.gold++; medalIcon = "ğŸ¥‡"; }
                    else if (score >= 80) { medals.silver++; medalIcon = "ğŸ¥ˆ"; }
                    else if (score >= 50) { medals.bronze++; medalIcon = "ğŸ¥‰"; }
                }
            }

            // Hiá»ƒn thá»‹ tháº» váº­t pháº©m
            const card = document.createElement('div');
            card.className = `item-card ${unlocked ? 'unlocked' : ''}`;
            card.innerHTML = `
                <span class="icon">${unlocked ? item.icon : 'ğŸ”’'}</span>
                <div class="name">${unlocked ? item.name : 'ChÆ°a má»Ÿ khÃ³a'}</div>
                <div class="status">${unlocked ? 'HOÃ€N THÃ€NH ' + medalIcon : 'Tuáº§n ' + week}</div>
            `;
            itemContainer.appendChild(card);
        }

        // Cáº­p nháº­t sá»‘ lÆ°á»£ng huy chÆ°Æ¡ng
        document.getElementById('gold-count').innerText = medals.gold;
        document.getElementById('silver-count').innerText = medals.silver;
        document.getElementById('bronze-count').innerText = medals.bronze;
    }

    // HÃ m phÃ¢n tÃ­ch ngÃ y "14:58:43 13/1/2026" thÃ nh Date object
    function parseVietnameseDate(str) {
        try {
            const parts = str.split(' ');
            const time = parts[0];
            const date = parts[1].split('/');
            // Format YYYY-MM-DDTHH:MM:SS
            return new Date(`${date[2]}-${date[1].padStart(2, '0')}-${date[0].padStart(2, '0')}T${time}`);
        } catch (e) {
            return new Date();
        }
    }

    loadInventory();
</script>
</body>
</html>
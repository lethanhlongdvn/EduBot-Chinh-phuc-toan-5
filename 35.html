<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K·ª≤ THI T·ªîNG K·∫æT - CHINH PH·ª§C TO√ÅN 5</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Lexend:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="js/fireworks.js"></script>
    <style>
        :root {
            --primary: #1e3799;
            /* Navy Blue */
            --gold: #f6b93b;
            /* Royal Gold */
            --marble: #f5f6fa;
            --correct: #079992;
            --wrong: #b71540;
            --accent: #38ada9;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, #0a3d62 0%, #3c6382 100%);
            color: #2f3542;
            margin: 0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            padding-bottom: 40px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 20px;
            border: 4px solid var(--gold);
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--primary);
            text-transform: uppercase;
            font-family: 'Bungee';
            letter-spacing: 1px;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 700;
            padding: 10px 15px;
            margin-top: 10px;
            background: rgba(246, 185, 59, 0.1);
            border-radius: 10px;
        }

        .game-stage {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.4);
            min-height: 400px;
            position: relative;
            border: 2px solid #ddd;
        }

        .stage-label {
            background: var(--primary);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-family: 'Bungee';
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.85rem;
            box-shadow: 0 4px 0 #0652dd;
        }

        .question-box {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.6;
            min-height: 80px;
            color: var(--primary);
            border-bottom: 2px dashed #eee;
            padding-bottom: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .opt-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 18px;
            border-radius: 15px;
            color: #2f3542;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 70px;
            box-shadow: 0 5px 0 #ced4da;
        }

        .opt-btn:hover {
            transform: translateY(-2px);
            background: var(--marble);
            border-color: var(--primary);
        }

        .opt-btn.correct {
            background: var(--correct);
            border-color: #06807a;
            color: white;
            box-shadow: 0 5px 0 #06807a;
        }

        .opt-btn.wrong {
            background: var(--wrong);
            border-color: #921235;
            color: white;
            box-shadow: 0 5px 0 #921235;
        }

        .input-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }

        .ans-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 3px solid var(--primary);
            border-radius: 15px;
            outline: none;
            box-sizing: border-box;
            font-family: 'Lexend';
            text-align: center;
            background: #fff;
        }

        .btn-submit {
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'Bungee';
            cursor: pointer;
            box-shadow: 0 6px 0 #000;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: #eee;
            border-radius: 6px;
            margin-top: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--gold));
            width: 0%;
            transition: width 0.5s ease;
        }

        #result-screen {
            text-align: center;
            padding: 50px 20px;
            background: white;
            border-radius: 30px;
            border: 5px solid var(--gold);
            color: var(--primary);
        }

        .trophy {
            font-size: 6rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--gold));
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        .final-score {
            font-size: 5rem;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 2px 2px 0 var(--gold);
            margin: 20px 0;
            font-family: 'Bungee';
        }

        .hidden {
            display: none !important;
        }

        .game-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 0;
            text-align: center;
            font-size: 0.7rem;
            color: var(--gold);
            z-index: 1000;
        }

        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .btn-start {
            background: var(--gold);
            color: var(--primary);
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Bungee';
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 0 #b38900;
            text-transform: uppercase;
            margin-top: 20px;
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #b38900;
            filter: brightness(1.1);
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.1rem;
            }

            .question-box {
                font-size: 1rem;
            }

            .opt-btn {
                font-size: 0.95rem;
                padding: 12px;
                min-height: 50px;
            }
        }
    </style>
</head>

<body>
    <div id="start-screen">
        <div class="trophy">üéì</div>
        <h1 style="color: white; font-size: 2rem; font-family: 'Bungee'; text-align: center; margin: 0 15px;">K·ª≤ THI
            T·ªîNG K·∫æT CU·ªêI K·ª≤ II</h1>
        <p style="color: var(--gold); font-weight: bold; margin-top: 10px;">TH√ÄNH QU·∫¢ 35 TU·∫¶N CHINH PH·ª§C</p>
        <p id="welcome-msg" style="margin-bottom: 20px; font-weight: bold; color: white;"></p>
        <button class="btn-start" onclick="startGame()">B·∫ÆT ƒê·∫¶U D·ª∞ THI</button>
    </div>

    <div class="container hidden" id="game-ui">
        <div class="header">
            <h1>ƒê·ªÄ THI TO√ÅN L·ªöP 5 - T·ªîNG H·ª¢P</h1>
            <div class="info-bar">
                <span>üë§ <b id="user-name">---</b></span>
                <span>‚≠ê <b id="current-score">0</b>/100</span>
                <span>‚è≥ <b id="timer">00:00</b></span>
            </div>
        </div>

        <div class="game-stage">
            <div id="stage-info">
                <div class="stage-label" id="stage-label">PH·∫¶N I: TR·∫ÆC NGHI·ªÜM</div>
                <div class="question-box" id="q-content">ƒêang chu·∫©n b·ªã ƒë·ªÅ thi...</div>
            </div>

            <div id="interaction-area"></div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#636e72; margin-top:8px; font-weight: 600;">C√¢u:
                <span id="progress-text">0/11</span>
            </div>
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <div class="trophy">üèÜ</div>
        <h2>K·∫æT QU·∫¢ CU·ªêI C√ôNG</h2>
        <div class="final-score" id="final-score">0</div>
        <p style="font-size: 1.1rem; font-weight: bold;">Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh ch∆∞∆°ng tr√¨nh To√°n l·ªõp 5!</p>
        <p id="save-msg" style="color:var(--primary); font-weight:bold; margin-top:20px;">ƒêang l∆∞u k·∫øt qu·∫£ v√†o h·ªçc b·∫°
            s·ªë...</p>
        <p id="redirect-msg" class="auto-home-text" style="color:var(--accent); font-weight:bold;"></p>

        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
            <button class="btn-start" onclick="location.reload()">L√ÄM ƒê·ªÄ KH√ÅC</button>
            <button class="btn-start"
                style="background: var(--marble); color: var(--primary); box-shadow: 0 6px 0 #ccc;"
                onclick="window.location.href='index.html'">V·ªÄ TRANG CH·ª¶</button>
        </div>
    </div>

    <div class="game-footer">¬© 2026 EduBot - H·ªá th·ªëng ƒê√°nh gi√° NƒÉng l·ª±c To√°n h·ªçc - Thi·∫øt k·∫ø b·ªüi L√™ Th√†nh Long</div>

    <script>
        const firebaseConfig = { databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const savedName = localStorage.getItem('studentName') || "Th√≠ sinh";
        const savedClass = localStorage.getItem('studentClass') || "---";

        let score = 0;
        let currentIndex = 0;
        let timer = 0;
        let timerItv;
        let testQuestions = [];

        window.onload = () => {
            if (!localStorage.getItem('studentName')) {
                document.getElementById('welcome-msg').innerHTML = "<b style='color:red'>‚ö†Ô∏è Em c·∫ßn ƒëƒÉng k√Ω ·ªü trang ch·ªß tr∆∞·ªõc!</b>";
                document.querySelector('#start-screen .btn-start').onclick = () => window.location.href = "index.html";
            } else {
                document.getElementById('welcome-msg').innerText = `${savedName} - L·ªõp ${savedClass}`;
                document.getElementById('user-name').innerText = savedName;
            }
        };

        const pools = [
            // Q1: Rounding
            [
                { q: "S·ªë 124,568 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["124", "125", "123", "126"], c: "125" },
                { q: "S·ªë 87,49 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["87", "88", "90", "86"], c: "87" },
                { q: "S·ªë 99,51 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["99", "100", "101", "90"], c: "100" },
                { q: "S·ªë 15,25 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["15", "16", "14", "15,2"], c: "16" },
                { q: "S·ªë 235,412 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["235", "236", "234", "240"], c: "235" },
                { q: "S·ªë 0,89 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["0", "1", "2", "0,8"], c: "1" },
                { q: "S·ªë 456,32 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["456", "457", "450", "460"], c: "456" },
                { q: "S·ªë 12,50 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["12", "13", "14", "12,5"], c: "13" },
                { q: "S·ªë 55,44 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["55", "56", "60", "50"], c: "55" },
                { q: "S·ªë 200,5 l√†m tr√≤n ƒë·∫øn s·ªë t·ª± nhi√™n g·∫ßn nh·∫•t l√†:", a: ["200", "201", "202", "200,5"], c: "201" }
            ],
            // Q2: Fraction to Mixed
            [
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 4567/1000 l√†:", a: ["45 67/100", "4 567/1000", "456 7/10", "4567/1"], c: "4 567/1000" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 1234/1000 l√†:", a: ["1 234/1000", "12 34/100", "1 23/40", "123 4/10"], c: "1 234/1000" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 567/100 l√†:", a: ["5 67/100", "56 7/10", "5 6/7", "567/1"], c: "5 67/100" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 8901/1000 l√†:", a: ["8 901/1000", "89 1/100", "8 91/100", "890 1/10"], c: "8 901/1000" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 234/100 l√†:", a: ["2 34/100", "23 4/10", "2 3/4", "234"], c: "2 34/100" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 789/10 l√†:", a: ["7 89/100", "78 9/10", "7 8/9", "789"], c: "78 9/10" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 1102/100 l√†:", a: ["11 2/100", "110 2/10", "1 102/100", "11 1/2"], c: "11 2/100" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 6543/1000 l√†:", a: ["6 543/1000", "65 43/100", "6 54/3", "654 3/10"], c: "6 543/1000" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 999/100 l√†:", a: ["9 99/100", "99 9/10", "9 9/9", "0,999"], c: "9 99/100" },
                { q: "H·ªón s·ªë t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë 432/100 l√†:", a: ["4 32/100", "43 2/10", "4 3/2", "4,32"], c: "4 32/100" }
            ],
            // Q3: Density
            [
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa 0,1 v√† 0,2?", a: ["0 s·ªë", "1 s·ªë (l√† 1,5)", "9 s·ªë", "R·∫•t nhi·ªÅu s·ªë"], c: "R·∫•t nhi·ªÅu s·ªë" },
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa 1,5 v√† 1,6?", a: ["0", "1", "10", "V√¥ s·ªë s·ªë"], c: "V√¥ s·ªë s·ªë" },
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa 0,01 v√† 0,02?", a: ["Nhi·ªÅu s·ªë", "0 s·ªë", "9 s·ªë", "100 s·ªë"], c: "Nhi·ªÅu s·ªë" },
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa hai s·ªë t·ª± nhi√™n 9 v√† 10?", a: ["0", "1", "9", "R·∫•t nhi·ªÅu s·ªë"], c: "R·∫•t nhi·ªÅu s·ªë" },
                { q: "Gi·ªØa 0,5 v√† 0,6 c√≥ th·ªÉ t√¨m ƒë∆∞·ª£c bao nhi√™u s·ªë th·∫≠p ph√¢n n·ªØa?", a: ["0", "1", "V√¥ s·ªë", "9"], c: "V√¥ s·ªë" },
                { q: "Gi·ªØa 2,1 v√† 2,2 c√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n?", a: ["9", "10", "Nhi·ªÅu v√¥ k·ªÉ", "0"], c: "Nhi·ªÅu v√¥ k·ªÉ" },
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n n·∫±m gi·ªØa 0,7 v√† 0,8?", a: ["1", "9", "Kh√¥ng ƒë·∫øm xu·ªÉ", "0"], c: "Kh√¥ng ƒë·∫øm xu·ªÉ" },
                { q: "Gi·ªØa 11 v√† 12 c√≥ bao nhi√™u s·ªë?", a: ["0", "V√¥ s·ªë s·ªë th·∫≠p ph√¢n", "9 s·ªë", "1 s·ªë"], c: "V√¥ s·ªë s·ªë th·∫≠p ph√¢n" },
                { q: "T√¨m s·ªë l∆∞·ª£ng s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa 3,4 v√† 3,5:", a: ["V√¥ v√†n s·ªë", "9 s·ªë", "0 s·ªë", "1 s·ªë"], c: "V√¥ v√†n s·ªë" },
                { q: "C√≥ bao nhi√™u s·ªë th·∫≠p ph√¢n ·ªü gi·ªØa 0,25 v√† 0,26?", a: ["0", "V√¥ s·ªë", "10", "100"], c: "V√¥ s·ªë" }
            ],
            // Q4: Percent Ratios
            [
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 45 v√† 180 l√†:", a: ["20%", "25%", "30%", "15%"], c: "25%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 30 v√† 120 l√†:", a: ["15%", "20%", "25%", "30%"], c: "25%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 25 v√† 100 l√†:", a: ["25%", "50%", "10%", "5%"], c: "25%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 60 v√† 240 l√†:", a: ["20%", "25%", "40%", "15%"], c: "25%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 15 v√† 60 l√†:", a: ["10%", "25%", "50%", "30%"], c: "25%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 40 v√† 100 l√†:", a: ["25%", "40%", "60%", "10%"], c: "40%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 12 v√† 60 l√†:", a: ["20%", "12%", "25%", "30%"], c: "20%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 80 v√† 200 l√†:", a: ["20%", "40%", "80%", "50%"], c: "40%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 18 v√† 90 l√†:", a: ["20%", "18%", "90%", "25%"], c: "20%" },
                { q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 50 v√† 200 l√†:", a: ["50%", "25%", "100%", "20%"], c: "25%" }
            ],
            // Q5: Practical Percent (All 45%)
            [
                { q: "C·ª≠a h√†ng c√≥ 150m v·∫£i, ƒë√£ b√°n ƒë∆∞·ª£c 67,5m. V·∫≠y ƒë√£ b√°n ƒë∆∞·ª£c bao nhi√™u ph·∫ßn trƒÉm?", a: ["40%", "45%", "50%", "55%"], c: "45%" },
                { q: "X∆∞·ªüng c√≥ 200m v·∫£i, ƒë√£ may h·∫øt 90m. X∆∞·ªüng ƒë√£ d√πng bao nhi√™u % v·∫£i?", a: ["45%", "40%", "50%", "48%"], c: "45%" },
                { q: "M·ªôt t·∫•m v·∫£i d√†i 120m, c·∫Øt ƒëi 54m. S·ªë v·∫£i c·∫Øt ƒëi chi·∫øm bao nhi√™u %?", a: ["45%", "40%", "50%", "35%"], c: "45%" },
                { q: "C√≥ 80m l·ª•a, ƒë√£ b√°n 36m. T·ªâ s·ªë % l·ª•a ƒë√£ b√°n l√†:", a: ["40%", "45%", "50%", "30%"], c: "45%" },
                { q: "Kho c√≥ 250m v·∫£i, xu·∫•t kho 112,5m. ƒê√£ xu·∫•t bao nhi√™u %?", a: ["45%", "40%", "50%", "42%"], c: "45%" },
                { q: "Cu·ªôn d√¢y 100m, ƒë√£ c·∫Øt 45m. ƒê√£ d√πng bao nhi√™u % cu·ªôn d√¢y?", a: ["40%", "45%", "50%", "55%"], c: "45%" },
                { q: "Cu·ªôn 160m v·∫£i, ƒë√£ b√°n 72m. T·ªâ l·ªá % ƒë√£ b√°n l√†:", a: ["45%", "40%", "50%", "44%"], c: "45%" },
                { q: "L√¥ h√†ng 300m, ƒë√£ giao 135m. ƒê√£ giao ƒë∆∞·ª£c bao nhi√™u %?", a: ["45%", "40%", "50%", "47%"], c: "45%" },
                { q: "T·∫°i ƒë·∫°i l√Ω c√≥ 400m v·∫£i, b√°n 180m. V·∫≠y b√°n ƒë∆∞·ª£c bao nhi√™u %?", a: ["45%", "40%", "50%", "48%"], c: "45%" },
                { q: "M·ªôt c√¢y v·∫£i 500m, c·∫Øt b√°n 225m. C√¢y v·∫£i ƒë√£ v∆°i ƒëi bao nhi√™u %?", a: ["45%", "40%", "50%", "46%"], c: "45%" }
            ],
            // Q6: Unit dm3 to m3
            [
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 348 dm¬≥ = ... m¬≥", a: ["3,48", "34,8", "0,348", "0,0348"], c: "0,348" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 521 dm¬≥ = ... m¬≥", a: ["5,21", "0,521", "52,1", "5210"], c: "0,521" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 1250 dm¬≥ = ... m¬≥", a: ["1,25", "12,5", "0,125", "125"], c: "1,25" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 89 dm¬≥ = ... m¬≥", a: ["0,89", "0,089", "8,9", "890"], c: "0,089" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 4700 dm¬≥ = ... m¬≥", a: ["47", "4,7", "0,47", "470"], c: "4,7" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 25 dm¬≥ = ... m¬≥", a: ["0,25", "2,5", "0,025", "0,0025"], c: "0,025" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 634 dm¬≥ = ... m¬≥", a: ["0,634", "6,34", "63,4", "0,0634"], c: "0,634" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 901 dm¬≥ = ... m¬≥", a: ["9,01", "0,901", "90,1", "0,0901"], c: "0,901" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 15,5 dm¬≥ = ... m¬≥", a: ["1,55", "0,155", "0,0155", "0,00155"], c: "0,0155" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 777 dm¬≥ = ... m¬≥", a: ["0,777", "7,77", "77,7", "0,0777"], c: "0,777" }
            ],
            // Q7: Surface Area Cube
            [
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 1,3 m. Di·ªán t√≠ch xung quanh l√†:", a: ["1,69 m¬≤", "6,76 m¬≤", "10,14 m¬≤", "5,2 m"], c: "6,76 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 2 m. Di·ªán t√≠ch xung quanh l√†:", a: ["4 m¬≤", "8 m¬≤", "16 m¬≤", "24 m¬≤"], c: "16 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 1,5 m. Di·ªán t√≠ch xung quanh l√†:", a: ["2,25 m¬≤", "9 m¬≤", "13,5 m¬≤", "6 m"], c: "9 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 0,8 m. Di·ªán t√≠ch xung quanh l√†:", a: ["2,56 m¬≤", "0,64 m¬≤", "3,84 m¬≤", "3,2 m"], c: "2,56 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 1,1 m. Di·ªán t√≠ch xung quanh l√†:", a: ["1,21 m¬≤", "4,84 m¬≤", "7,26 m¬≤", "4,4 m"], c: "4,84 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 3 m. Di·ªán t√≠ch xung quanh l√†:", a: ["9 m¬≤", "36 m¬≤", "54 m¬≤", "12 m"], c: "36 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 0,5 m. Di·ªán t√≠ch xung quanh l√†:", a: ["0,25 m¬≤", "1 m¬≤", "1,5 m¬≤", "2 m"], c: "1 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 1,2 m. Di·ªán t√≠ch xung quanh l√†:", a: ["1,44 m¬≤", "5,76 m¬≤", "8,64 m¬≤", "4,8 m"], c: "5,76 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 2,5 m. Di·ªán t√≠ch xung quanh l√†:", a: ["6,25 m¬≤", "25 m¬≤", "37,5 m¬≤", "10 m"], c: "25 m¬≤" },
                { q: "H√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 0,6 m. Di·ªán t√≠ch xung quanh l√†:", a: ["1,44 m¬≤", "2,16 m¬≤", "0,36 m¬≤", "2,4 m"], c: "1,44 m¬≤" }
            ],
            // Q8: Inverse Surface Area
            [
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 64 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["4 cm", "8 cm", "16 cm", "2 cm"], c: "4 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 36 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["3 cm", "6 cm", "9 cm", "2 cm"], c: "3 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 100 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["5 cm", "10 cm", "25 cm", "4 cm"], c: "5 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 144 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["12 cm", "6 cm", "36 cm", "8 cm"], c: "6 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 16 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["4 cm", "2 cm", "8 cm", "1 cm"], c: "2 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 400 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["20 cm", "10 cm", "100 cm", "5 cm"], c: "10 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 196 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["14 cm", "7 cm", "49 cm", "6 cm"], c: "7 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 324 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["18 cm", "9 cm", "81 cm", "12 cm"], c: "9 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 4 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["1 cm", "2 cm", "4 cm", "0,5 cm"], c: "1 cm" },
                { q: "Kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch xung quanh l√† 256 cm¬≤. C·∫°nh c·ªßa n√≥ l√†:", a: ["16 cm", "8 cm", "64 cm", "10 cm"], c: "8 cm" }
            ],
            // Q9: Paint Area (T·ª± lu·∫≠n)
            [
                { q: "Ng∆∞·ªùi ta qu√©t v√¥i xung quanh t∆∞·ªùng v√† tr·∫ßn m·ªôt cƒÉn ph√≤ng h√¨nh h·ªôp ch·ªØ nh·∫≠t d√†i 8m, r·ªông 6m, cao 3,5m. T√≠nh di·ªán t√≠ch c·∫ßn qu√©t v√¥i (ƒë∆°n v·ªã m¬≤).", c: "146" },
                { q: "Ph√≤ng h·ªçc d√†i 6m, r·ªông 4m, cao 3m. T√≠nh di·ªán t√≠ch qu√©t v√¥i tr·∫ßn v√† 4 b·ª©c t∆∞·ªùng xung quanh (ƒë∆°n v·ªã m¬≤).", c: "84" },
                { q: "Ph√≤ng d√†i 7m, r·ªông 5m, cao 3,2m. Di·ªán t√≠ch c·∫ßn qu√©t v√¥i tr·∫ßn v√† xung quanh t∆∞·ªùng l√† bao nhi√™u m¬≤?", c: "111,8" },
                { q: "CƒÉn ph√≤ng d√†i 9m, r·ªông 7m, cao 4m. Khi qu√©t v√¥i xung quanh v√† tr·∫ßn nh√†, di·ªán t√≠ch t√≠nh b·∫±ng m¬≤ l√†:", c: "191" },
                { q: "T√≠nh di·ªán t√≠ch c·∫ßn s∆°n tr·∫ßn v√† 4 m·∫∑t t∆∞·ªùng c·ªßa ph√≤ng d√†i 10m, r·ªông 8m, cao 3,8m. (K·∫øt qu·∫£ m¬≤)", c: "216,8" },
                { q: "M·ªôt ph√≤ng d√†i 5m, r·ªông 4m, cao 3,5m. Di·ªán t√≠ch c·∫ßn qu√©t v√¥i (4 m·∫∑t + tr·∫ßn) b·∫±ng bao nhi√™u m¬≤?", c: "83" },
                { q: "Ph√≤ng kh√°ch d√†i 8,5m, r·ªông 6m, cao 3m. T√≠nh di·ªán t√≠ch qu√©t v√¥i tr·∫ßn v√† c√°c b·ª©c t∆∞·ªùng ch√≠nh (m¬≤).", c: "138" },
                { q: "S·∫£nh l·ªõn d√†i 12m, r·ªông 10m, cao 4m. Di·ªán t√≠ch to√†n b·ªô tr·∫ßn v√† xung quanh t∆∞·ªùng m¬≤ l√†:", c: "296" },
                { q: "Ph√≤ng h·ªçp d√†i 6,5m, r·ªông 4,5m, cao 3,2m. Di·ªán t√≠ch c·∫ßn qu√©t v√¥i (tr·∫ßn v√† xung quanh) m¬≤ l√†:", c: "99,65" },
                { q: "Nh√† kho d√†i 7,5m, r·ªông 6m, cao 3,5m. T√≠nh di·ªán t√≠ch qu√©t v√¥i tr·∫ßn v√† xung quanh (m¬≤).", c: "139,5" }
            ],
            // Q10: Mixed Ops (T·ª± lu·∫≠n)
            [
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 31,47 + 6,25", "b) 76,3 - 37,2", "c) 4 gi·ªù 14 ph√∫t x 4", "d) 7 gi·ªù 18 ph√∫t : 3"], c: ["37,72", "39,1", "16 gi·ªù 56 ph√∫t", "2 gi·ªù 26 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 52,18 + 9,34", "b) 85,4 - 42,7", "c) 2 gi·ªù 15 ph√∫t x 3", "d) 5 gi·ªù 20 ph√∫t : 4"], c: ["61,52", "42,7", "6 gi·ªù 45 ph√∫t", "1 gi·ªù 20 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 12,56 + 8,44", "b) 100 - 35,6", "c) 3 gi·ªù 12 ph√∫t x 5", "d) 9 gi·ªù 30 ph√∫t : 3"], c: ["21", "64,4", "16 gi·ªù", "3 gi·ªù 10 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 45,7 + 34,3", "b) 92,15 - 50,05", "c) 1 gi·ªù 20 ph√∫t x 6", "d) 10 gi·ªù 40 ph√∫t : 5"], c: ["80", "42,1", "8 gi·ªù", "2 gi·ªù 8 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 7,85 + 2,15", "b) 54,2 - 18,9", "c) 5 gi·ªù 10 ph√∫t x 2", "d) 8 gi·ªù 24 ph√∫t : 4"], c: ["10", "35,3", "10 gi·ªù 20 ph√∫t", "2 gi·ªù 6 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 123,4 + 56,6", "b) 210,5 - 85,3", "c) 4 gi·ªù 45 ph√∫t x 2", "d) 12 gi·ªù 30 ph√∫t : 6"], c: ["180", "125,2", "9 gi·ªù 30 ph√∫t", "2 gi·ªù 5 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 36,9 + 4,1", "b) 77,7 - 22,2", "c) 2 gi·ªù 30 ph√∫t x 4", "d) 6 gi·ªù 15 ph√∫t : 5"], c: ["41", "55,5", "10 gi·ªù", "1 gi·ªù 15 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 0,99 + 0,01", "b) 50 - 12,35", "c) 3 gi·ªù 20 ph√∫t x 3", "d) 4 gi·ªù 48 ph√∫t : 4"], c: ["1", "37,65", "10 gi·ªù", "1 gi·ªù 12 ph√∫t"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 8,88 + 1,12", "b) 99,9 - 0,9", "c) 1 gi·ªù 15 ph√∫t x 8", "d) 15 gi·ªù : 5"], c: ["10", "99", "10 gi·ªù", "3 gi·ªù"] },
                { q: "ƒê·∫∑t t√≠nh r·ªìi t√≠nh:", sub: ["a) 15,25 + 14,75", "b) 33,3 - 11,1", "c) 2 gi·ªù 45 ph√∫t x 2", "d) 10 gi·ªù 12 ph√∫t : 2"], c: ["30", "22,2", "5 gi·ªù 30 ph√∫t", "5 gi·ªù 6 ph√∫t"] }
            ],
            // Q11: Motion (T·ª± lu·∫≠n)
            [
                { q: "Xe kh·ªüi h√†nh l√∫c 8h30, ƒë·∫øn ƒë·ªãa ƒëi·ªÉm B l√∫c 13h, tr√™n ƒë∆∞·ªùng ngh·ªâ 30p. Bi·∫øt v·∫≠n t·ªëc l√† 75km/h. C·∫ßn t√¨m qu√£ng ƒë∆∞·ªùng AB (km)?", c: "300" },
                { q: "M·ªôt √¥ t√¥ ƒëi t·ª´ 7h ƒë·∫øn 11h15, ngh·ªâ d·ªçc ƒë∆∞·ªùng 15p. V·∫≠n t·ªëc xe l√† 60km/h. T√≠nh qu√£ng ƒë∆∞·ªùng xe ƒë√£ ƒëi (km).", c: "240" },
                { q: "Ng∆∞·ªùi l√°i xe b·∫Øt ƒë·∫ßu ƒëi t·ª´ 6h v√† ƒë·∫øn n∆°i l√∫c 10h40, c√≥ d·ª´ng l·∫°i ngh·ªâ 40p. T√≠nh qu√£ng ƒë∆∞·ªùng (km) n·∫øu v·∫≠n t·ªëc l√† 80km/h.", c: "320" },
                { q: "Xe kh√°ch ƒëi t·ª´ 13h ƒë·∫øn 17h, gi·ªØa ƒë∆∞·ªùng ngh·ªâ 1h. Bi·∫øt v·∫≠n t·ªëc 50km/h. H·ªèi qu√£ng ƒë∆∞·ªùng xe ƒëi d√†i bao xa (km)?", c: "150" },
                { q: "T√†u h·ªèa r·ªùi ga l√∫c 8h15 v√† ƒë·∫øn ga B l√∫c 12h, ngh·ªâ t·∫°i c√°c tr·∫°m t·ªïng 45p. V·∫≠n t·ªëc t√†u 80km/h. T√≠nh qu√£ng ƒë∆∞·ªùng (km).", c: "240" },
                { q: "M·ªôt v·∫≠n ƒë·ªông vi√™n ƒëi t·ª´ 7h30 ƒë·∫øn 11h, ngh·ªâ 30p. V·∫≠n t·ªëc 45km/h. T√≠nh ƒë·ªô d√†i qu√£ng ƒë∆∞·ªùng v·∫≠n ƒë·ªông vi√™n ƒë√£ v∆∞·ª£t qua (km).", c: "135" },
                { q: "Xe m√°y ƒëi t·ª´ A l√∫c 14h v√† ƒë·∫øn B l√∫c 18h30, ngh·ªâ 30p. V·∫≠n t·ªëc xe 55km/h. Qu√£ng ƒë∆∞·ªùng AB d√†i bao nhi√™u km?", c: "220" },
                { q: "Cano ƒëi t·ª´ 6h30 ƒë·∫øn 9h30, ngh·ªâ 15p t·∫°i b·∫øn. V·∫≠n t·ªëc cano 40km/h. T√≠nh qu√£ng ƒë∆∞·ªùng cano ƒëi ƒë∆∞·ª£c (km).", c: "110" },
                { q: "Xe t·∫£i ƒëi t·ª´ 5h ƒë·∫øn 9h15, ngh·ªâ 15p. V·∫≠n t·ªëc xe l√† 64km/h. T√≠nh qu√£ng ƒë∆∞·ªùng xe t·∫£i ƒëi ƒë∆∞·ª£c (km).", c: "256" },
                { q: "Xe √¥ t√¥ kh·ªüi h√†nh l√∫c 8h s√°ng, ƒë·∫øn n∆°i l√∫c 12h30 tr∆∞a, ngh·ªâ 30p. V·∫≠n t·ªëc 70km/h. T√≠nh qu√£ng ƒë∆∞·ªùng (km).", c: "280" }
            ]
        ];

        function startGame() {
            testQuestions = pools.map((pool, idx) => {
                const variant = pool[Math.floor(Math.random() * pool.length)];
                let pts = 0;
                if (idx < 4) pts = 5;       // Q1, 2, 3, 4 -> 5pt
                else if (idx === 4) pts = 10; // Q5 -> 10pt
                else if (idx < 7) pts = 5;    // Q6, 7 -> 5pt
                else if (idx === 7) pts = 10; // Q8 -> 10pt
                else if (idx === 8) pts = 10; // Q9 -> 10pt
                else pts = 20;               // Q10, 11 -> 20pt

                return {
                    ...variant,
                    pts: pts,
                    type: idx < 8 ? 'mc' : 'input'
                };
            });
            score = 0;
            currentIndex = 0;
            timer = 0;
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            startTimer();
            renderQuestion();
        }

        function renderQuestion() {
            if (currentIndex >= testQuestions.length) { finishGame(); return; }
            const q = testQuestions[currentIndex];
            const area = document.getElementById('interaction-area');
            area.innerHTML = '';

            document.getElementById('q-content').innerText = q.q;
            document.getElementById('progress-text').innerText = `${currentIndex + 1}/${testQuestions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentIndex) / testQuestions.length) * 100}%`;
            document.getElementById('stage-label').innerText = currentIndex < 8 ? "PH·∫¶N I: TR·∫ÆC NGHI·ªÜM" : "PH·∫¶N II: T·ª∞ LU·∫¨N";

            if (q.type === 'mc') {
                const grid = document.createElement('div');
                grid.className = 'options-grid';
                const opts = [...q.a].sort(() => Math.random() - 0.5);
                opts.forEach(opt => {
                    const btn = document.createElement('div');
                    btn.className = 'opt-btn';
                    btn.innerText = opt;
                    btn.onclick = () => checkMc(btn, opt, q.c, q.pts);
                    grid.appendChild(btn);
                });
                area.appendChild(grid);
            } else if (q.sub) {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'input-area';
                let html = '';
                q.sub.forEach((s, i) => {
                    html += `<div style="margin-bottom:10px">
                        <label style="display:block; font-weight:bold; margin-bottom:5px">${s}</label>
                        <input type="text" id="user-ans-${i}" class="ans-input" placeholder="Nh·∫≠p k·∫øt qu·∫£..." autocomplete="off">
                    </div>`;
                });
                html += `<button class="btn-submit" onclick="submitInput()">N·ªòP B√ÄI C√ÅC C√ÇU TR√äN</button>`;
                inputDiv.innerHTML = html;
                area.appendChild(inputDiv);
                document.getElementById('user-ans-0').focus();
            } else {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'input-area';
                inputDiv.innerHTML = `
                    <input type="text" id="user-ans" class="ans-input" placeholder="Nh·∫≠p k·∫øt qu·∫£..." autocomplete="off">
                    <button class="btn-submit" onclick="submitInput()">N·ªòP B√ÄI C√ÇU N√ÄY</button>
                    <p style="font-size: 0.8rem; color: #636e72;">* L∆∞u √Ω: Vi·∫øt ch√≠nh x√°c ƒë∆°n v·ªã n·∫øu ƒë·ªÅ b√†i y√™u c·∫ßu.</p>
                `;
                area.appendChild(inputDiv);
                document.getElementById('user-ans').focus();
                document.getElementById('user-ans').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') submitInput();
                });
            }
        }

        function checkMc(btn, choice, correct, pts) {
            document.querySelectorAll('.opt-btn').forEach(b => b.onclick = null);
            if (choice === correct) {
                btn.classList.add('correct');
                score += pts;
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
                // Show correct one
                document.querySelectorAll('.opt-btn').forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
            }
            updateScoreDisplay();
            setTimeout(() => { currentIndex++; renderQuestion(); }, 2000);
        }

        function submitInput() {
            const q = testQuestions[currentIndex];
            let isCorrect = true;
            let earnedPts = 0;

            if (q.sub) {
                let allCorrect = true;
                q.sub.forEach((_, i) => {
                    const input = document.getElementById(`user-ans-${i}`);
                    const userVal = input.value.trim().toLowerCase().replace(/\s+/g, ' ');
                    const correctVal = q.c[i].toLowerCase().replace(/\s+/g, ' ');
                    if (userVal !== correctVal) {
                        allCorrect = false;
                        input.style.borderColor = "var(--wrong)";
                        input.value = `Sai! ƒêA: ${q.c[i]}`;
                    } else {
                        input.style.borderColor = "var(--correct)";
                        earnedPts += 5; // Question 10 specific: 5 pts per sub-item
                    }
                });
                isCorrect = allCorrect;
            } else {
                const input = document.getElementById('user-ans');
                const userVal = input.value.trim().toLowerCase().replace(/\s+/g, ' ');
                const correctVal = q.c.toLowerCase().replace(/\s+/g, ' ');
                isCorrect = userVal === correctVal;
                if (!isCorrect) {
                    input.style.borderColor = "var(--wrong)";
                    input.value = `Sai! ƒê√°p √°n: ${q.c}`;
                } else {
                    input.style.borderColor = "var(--correct)";
                    earnedPts = q.pts;
                }
            }

            score += earnedPts;
            if (isCorrect || earnedPts > 0) {
                playSound('correct');
            } else {
                playSound('wrong');
            }

            updateScoreDisplay();
            setTimeout(() => { currentIndex++; renderQuestion(); }, (q.sub ? 3500 : 2500));
        }

        function updateScoreDisplay() {
            document.getElementById('current-score').innerText = score;
        }

        function startTimer() {
            timerItv = setInterval(() => {
                timer++;
                const m = Math.floor(timer / 60).toString().padStart(2, '0');
                const s = (timer % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(523, t); osc.frequency.exponentialRampToValueAtTime(880, t + 0.1);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            } else {
                osc.type = 'square'; osc.frequency.setValueAtTime(110, t); osc.frequency.linearRampToValueAtTime(80, t + 0.2);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            }
        }

        function finishGame() {
            clearInterval(timerItv);
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;

            let count = 5;
            // Hi·ªáu ·ª©ng ph√°o hoa n·∫øu ƒëi·ªÉm >= 90
            if (score >= 90) {
                count = 10;
                if (typeof startFireworks === 'function') {
                    startFireworks();
                }
            }

            const ref = db.ref('scores/Tuan_35');
            ref.once('value', (snap) => {
                let attempt = 1;
                const data = snap.val();
                if (data) {
                    for (let id in data) {
                        if (data[id].fullName === savedName) attempt++;
                    }
                }
                ref.push({
                    fullName: savedName,
                    className: savedClass,
                    schoolName: savedSchool,
                    score: score,
                    duration: timer,
                    attempt: attempt,
                    date: new Date().toLocaleString('vi-VN')
                }, () => {
                    document.getElementById('save-msg').innerText = "H·ªì s∆° ƒëi·ªán t·ª≠ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!";
                    const rd = document.getElementById('redirect-msg');
                    const itv2 = setInterval(() => {
                        count--;
                        if (score >= 90) {
                            rd.innerText = `üéÜ ƒêang b·∫Øn ph√°o hoa ch√∫c m·ª´ng! V·ªÅ trang ch·ªß sau ${count}s...`;
                        } else {
                            rd.innerText = `S·∫Ω quay l·∫°i trang ch·ªß trong ${count}s...`;
                        }
                        if (count <= 0) {
                            clearInterval(itv2);
                            window.location.href = "index.html";
                        }
                    }, 1000);
                });
            });
        }
    </script>
</body>

</html>
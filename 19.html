<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£n ƒê·ªì Kho B√°u - Tu·∫ßn 19</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --parchment: #f4e4bc; --ink: #2c3e50; --gold: #c6930a; --ocean: #2980b9; --red: #e74c3c; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; background: #1a1a2e; color: var(--ink); display: flex; flex-direction: column; align-items: center; min-height: 100vh; position: relative; padding-bottom: 100px; }
        
        .stage-banner { 
            background: var(--gold); color: white; padding: 10px 30px; 
            border-radius: 50px; font-weight: 700; margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 2px solid #fff;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .map-frame { max-width: 750px; width: 100%; background: var(--parchment); padding: 30px; border-radius: 15px; border: 10px solid #8e735b; box-shadow: 0 0 40px rgba(0,0,0,0.6); position: relative; background-image: url('https://www.transparenttextures.com/patterns/parchment.png'); }
        .status-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: 700; color: #5e412f; border-bottom: 2px dashed #8e735b; padding-bottom: 10px; }
        
        .question-box { background: rgba(255, 255, 255, 0.5); border-radius: 12px; padding: 25px; margin-bottom: 25px; min-height: 100px; border: 1px solid #d4b996; font-size: 1.2rem; line-height: 1.6; text-align: center; font-weight: 600; }
        
        .options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-opt { background: #fff; border: 2px solid #8e735b; padding: 15px; border-radius: 10px; font-family: 'Lexend'; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 1rem; color: #2c3e50; }
        .btn-opt:hover { background: var(--gold); color: white; transform: translateY(-2px); }
        
        .input-area { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .input-ans { padding: 15px; width: 250px; font-size: 1.3rem; border: 3px solid var(--gold); border-radius: 10px; text-align: center; font-family: 'Lexend'; outline: none; }
        .btn-submit { background: var(--ocean); color: white; padding: 12px 40px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }

        #toast { position: fixed; top: 30px; padding: 15px 40px; border-radius: 50px; font-weight: bold; z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; }
        .show-toast { opacity: 1 !important; top: 50px !important; }
        .hidden { display: none; }
        
        .btn-final { background: var(--ocean); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        
        /* FOOTER B·∫¢N QUY·ªÄN */
        .footer-copyright {
            position: absolute; bottom: 20px; text-align: center; width: 100%;
            color: #bdc3c7; font-size: 0.85rem; letter-spacing: 0.5px;
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;
        }
    </style>
</head>
<body>

<div id="vong-banner" class="stage-banner">V√íNG 1: KH√ÅM PH√Å</div>

<div class="status-header" style="width: 100%; max-width: 750px; color: #f1c40f; font-size: 1.2rem;">
    <span>ƒêI·ªÇM: <span id="diem-nhan">0</span> / 100</span>
    <span id="mang-song" style="color: #ff7675;">GI√ÅP: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
</div>

<div class="map-frame">
    <div id="ui-choi">
        <div class="status-header">
            <span id="cau-so">C√ÇU 1/4</span>
            <span style="color: #8e735b;">TU·∫¶N 19</span>
        </div>
        <div class="question-box" id="noi-dung-cau-hoi">ƒêang chu·∫©n b·ªã...</div>
        <div id="khu-vuc-dap-an"></div>
    </div>

    <div id="ui-ket-thuc" class="hidden" style="text-align: center;">
        <h2 style="color: #5e412f;">H√ÄNH TR√åNH K·∫æT TH√öC! üèÜ</h2>
        <h1 id="diem-cuoi" style="font-size: 4rem; margin: 15px 0; color: var(--gold);">0</h1>
        <div id="form-dang-ky">
            <input type="text" id="ten-hs" style="width:80%; padding:15px; margin:5px; border-radius:8px; border:1px solid #ccc;" placeholder="H·ªç v√† t√™n h·ªçc sinh...">
            <input type="text" id="lop-hs" style="width:80%; padding:15px; margin:5px; border-radius:8px; border:1px solid #ccc;" placeholder="L·ªõp...">
            <button class="btn-final" style="width:85%; margin-top:15px;" onclick="saveResult()">GHI DANH B·∫¢NG V√ÄNG</button>
        </div>
        <button class="btn-final" style="background:#7f8c8d; margin-top:15px;" onclick="location.reload()">TH·ª∞C HI·ªÜN L·∫†I</button>
    </div>
</div>

<div id="toast"></div>

<div class="footer-copyright">
     ¬©2026 EduRobot - L√™ Th√†nh Long
</div>

<script>
    let currentScore = 0;
    let lives = 3;
    let stage = 1;
    let qIdx = 0;
    let currentPool = [];

    // DATA V√íNG 1 (40ƒë)
    const DATA_V1 = [
        {q: "T·ªâ s·ªë c·ªßa 3 v√† 5 ƒë∆∞·ª£c vi·∫øt l√†:", opts: ["3 + 5", "5 : 3", "3/5", "3 x 5"], c: 2},
        {q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 25 v√† 100 l√†:", opts: ["2,5%", "25%", "0,25", "250%"], c: 1},
        {q: "ƒê·ªÉ vi·∫øt 0,45 th√†nh t·ªâ s·ªë ph·∫ßn trƒÉm, ta vi·∫øt:", opts: ["4,5%", "450%", "45%", "0,45%"], c: 2},
        {q: "1/2 vi·∫øt d∆∞·ªõi d·∫°ng t·ªâ s·ªë ph·∫ßn trƒÉm l√†:", opts: ["20%", "50%", "12%", "5%"], c: 1}
    ];

    // DATA V√íNG 2 (40ƒë)
    const DATA_V2 = [
        {q: "L·ªõp c√≥ 20 nam v√† 25 n·ªØ. T·ªâ s·ªë c·ªßa s·ªë nam v√† s·ªë n·ªØ l√†:", opts: ["20/25", "25/20", "20/45", "45/20"], c: 0},
        {q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 15 v√† 60 l√†:", opts: ["20%", "15%", "25%", "30%"], c: 2},
        {q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:1000, 1cm ·ª©ng v·ªõi th·ª±c t·∫ø l√†:", opts: ["10m", "100m", "1m", "1000m"], c: 0},
        {q: "T√¨m 20% c·ªßa 500kg:", opts: ["10kg", "100kg", "50kg", "200kg"], c: 1}
    ];

    // DATA V√íNG 3 (20ƒë - T·ª∞ LU·∫¨N)
    const DATA_V3 = [
        {q: "M·ªôt c·ª≠a h√†ng c√≥ 500kg g·∫°o, ƒë√£ b√°n 150kg. S·ªë g·∫°o ƒë√£ b√°n chi·∫øm bao nhi√™u %? (ƒêi·ªÅn s·ªë)", ans: "30"},
        {q: "L√£i su·∫•t l√† 0,6%/th√°ng. G·ª≠i 2.000.000 ƒë·ªìng th√¨ ti·ªÅn l√£i 1 th√°ng l√† bao nhi√™u ƒë·ªìng?", ans: "12000"}
    ];

    function initStage(s) {
        stage = s; qIdx = 0;
        lives = 3; // Reset gi√°p cho m·ªói v√≤ng m·ªõi
        updateHearts();
        
        const banner = document.getElementById('vong-banner');
        if(s === 1) {
            banner.innerText = "V√íNG 1: KH√ÅM PH√Å";
            currentPool = shuffle([...DATA_V1]);
        } else if(s === 2) {
            banner.innerText = "V√íNG 2: LUY·ªÜN T·∫¨P";
            currentPool = shuffle([...DATA_V2]);
        } else {
            banner.innerText = "V√íNG 3: LUY·ªÜN T·∫¨P N√ÇNG CAO";
            currentPool = shuffle([...DATA_V3]).slice(0, 2);
        }
        showQ();
    }

    function showQ() {
        let item = currentPool[qIdx];
        document.getElementById('cau-so').innerText = `C√ÇU ${qIdx + 1}/${currentPool.length}`;
        document.getElementById('noi-dung-cau-hoi').innerText = item.q;
        const container = document.getElementById('khu-vuc-dap-an');
        container.innerHTML = '';

        if(stage < 3) {
            container.className = "options-container";
            item.opts.forEach((o, i) => {
                let btn = document.createElement('button');
                btn.className = "btn-opt";
                btn.innerText = o;
                btn.onclick = () => check(i);
                container.appendChild(btn);
            });
        } else {
            container.className = "input-area";
            container.innerHTML = `
                <input type="number" id="ans-input" class="input-ans" placeholder="Nh·∫≠p k·∫øt qu·∫£...">
                <button class="btn-submit" onclick="checkTL()">X√ÅC NH·∫¨N</button>
            `;
            setTimeout(() => document.getElementById('ans-input').focus(), 500);
        }
    }

    function check(idx) {
        if(idx === currentPool[qIdx].c) win(); else lose();
    }

    function checkTL() {
        const val = document.getElementById('ans-input').value.trim();
        if(val === currentPool[qIdx].ans) win(); else lose();
    }

    function win() {
        currentScore += 10;
        showToast("CH√çNH X√ÅC! +10ƒë", "#27ae60");
        next();
    }

    function lose() {
        lives--;
        updateHearts();
        
        if(lives <= 0) {
            showToast("H·∫æT L∆Ø·ª¢T! CHUY·ªÇN V√íNG TI·∫æP THEO", "#e67e22");
            // ƒê·ª£i 1 l√°t r·ªìi chuy·ªÉn sang v√≤ng ti·∫øp theo ngay l·∫≠p t·ª©c
            setTimeout(() => {
                if(stage < 3) initStage(stage + 1);
                else end();
            }, 1200);
        } else {
            showToast("CH∆ØA ƒê√öNG R·ªíI! ‚ùå", "#e74c3c");
            next();
        }
    }

    function updateHearts() {
        let hearths = ""; 
        for(let i=0; i<3; i++) hearths += i < lives ? "‚ù§Ô∏è" : "üñ§";
        document.getElementById('mang-song').innerText = "GI√ÅP: " + hearths;
    }

    function next() {
        document.getElementById('diem-nhan').innerText = currentScore;
        setTimeout(() => {
            qIdx++;
            if(qIdx < currentPool.length) {
                showQ();
            } else {
                // H·∫øt c√¢u h·ªèi trong v√≤ng n√†y
                if(stage < 3) initStage(stage + 1);
                else end();
            }
        }, 800);
    }

    function end() {
        document.getElementById('ui-choi').classList.add('hidden');
        document.getElementById('ui-ket-thuc').classList.remove('hidden');
        document.getElementById('diem-cuoi').innerText = currentScore;
        document.getElementById('vong-banner').innerText = "HO√ÄN TH√ÄNH";
    }

    function showToast(m, c) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.background = c; t.style.color = "#fff";
        t.classList.add('show-toast');
        setTimeout(() => t.classList.remove('show-toast'), 1000);
    }

    function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

    function saveResult() {
        const t = document.getElementById('ten-hs').value;
        const l = document.getElementById('lop-hs').value;
        if(!t || !l) return alert("Em c·∫ßn ƒëi·ªÅn ƒë·∫ßy ƒë·ªß t√™n v√† l·ªõp nh√©!");
        firebase.database().ref('ketqua/tuan19/' + Date.now()).set({ hoTen: t, lop: l, diem: currentScore })
        .then(() => { alert("Th√¥ng tin c·ªßa em ƒë√£ ƒë∆∞·ª£c l∆∞u!"); location.reload(); });
    }

    window.onload = () => initStage(1);
</script>
</body>
</html>
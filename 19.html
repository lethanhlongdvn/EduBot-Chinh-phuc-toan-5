<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu·∫ßn 19: B·∫£n ƒê·ªì Kho B√°u - EduRobot</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --parchment: #f4e4bc; --ink: #2c3e50; --gold: #c6930a; --ocean: #2980b9; --red: #e74c3c; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; background: #1a1a2e; color: var(--ink); display: flex; flex-direction: column; align-items: center; min-height: 100vh; position: relative; padding-bottom: 100px; }
        .stage-banner { background: var(--gold); color: white; padding: 12px 35px; border-radius: 50px; font-weight: 700; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 2px solid #fff; text-transform: uppercase; letter-spacing: 1px; font-size: 1.2rem; }
        .map-frame { max-width: 750px; width: 100%; background: var(--parchment); padding: 30px; border-radius: 15px; border: 10px solid #8e735b; box-shadow: 0 0 40px rgba(0,0,0,0.6); position: relative; background-image: url('https://www.transparenttextures.com/patterns/parchment.png'); }
        .status-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: 700; color: #5e412f; border-bottom: 2px dashed #8e735b; padding-bottom: 10px; }
        .question-box { background: rgba(255, 255, 255, 0.5); border-radius: 12px; padding: 25px; margin-bottom: 25px; min-height: 100px; border: 1px solid #d4b996; font-size: 1.2rem; line-height: 1.6; text-align: center; font-weight: 600; }
        .options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-opt { background: #fff; border: 2px solid #8e735b; padding: 15px; border-radius: 10px; font-family: 'Lexend'; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 1rem; color: #2c3e50; }
        .btn-opt:hover { background: var(--gold); color: white; transform: translateY(-2px); }
        .input-area { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .input-ans { padding: 15px; width: 250px; font-size: 1.3rem; border: 3px solid var(--gold); border-radius: 10px; text-align: center; font-family: 'Lexend'; outline: none; }
        .btn-submit { background: var(--ocean); color: white; padding: 12px 40px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
        #toast { position: fixed; top: 30px; padding: 15px 40px; border-radius: 50px; font-weight: bold; z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; }
        .show-toast { opacity: 1 !important; top: 50px !important; }
        .hidden { display: none; }
        .btn-final { background: var(--ocean); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .footer-copyright { position: absolute; bottom: 20px; text-align: center; width: 100%; color: #bdc3c7; font-size: 0.9rem; letter-spacing: 0.5px; }
    </style>
</head>
<body>

<audio id="sound-correct" src="https://www.myinstants.com/media/sounds/ding-sound-effect_1.mp3"></audio>
<audio id="sound-wrong" src="https://www.myinstants.com/media/sounds/buzzer_x_incorrect.mp3"></audio>

<div id="vong-banner" class="stage-banner">TU·∫¶N 19: V√íNG 1 - KH√ÅM PH√Å</div>

<div class="status-header" style="width: 100%; max-width: 750px; color: #f1c40f; font-size: 1.2rem;">
    <span>ƒêI·ªÇM: <span id="diem-nhan">0</span> / 100</span>
    <span id="mang-song">GI√ÅP: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
</div>

<div class="map-frame">
    <div id="ui-choi">
        <div class="status-header">
            <span id="cau-so">C√ÇU 1/4</span>
            <span style="color: #8e735b;">MATH 5</span>
        </div>
        <div class="question-box" id="noi-dung-cau-hoi">ƒêang m·ªü b·∫£n ƒë·ªì kho b√°u...</div>
        <div id="khu-vuc-dap-an"></div>
    </div>

    <div id="ui-ket-thuc" class="hidden" style="text-align: center;">
        <h2 id="title-finish" style="color: #5e412f;">K·∫æT TH√öC H√ÄNH TR√åNH!</h2>
        <h1 id="diem-cuoi" style="font-size: 4rem; margin: 15px 0; color: var(--gold);">0</h1>
        <p id="msg-finish" style="font-weight: bold;"></p>
        <div id="form-dang-ky">
            <input type="text" id="ten-hs" style="width:80%; padding:15px; margin:5px; border-radius:8px; border:1px solid #ccc;" placeholder="H·ªç v√† t√™n...">
            <input type="text" id="lop-hs" style="width:80%; padding:15px; margin:5px; border-radius:8px; border:1px solid #ccc;" placeholder="L·ªõp...">
            <button class="btn-final" style="width:85%; margin-top:15px;" onclick="saveResult()">L∆ØU K·∫æT QU·∫¢</button>
        </div>
        <button class="btn-final" style="background:#7f8c8d; margin-top:15px;" onclick="location.reload()">TH·ª¨ TH√ÅCH L·∫†I</button>
    </div>
</div>

<div id="toast"></div>

<div class="footer-copyright">
    @ 2026 EduRobot - L√™ Th√†nh Long
</div>

<script>
    const FULL_DATA = {
        V1: [
            {q: "Tr√™n b·∫£n ƒë·ªì c√≥ 7 v·ªã tr√≠ hang ƒë√° v√† 10 v·ªã tr√≠ r·ª´ng c√¢y. T·ªâ s·ªë c·ªßa s·ªë hang ƒë√° v√† s·ªë r·ª´ng c√¢y l√†:", opts: ["10 : 7", "7 : 10", "7 : 17", "10 : 17"], c: 1},
            {q: "T·ªâ s·ªë c·ªßa s·ªë a v√† s·ªë b (b kh√°c 0) l√† a : b hay a/b. T·ªâ s·ªë n√†y cho bi·∫øt ƒëi·ªÅu g√¨?", opts: ["S·ªë a b·∫±ng a/b s·ªë b", "S·ªë b b·∫±ng a/b s·ªë a", "S·ªë a nhi·ªÅu h∆°n s·ªë b l√† a/b ƒë∆°n v·ªã", "S·ªë a k√©m s·ªë b l√† a/b ƒë∆°n v·ªã"], c: 0},
            {q: "Trong m·ªôt cu·ªôc kh·∫£o s√°t 100 b·∫°n th√¨ c√≥ 43 b·∫°n th√≠ch ƒëi t√¨m kho b√°u. T·ªâ s·ªë ph·∫ßn trƒÉm s·ªë b·∫°n th√≠ch t√¨m kho b√°u l√†:", opts: ["4,3%", "0,43%", "43%", "430%"], c: 2},
            {q: "K√Ω hi·ªáu % trong t·ªâ s·ªë ph·∫ßn trƒÉm ƒë∆∞·ª£c ƒë·ªçc l√†:", opts: ["Ph·∫ßn m∆∞·ªùi", "Ph·∫ßn trƒÉm", "Ph·∫ßn ngh√¨n", "ƒê∆°n v·ªã"], c: 1},
            {q: "T·ªâ s·ªë 1 : 10 000 ghi ·ªü ph√≠a d∆∞·ªõi m·ªôt b·∫£n ƒë·ªì ƒë∆∞·ª£c g·ªçi l√†:", opts: ["T·ªâ s·ªë ƒë·ªô d√†i", "T·ªâ l·ªá b·∫£n ƒë·ªì", "T·ªâ s·ªë ph·∫ßn trƒÉm", "T·ªâ s·ªë x√≠ch"], c: 1},
            {q: "T·ªâ l·ªá b·∫£n ƒë·ªì th∆∞·ªùng ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng m·ªôt ph√¢n s·ªë c√≥ t·ª≠ s·ªë l√†:", opts: ["1", "10", "100", "1 000"], c: 0},
            {q: "T·ªâ l·ªá b·∫£n ƒë·ªì 1 : 500 cho bi·∫øt h√¨nh ·∫£nh tr√™n b·∫£n ƒë·ªì ƒë√£ ƒë∆∞·ª£c:", opts: ["Ph√≥ng to 500 l·∫ßn", "Gi·ªØ nguy√™n k√≠ch th∆∞·ªõc", "Thu nh·ªè 500 l·∫ßn", "Thu nh·ªè 1 l·∫ßn"], c: 2},
            {q: "ƒê·ªÉ t√≠nh ƒë·ªô d√†i th·∫≠t d·ª±a tr√™n ƒë·ªô d√†i b·∫£n ƒë·ªì v√† t·ªâ l·ªá b·∫£n ƒë·ªì, ta th·ª±c hi·ªán:", opts: ["Chia cho m·∫´u s·ªë t·ªâ l·ªá", "Nh√¢n v·ªõi m·∫´u s·ªë t·ªâ l·ªá", "C·ªông v·ªõi m·∫´u s·ªë t·ªâ l·ªá", "L·∫•y m·∫´u s·ªë chia ƒë·ªô d√†i b·∫£n ƒë·ªì"], c: 1}
        ],
        V2: [
            {q: "T·ªâ s·ªë c·ªßa m = 13 and n = 17 ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng ph√¢n s·ªë l√†:", opts: ["17/13", "13 : 17", "13/17", "13/30"], c: 2},
            {q: "Chuy·ªÉn ph√¢n s·ªë 9/25 th√†nh t·ªâ s·ªë ph·∫ßn trƒÉm:", opts: ["9%", "36%", "25%", "45%"], c: 1},
            {q: "M·ªôt h√≤n ƒë·∫£o c√≥ 100 c√¢y d·ª´a, 92 c√¢y ƒë√£ c√≥ qu·∫£. T·ªâ s·ªë ph·∫ßn trƒÉm c√¢y CH∆ØA c√≥ qu·∫£ l√†:", opts: ["8%", "92%", "100%", "18%"], c: 0},
            {q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:1000, kho·∫£ng c√°ch ƒëo ƒë∆∞·ª£c 6cm. ƒê·ªô d√†i th·∫≠t l√†:", opts: ["6 m", "60 m", "600 m", "6 000 m"], c: 1},
            {q: "Th·ª±c t·∫ø d√†i 160km. Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:1.000.000, qu√£ng ƒë∆∞·ªùng n√†y d√†i:", opts: ["160 cm", "16 cm", "1,6 cm", "16 mm"], c: 1},
            {q: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh: 57% + 43,5% l√†:", opts: ["100%", "10,05%", "100,5%", "90,5%"], c: 2},
            {q: "Th·ª£ sƒÉn ƒëi ƒë∆∞·ª£c 35% con ƒë∆∞·ªùng. T·ªâ s·ªë ph·∫ßn trƒÉm con ƒë∆∞·ªùng C√íN PH·∫¢I ƒêI l√†:", opts: ["35%", "135%", "65%", "75%"], c: 2},
            {q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:2000, kho·∫£ng c√°ch gi·ªØa hai h√≤n ƒë·∫£o l√† 5cm. ƒê·ªô d√†i th·∫≠t l√†:", opts: ["10 m", "100 m", "1 000 m", "10 000 m"], c: 1}
        ],
        V3: [
            {q: "M·∫£nh v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t (t·ªâ l·ªá 1:3000) c√≥ d√†i 3cm, r·ªông 2cm. Di·ªán t√≠ch th·∫≠t l√† bao nhi√™u m2?", ans: "5400"},
            {q: "B·∫£n ƒë·ªì th·ª© nh·∫•t (1:1000), b·∫£n ƒë·ªì th·ª© hai (1:2000). N·∫øu b·∫£n ƒë·ªì th·ª© nh·∫•t d√†i 10cm th√¨ b·∫£n ƒë·ªì th·ª© hai d√†i bao nhi√™u cm?", ans: "5"},
            {q: "Khu b·∫£o t·ªìn h√¨nh vu√¥ng c√≥ chu vi tr√™n b·∫£n ƒë·ªì (1:5000) l√† 16cm. Di·ªán t√≠ch th·∫≠t l√† bao nhi√™u ha?", ans: "4"},
            {q: "Ch·∫∑ng m·ªôt (30%), ch·∫∑ng hai d√†i h∆°n ch·∫∑ng m·ªôt 40m v√† chi·∫øm 70% t·ªïng ƒë∆∞·ªùng. T·ªïng qu√£ng ƒë∆∞·ªùng l√† bao nhi√™u m?", ans: "100"}
        ]
    };

    let currentScore = 0, lives = 3, stage = 1, qIdx = 0, currentPool = [];

    window.addEventListener('beforeunload', (e) => {
        if (stage <= 3 && document.getElementById('ui-ket-thuc').classList.contains('hidden')) {
            e.preventDefault(); e.returnValue = '';
        }
    });

    function playSound(type) {
        const s = document.getElementById(type === 'correct' ? 'sound-correct' : 'sound-wrong');
        s.currentTime = 0; s.play();
    }

    function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

    function initStage(s) {
        stage = s; qIdx = 0;
        const b = document.getElementById('vong-banner');
        if(s === 1) { b.innerText = "TU·∫¶N 19: V√íNG 1 - KH√ÅM PH√Å"; currentPool = shuffle([...FULL_DATA.V1]).slice(0, 4); }
        else if(s === 2) { b.innerText = "TU·∫¶N 19: V√íNG 2 - LUY·ªÜN T·∫¨P"; currentPool = shuffle([...FULL_DATA.V2]).slice(0, 4); }
        else { b.innerText = "TU·∫¶N 19: V√íNG 3 - N√ÇNG CAO (ƒêI·ªÄN S·ªê)"; currentPool = shuffle([...FULL_DATA.V3]).slice(0, 2); }
        showQ();
    }

    function showQ() {
        let item = currentPool[qIdx];
        document.getElementById('cau-so').innerText = `C√ÇU ${qIdx + 1}/${currentPool.length}`;
        document.getElementById('noi-dung-cau-hoi').innerText = item.q;
        const c = document.getElementById('khu-vuc-dap-an');
        c.innerHTML = '';
        if(stage < 3) {
            c.className = "options-container";
            item.opts.forEach((o, i) => {
                let btn = document.createElement('button');
                btn.className = "btn-opt"; btn.innerText = o;
                btn.onclick = () => { if(i === item.c) win(); else lose(); };
                c.appendChild(btn);
            });
        } else {
            c.className = "input-area";
            c.innerHTML = `<input type="number" id="ans-input" class="input-ans" placeholder="Nh·∫≠p s·ªë..."><button class="btn-submit" onclick="checkTL()">G·ª¨I ƒê√ÅP √ÅN</button>`;
            setTimeout(() => document.getElementById('ans-input').focus(), 500);
        }
    }

    function checkTL() { if(document.getElementById('ans-input').value.trim() === currentPool[qIdx].ans) win(); else lose(); }

    function win() { currentScore += 10; playSound('correct'); showToast("XU·∫§T S·∫ÆC! +10ƒë", "#27ae60"); next(); }

    function lose() {
        lives--; playSound('wrong'); updateHearts();
        if(lives <= 0) {
            showToast(stage === 1 ? "H·∫æT L∆Ø·ª¢T! SANG V√íNG 2" : "H·∫æT L∆Ø·ª¢T V√íNG N√ÄY!", "#e67e22");
            setTimeout(() => { if(stage < 3) initStage(stage + 1); else end(); }, 1500);
        } else { showToast("CH∆ØA CH√çNH X√ÅC! ‚ùå", "#e74c3c"); next(); }
    }

    function updateHearts() {
        let h = ""; for(let i=0; i<3; i++) h += i < lives ? "‚ù§Ô∏è" : "üñ§";
        document.getElementById('mang-song').innerText = "GI√ÅP: " + h;
    }

    function next() {
        document.getElementById('diem-nhan').innerText = currentScore;
        setTimeout(() => {
            qIdx++;
            if(qIdx < currentPool.length) showQ();
            else if(stage < 3) initStage(stage + 1);
            else end();
        }, 1000);
    }

    function end() {
        document.getElementById('ui-choi').classList.add('hidden');
        document.getElementById('ui-ket-thuc').classList.remove('hidden');
        document.getElementById('diem-cuoi').innerText = currentScore;
        const m = document.getElementById('msg-finish');
        if(currentScore >= 50) { m.innerText = "Ch√∫c m·ª´ng! Em ƒë√£ v∆∞·ª£t qua th·ª≠ th√°ch."; m.style.color = "green"; }
        else { m.innerText = "Em c·∫ßn c·ªë g·∫Øng th√™m nh√©!"; m.style.color = "red"; }
    }

    function showToast(m, c) {
        const t = document.getElementById('toast'); t.innerText = m; t.style.background = c; t.style.color = "#fff";
        t.classList.add('show-toast'); setTimeout(() => t.classList.remove('show-toast'), 1200);
    }

    function saveResult() {
        const t = document.getElementById('ten-hs').value, l = document.getElementById('lop-hs').value;
        if(!t || !l) return alert("Em nh·∫≠p t√™n v√† l·ªõp nh√©!");
        firebase.database().ref('ketqua/tuan19/' + Date.now()).set({ hoTen: t, lop: l, diem: currentScore })
        .then(() => { alert("ƒê√£ l∆∞u ƒëi·ªÉm!"); location.reload(); });
    }

    window.onload = () => {
        const config = { databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(config);
        initStage(1);
    };
</script>
</body>
</html>
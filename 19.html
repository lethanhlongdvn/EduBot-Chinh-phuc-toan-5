<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£n ƒë·ªì kho b√°u - Tu·∫ßn 19</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #FF9800; --secondary: #2196F3; --success: #4CAF50; --danger: #f44336; --bg: #FFFBF0; }
        body { font-family: 'Lexend', Arial, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 750px; width: 100%; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 10px solid var(--primary); }
        .header-box { width: 100%; border-radius: 15px; height: 80px; margin-bottom: 20px; background: linear-gradient(135deg, #FFF3E0, #FFE0B2); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; border: 1px solid #EEE; }
        .header-box h2 { color: var(--primary); margin: 0; font-size: 1.4rem; }
        .header-box p { color: #888; font-size: 0.85rem; margin: 2px 0 0 0; }
        .progress-container { height: 10px; background: #EEE; border-radius: 6px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: 0.5s; }
        .level-map { display: flex; gap: 10px; margin-bottom: 20px; }
        .lvl-btn { flex: 1; padding: 10px 5px; border: none; border-radius: 12px; background: #F5F5F5; font-family: 'Lexend'; font-size: 0.8rem; color: #888; pointer-events: none; }
        .lvl-btn.active { background: var(--primary); color: white; font-weight: bold; border-bottom: 3px solid #E68A00; }
        .question-area { min-height: 140px; text-align: center; }
        .q-text { font-size: 1.1rem; color: #333; margin-bottom: 15px; line-height: 1.5; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt { padding: 12px; border: 2px solid #F0F0F0; border-radius: 12px; background: white; cursor: pointer; transition: 0.2s; font-size: 0.95rem; font-family: 'Lexend'; }
        .opt:hover:not(:disabled) { border-color: var(--secondary); background: #E3F2FD; }
        .robot-box { display: flex; align-items: center; background: #E1F5FE; padding: 12px; border-radius: 12px; margin-top: 15px; gap: 10px; border-left: 5px solid var(--secondary); font-size: 0.9rem; }
        .hidden { display: none; }
        .action-btn { padding: 12px 25px; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-family: 'Lexend'; font-size: 1rem; margin-top: 10px; }
        .input-field { padding: 12px; border-radius: 10px; border: 2px solid #ddd; width: 85%; font-family: 'Lexend'; margin-bottom: 10px; font-size: 1rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <h2>üó∫Ô∏è B·∫¢N ƒê·ªí KHO B√ÅU (TU·∫¶N 19)</h2>
        <p>T·ªâ s·ªë, t·ªâ s·ªë ph·∫ßn trƒÉm v√† ·ª©ng d·ª•ng t·ªâ l·ªá b·∫£n ƒë·ªì [cite: 1]</p>
    </div>

    <div class="level-map">
        <button id="btn-0" class="lvl-btn active">üèîÔ∏è CH·∫∂NG 1<br>Kh√°m ph√°</button>
        <button id="btn-1" class="lvl-btn">üå≤ CH·∫∂NG 2<br>Luy·ªán t·∫≠p</button>
        <button id="btn-2" class="lvl-btn">üèÜ CH·∫∂NG 3<br>V·ªÅ ƒë√≠ch</button>
    </div>

    <div class="progress-container"><div id="progress" class="progress-bar"></div></div>

    <div id="game-content">
        <div style="display: flex; justify-content: space-between; font-weight: bold; color: #555; margin-bottom: 10px; font-size: 0.9rem;">
            <span id="lvl-title">Kh√°m ph√° [cite: 3]</span>
            <span id="score-display">T·ªïng ƒëi·ªÉm: 0/100</span>
        </div>
        <div class="question-area">
            <p class="q-text" id="q-text">ƒêang t·∫£i...</p>
            <div class="options" id="options"></div>
        </div>
        <div id="robot-hint" class="robot-box hidden">
            <span>ü§ñ:</span> <span id="hint-text"></span>
        </div>
    </div>

    <div id="result-screen" class="hidden" style="text-align: center; padding: 30px 0;">
        <h2 id="final-title">H√†nh tr√¨nh ho√†n t·∫•t!</h2>
        <p id="result-msg" style="font-size: 2.5rem; color: var(--primary); font-weight: bold; margin: 15px 0;"></p>
        <p id="final-advice"></p>
        <div id="save-form" class="hidden">
            <input type="text" id="player-name" class="input-field" placeholder="Nh·∫≠p H·ªç v√† T√™n...">
            <input type="text" id="player-class" class="input-field" placeholder="Nh·∫≠p L·ªõp...">
            <br>
            <button class="action-btn" onclick="saveScoreOnline()">Ghi danh B·∫£ng V√†ng [cite: 121]</button>
        </div>
        <button id="retry-btn" class="action-btn hidden" onclick="location.reload()" style="background: var(--secondary);">Th·ª≠ l·∫°i v√≤ng n√†y ‚Ü∫</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const allQuestionsData = [
        [ // CH·∫∂NG 1: KH√ÅM PH√Å [cite: 3]
            { q: "Tr√™n b·∫£n ƒë·ªì c√≥ 7 v·ªã tr√≠ hang ƒë√° v√† 10 v·ªã tr√≠ r·ª´ng c√¢y. T·ªâ s·ªë c·ªßa s·ªë hang ƒë√° v√† s·ªë r·ª´ng c√¢y l√†: [cite: 5, 6]", a: ["10 : 7", "7 : 10", "7 : 17", "10 : 17"], c: 1, h: "ƒê√°p √°n ƒë√∫ng l√† 7 : 10 [cite: 121]" },
            { q: "T·ªâ s·ªë c·ªßa s·ªë a v√† s·ªë b (b kh√°c 0) l√† a : b hay a/b. T·ªâ s·ªë n√†y cho bi·∫øt ƒëi·ªÅu g√¨? [cite: 11, 12]", a: ["S·ªë a b·∫±ng a/b s·ªë b", "S·ªë b b·∫±ng a/b s·ªë a", "S·ªë a nhi·ªÅu h∆°n s·ªë b l√† a/b ƒë∆°n v·ªã", "S·ªë a k√©m s·ªë b l√† a/b ƒë∆°n v·ªã"], c: 0, h: "S·ªë a b·∫±ng a/b s·ªë b [cite: 121]" },
            { q: "Trong m·ªôt cu·ªôc kh·∫£o s√°t 100 b·∫°n th√¨ c√≥ 43 b·∫°n th√≠ch ƒëi t√¨m kho b√°u. T·ªâ s·ªë ph·∫ßn trƒÉm s·ªë b·∫°n th√≠ch t√¨m kho b√°u l√†: [cite: 17, 18]", a: ["4,3%", "0,43%", "43%", "430%"], c: 2, h: "ƒê√°p √°n l√† 43% [cite: 121]" },
            { q: "ƒê·ªÉ t√≠nh ƒë·ªô d√†i th·∫≠t ngo√†i th·ª±c t·∫ø d·ª±a tr√™n ƒë·ªô d√†i b·∫£n ƒë·ªì v√† t·ªâ l·ªá b·∫£n ƒë·ªì, ta th·ª±c hi·ªán: [cite: 43]", a: ["Chia cho m·∫´u s·ªë t·ªâ l·ªá", "Nh√¢n v·ªõi m·∫´u s·ªë t·ªâ l·ªá", "C·ªông v·ªõi m·∫´u s·ªë t·ªâ l·ªá", "L·∫•y m·∫´u s·ªë chia ƒë·ªô d√†i b·∫£n ƒë·ªì"], c: 1, h: "Nh√¢n ƒë·ªô d√†i b·∫£n ƒë·ªì v·ªõi m·∫´u s·ªë t·ªâ l·ªá [cite: 45, 121]" }
        ],
        [ // CH·∫∂NG 2: LUY·ªÜN T·∫¨P [cite: 48]
            { q: "Chuy·ªÉn ph√¢n s·ªë 9/25 th√†nh t·ªâ s·ªë ph·∫ßn trƒÉm: [cite: 55]", a: ["9%", "36%", "25%", "45%"], c: 1, h: "9/25 = 36/100 = 36% [cite: 122]" },
            { q: "H√≤n ƒë·∫£o c√≥ 100 c√¢y d·ª´a, 92 c√¢y ƒë√£ c√≥ qu·∫£. T·ªâ s·ªë ph·∫ßn trƒÉm s·ªë c√¢y CH∆ØA c√≥ qu·∫£ l√†: [cite: 60, 61]", a: ["8%", "92%", "100%", "18%"], c: 0, h: "S·ªë c√¢y ch∆∞a qu·∫£: 100 - 92 = 8 c√¢y (8%) [cite: 122]" },
            { q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:1000, kho·∫£ng c√°ch ƒëo ƒë∆∞·ª£c 6 cm. ƒê·ªô d√†i th·∫≠t l√†: [cite: 66, 67]", a: ["6 m", "60 m", "600 m", "6 000 m"], c: 1, h: "6 cm x 1000 = 6000 cm = 60 m [cite: 122]" },
            { q: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh: 57% + 43,5% l√†: [cite: 77]", a: ["100%", "10,05%", "100,5%", "90,5%"], c: 2, h: "ƒê√°p √°n l√† 100,5% [cite: 122]" }
        ],
        [ // CH·∫∂NG 3: N√ÇNG CAO [cite: 94]
            { q: "HCN tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:3000 c√≥ d√†i 3cm, r·ªông 2cm. Di·ªán t√≠ch th·∫≠t l√†: [cite: 96, 97]", a: ["6 m¬≤", "180 m¬≤", "5 400 m¬≤", "540 m¬≤"], c: 2, h: "D√†i th·∫≠t 90m, r·ªông th·∫≠t 60m. DT = 5400 m¬≤ [cite: 123]" },
            { q: "Ch·∫∑ng m·ªôt chi·∫øm 30%. Ch·∫∑ng hai d√†i h∆°n ch·∫∑ng m·ªôt 40m v√† chi·∫øm 70%. T·ªïng qu√£ng ƒë∆∞·ªùng: [cite: 113, 114, 115]", a: ["100 m", "140 m", "200 m", "400 m"], c: 0, h: "T·ªïng qu√£ng ƒë∆∞·ªùng l√† 100m [cite: 123]" }
        ]
    ];

    let curLvl = 0, curQ = 0, totalScore = 0;
    let currentLvlQuestions = [];

    function prepareQuestions() {
        currentLvlQuestions = allQuestionsData[curLvl];
        showQuestion();
    }

    function showQuestion() {
        let q = currentLvlQuestions[curQ];
        let totalAnswered = 0;
        if(curLvl === 1) totalAnswered = 4 + curQ;
        else if(curLvl === 2) totalAnswered = 8 + curQ;
        else totalAnswered = curQ;

        document.getElementById('q-text').innerHTML = `<b>C√¢u ${totalAnswered + 1}:</b> ${q.q}`;
        document.getElementById('progress').style.width = (totalAnswered / 10 * 100) + "%";
        
        let html = q.a.map((opt, i) => `<button class="opt" onclick="checkAnswer(${i})">${opt}</button>`).join('');
        document.getElementById('options').innerHTML = html;
        document.getElementById('robot-hint').classList.add('hidden');
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t ch·∫∑ng
        document.querySelectorAll('.lvl-btn').forEach((btn, idx) => {
            btn.classList.toggle('active', idx === curLvl);
        });
        const titles = ["Kh√°m ph√° [cite: 3]", "Luy·ªán t·∫≠p [cite: 48]", "N√¢ng cao [cite: 94]"];
        document.getElementById('lvl-title').innerText = titles[curLvl];
    }

    function checkAnswer(i) {
        let q = currentLvlQuestions[curQ];
        let btns = document.querySelectorAll('.opt');
        btns.forEach(b => b.disabled = true);
        
        if(i === q.c) {
            totalScore += 10;
            btns[i].style.background = "#C8E6C9";
            showRobot("Ch√≠nh x√°c! +10 ƒëi·ªÉm.");
        } else {
            btns[i].style.background = "#FFCDD2";
            btns[q.c].style.background = "#C8E6C9";
            showRobot(q.h);
        }

        setTimeout(() => {
            curQ++;
            if(curQ < currentLvlQuestions.length) {
                showQuestion();
                updateScoreDisplay();
            } else {
                if(curLvl < 2) {
                    curLvl++; curQ = 0;
                    prepareQuestions();
                    updateScoreDisplay();
                } else {
                    showFinalResult();
                }
            }
        }, 2000);
    }

    function updateScoreDisplay() {
        document.getElementById('score-display').innerText = `T·ªïng ƒëi·ªÉm: ${totalScore}/100`;
    }

    function showRobot(m) {
        document.getElementById('robot-hint').classList.remove('hidden');
        document.getElementById('hint-text').innerText = m;
    }

    function showFinalResult() {
        document.getElementById('game-content').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('result-msg').innerText = `${totalScore} ƒêI·ªÇM`;
        document.getElementById('progress').style.width = "100%";

        if(totalScore >= 50) {
            document.getElementById('final-title').innerText = "Ch√∫c m·ª´ng! üèÜ";
            document.getElementById('final-advice').innerText = "B·∫°n ƒë√£ ho√†n th√†nh v√≤ng ch∆°i xu·∫•t s·∫Øc.";
            document.getElementById('save-form').classList.remove('hidden');
        } else {
            document.getElementById('final-title').innerText = "C·∫ßn c·ªë g·∫Øng h∆°n! üòü";
            document.getElementById('final-advice').innerText = "B·∫°n c·∫ßn √≠t nh·∫•t 50 ƒëi·ªÉm ƒë·ªÉ ghi danh.";
            document.getElementById('retry-btn').classList.remove('hidden');
        }
    }

    function saveScoreOnline() {
        const name = document.getElementById('player-name').value.trim();
        const className = document.getElementById('player-class').value.trim();
        if (!name || !className) { alert("Nh·∫≠p t√™n v√† l·ªõp nh√©!"); return; }
        
        const userKey = (className + "_" + name).replace(/[\s\/.\#\$\[\]]/g, '_');
        db.ref('scores/Tuan_19_Ban_Do_Kho_Bau/' + userKey).set({
            fullName: name, className: "'" + className, score: totalScore,
            date: new Date().toLocaleString('vi-VN'), timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            alert("ƒê√£ ghi danh B·∫£ng V√†ng!");
            location.reload();
        });
    }

    window.onload = () => { prepareQuestions(); };
</script>
</body>
</html>
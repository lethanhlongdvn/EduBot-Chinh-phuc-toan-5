<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫°i h·ªôi To√°n h·ªçc - Tu·∫ßn 22</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #2c3e50; --screen-bg: #f8f9fa; --btn-gray: #ecf0f1; --btn-orange: #f39c12; --danger: #e74c3c; --success: #2ecc71; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; background: #34495e; color: white; user-select: none; overflow-x: hidden; min-height: 100vh; }
        
        /* Container ch√≠nh */
        .game-container { max-width: 700px; width: 100%; background: var(--primary); padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 4px solid #1a252f; position: relative; margin-bottom: 20px; }
        
        /* Toast th√¥ng b√°o */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.2rem; z-index: 1000; transition: opacity 0.3s, top 0.3s; opacity: 0; pointer-events: none; }
        .toast-true { background: var(--success); color: white; opacity: 1 !important; top: 50px !important; }
        .toast-false { background: var(--danger); color: white; opacity: 1 !important; top: 50px !important; }

        .screen { background: var(--screen-bg); border-radius: 12px; padding: 20px; margin-bottom: 25px; color: #1e272e; border: 5px solid #bdc3c7; min-height: 120px; }
        .screen-header { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-bottom: 10px; color: #7f8c8d; }
        .q-text { font-size: 1.1rem; font-weight: 600; line-height: 1.5; }
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; font-size: 0.9rem; color: #ecf0f1; width: 100%; max-width: 700px; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { background: var(--btn-gray); border: none; padding: 15px; border-radius: 10px; font-family: 'Lexend'; font-weight: bold; cursor: pointer; border-bottom: 4px solid #bdc3c7; transition: 0.2s; font-size: 0.95rem; color: #2c3e50; }
        .opt-btn:hover { background: white; transform: translateY(-2px); }
        
        .input-area { display: flex; flex-direction: column; gap: 15px; }
        .ans-input { padding: 15px; border-radius: 10px; border: none; font-size: 1.1rem; font-family: 'Lexend'; text-align: center; color: #2c3e50; }
        .hidden { display: none; }
        .action-btn { background: var(--btn-orange); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        
        /* Ch√¢n trang y√™u c·∫ßu */
        .footer-edu { text-align: center; width: 100%; padding: 20px 0; color: #bdc3c7; font-size: 0.9rem; letter-spacing: 1px; margin-top: auto; }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="status-bar">
    <span id="stage-name">V√íNG 1: KH√ÅM PH√Å</span>
    <span id="score-display">ƒêI·ªÇM: 0</span>
</div>

<div class="game-container">
    <div class="screen">
        <div class="screen-header">
            <span>ƒê·∫†I H·ªòI TO√ÅN H·ªåC</span>
            <span id="lives-count">‚ù§Ô∏è M·∫†NG: 3/3</span>
        </div>
        <div id="q-content" class="q-text">ƒêang chu·∫©n b·ªã b√†i thi...</div>
    </div>

    <div id="play-area"></div>

    <div id="result-screen" class="hidden" style="text-align: center;">
        <h2>K·∫æT QU·∫¢ CHUNG CU·ªòC</h2>
        <h1 id="final-score" style="font-size: 4rem; color: var(--btn-orange); margin: 10px 0;">0 ƒêI·ªÇM</h1>
        <div id="save-form" class="hidden">
            <input type="text" id="p-name" style="width: 85%; padding: 15px; margin-bottom: 10px; border-radius: 10px;" placeholder="H·ªç v√† t√™n...">
            <input type="text" id="p-class" style="width: 85%; padding: 15px; margin-bottom: 20px; border-radius: 10px;" placeholder="L·ªõp...">
            <button class="action-btn" style="width:90%;" onclick="saveData()">GHI DANH B·∫¢NG V√ÄNG</button>
        </div>
        <button id="retry-btn" class="action-btn" style="background:#7f8c8d; margin-top:20px;" onclick="location.reload()">TH·ª¨ L·∫†I</button>
    </div>
</div>

<div class="footer-edu">
    ¬© 2026 EduRobot - L√™ Th√†nh Long
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // D·ªØ li·ªáu c√¢u h·ªèi
    const POOL1 = [
        {q: "T·ªâ s·ªë c·ªßa s·ªë a v√† s·ªë b (b kh√°c 0) cho bi·∫øt ƒëi·ªÅu g√¨?", opts: ["S·ªë b b·∫±ng m·∫•y ph·∫ßn s·ªë a", "Hi·ªáu gi·ªØa s·ªë a v√† b", "S·ªë a b·∫±ng m·∫•y ph·∫ßn s·ªë b", "T·ªïng c·ªßa s·ªë a v√† b"], c: 2},
        {q: "T·ªâ s·ªë ph·∫ßn trƒÉm 43/100 ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng k√Ω hi·ªáu l√†:", opts: ["0,43%", "4,3%", "43%", "430%"], c: 2},
        {q: "B·∫£n ƒë·ªì t·ªâ l·ªá 1 : 10.000 cho bi·∫øt ƒëi·ªÅu g√¨?", opts: ["H√¨nh th·∫≠t thu nh·ªè 10.000 l·∫ßn", "ƒê·ªô th·∫≠t b·∫±ng 1/10.000 b·∫£n ƒë·ªì", "B·∫£n ƒë·ªì ph√≥ng to 10.000 l·∫ßn", "1 cm b·∫£n ƒë·ªì l√† 10.000 m th·∫≠t"], c: 0},
        {q: "ƒê·ªÉ t√≠nh ƒë·ªô d√†i th·∫≠t, ta l√†m nh∆∞ sau:", opts: ["L·∫•y b·∫£n ƒë·ªì chia t·ªâ l·ªá", "Tr·ª´ m·∫´u s·ªë t·ªâ l·ªá", "Nh√¢n b·∫£n ƒë·ªì v·ªõi m·∫´u s·ªë t·ªâ l·ªá", "Chia m·∫´u s·ªë t·ªâ l·ªá cho b·∫£n ƒë·ªì"], c: 2},
        {q: "Khi h√¨nh l·∫≠p ph∆∞∆°ng n·∫±m trong h√¨nh h·ªôp ch·ªØ nh·∫≠t th√¨:", opts: ["Th·ªÉ t√≠ch l·∫≠p ph∆∞∆°ng l·ªõn h∆°n", "Th·ªÉ t√≠ch hai h√¨nh b·∫±ng nhau", "Th·ªÉ t√≠ch l·∫≠p ph∆∞∆°ng b√© h∆°n", "Kh√¥ng so s√°nh ƒë∆∞·ª£c"], c: 2},
        {q: "N·∫øu h√¨nh P t√°ch th√†nh hai h√¨nh M v√† N, th·ªÉ t√≠ch P l√†:", opts: ["T√≠ch th·ªÉ t√≠ch M v√† N", "Hi·ªáu th·ªÉ t√≠ch M v√† N", "T·ªïng th·ªÉ t√≠ch M v√† N", "Trung b√¨nh c·ªông M v√† N"], c: 2},
        {q: "M·ªôt h√¨nh h·ªôp ch·ªØ nh·∫≠t ti√™u chu·∫©n c√≥ bao nhi√™u k√≠ch th∆∞·ªõc?", opts: ["M·ªôt", "Hai", "Ba", "S√°u"], c: 2},
        {q: "So s√°nh th·ªÉ t√≠ch hai h√¨nh gh√©p b·ªüi c√°c kh·ªëi nh·ªè b·∫±ng c√°ch:", opts: ["ƒê·∫øm s·ªë l∆∞·ª£ng kh·ªëi nh·ªè", "ƒêo chi·ªÅu d√†i", "C√¢n kh·ªëi l∆∞·ª£ng", "Quan s√°t m·∫Øt"], c: 0}
    ];

    const POOL2 = [
        {q: "Chuy·ªÉn ph√¢n s·ªë 3/4 th√†nh t·ªâ s·ªë ph·∫ßn trƒÉm:", opts: ["34%", "0,75%", "75%", "3,4%"], c: 2},
        {q: "B·∫£n ƒë·ªì t·ªâ l·ªá 1 : 2.000, ƒë·ªô d√†i 2 cm ·ª©ng v·ªõi ƒë·ªô d√†i th·∫≠t l√†:", opts: ["4 m", "40 m", "400 m", "4.000 m"], c: 1},
        {q: "T·ªïng hai s·ªë l√† 60, t·ªâ s·ªë l√† 7/8. S·ªë l·ªõn l√†:", opts: ["28", "32", "35", "40"], c: 1},
        {q: "Ti vi gi√° 15.000.000 ƒë·ªìng, gi·∫£m gi√° 8%. S·ªë ti·ªÅn gi·∫£m l√†:", opts: ["120.000 ƒë·ªìng", "1.200.000 ƒë·ªìng", "1.500.000 ƒë·ªìng", "800.000 ƒë·ªìng"], c: 1},
        {q: "H√¨nh C c√≥ 12 kh·ªëi l·∫≠p ph∆∞∆°ng, h√¨nh D c√≥ 10 kh·ªëi. Ph√°t bi·ªÉu ƒë√∫ng:", opts: ["Th·ªÉ t√≠ch C > D", "Th·ªÉ t√≠ch D > C", "B·∫±ng nhau", "D nhi·ªÅu kh·ªëi h∆°n C"], c: 0},
        {q: "T√≠nh 2% c·ªßa s·ªë 250:", opts: ["50", "25", "5", "0,5"], c: 2}
    ];

    const POOL3 = [
        {q: "Th·ª≠a ƒë·∫•t t·ªâ l·ªá 1:3000 c√≥ d√†i 3cm, r·ªông 2cm. T√≠nh di·ªán t√≠ch th·∫≠t (m¬≤):", a: "5400"},
        {q: "T·ªâ s·ªë k·∫πo Mi/Mai l√† 5/2. Mi h∆°n Mai 6 c√°i. T·ªïng k·∫πo hai b·∫°n l√†:", a: "14"},
        {q: "Th√πng xe 33,2 m¬≥. H√†ng chi·∫øm 80%. Th·ªÉ t√≠ch ph·∫ßn tr·ªëng (m¬≥) l√†:", a: "6.64"}
    ];

    let score = 0, stage = 1, qIdx = 0, lives = 3;
    let game1, game2, game3;

    function shuffle(arr) { return arr.sort(() => 0.5 - Math.random()); }

    function showToast(isCorrect) {
        const toast = document.getElementById('toast');
        toast.innerText = isCorrect ? "CH√çNH X√ÅC! üéâ" : "CH∆ØA ƒê√öNG R·ªíI! ‚ùå";
        toast.className = isCorrect ? "toast-true" : "toast-false";
        setTimeout(() => { toast.className = ""; }, 1000);
    }

    function initGame() {
        game1 = shuffle([...POOL1]).slice(0, 4);
        game2 = shuffle([...POOL2]).slice(0, 4);
        game3 = shuffle([...POOL3]).slice(0, 2);
        renderStage();
    }

    function renderStage() {
        qIdx = 0;
        document.getElementById('stage-name').innerText = stage === 1 ? "V√íNG 1: KH√ÅM PH√Å" : (stage === 2 ? "V√íNG 2: LUY·ªÜN T·∫¨P" : "V√íNG 3: N√ÇNG CAO");
        if(stage > 1) document.getElementById('lives-count').classList.add('hidden');
        renderQ();
    }

    function renderQ() {
        let data = stage === 1 ? game1 : (stage === 2 ? game2 : game3);
        let item = data[qIdx];
        document.getElementById('q-content').innerHTML = `<b>C√¢u ${qIdx+1}:</b> ${item.q}`;
        let html = '';
        if(stage < 3) {
            html = '<div class="options-grid">';
            item.opts.forEach((o, i) => html += `<button class="opt-btn" onclick="check(${i})">${o}</button>`);
            html += '</div>';
        } else {
            html = `<div class="input-area"><input type="text" id="ans" class="ans-input" placeholder="Nh·∫≠p s·ªë..."><button class="action-btn" onclick="checkTuluan()">G·ª¨I ƒê√ÅP √ÅN</button></div>`;
        }
        document.getElementById('play-area').innerHTML = html;
    }

    function check(idx) {
        let item = (stage === 1) ? game1[qIdx] : game2[qIdx];
        if(idx === item.c) { score += 10; showToast(true); }
        else {
            showToast(false);
            if(stage === 1) { lives--; document.getElementById('lives-count').innerText = `‚ù§Ô∏è M·∫†NG: ${lives}/3`; }
        }
        document.getElementById('score-display').innerText = "ƒêI·ªÇM: " + score;
        setTimeout(next, 1100);
    }

    function checkTuluan() {
        let userAns = document.getElementById('ans').value.trim().replace(',', '.');
        if(userAns == game3[qIdx].a) { score += 30; showToast(true); }
        else { showToast(false); }
        document.getElementById('score-display').innerText = "ƒêI·ªÇM: " + score;
        setTimeout(next, 1100);
    }

    function next() {
        qIdx++;
        let data = stage === 1 ? game1 : (stage === 2 ? game2 : game3);
        if(qIdx < data.length) renderQ();
        else if(stage < 3 && lives > 0) { stage++; renderStage(); }
        else finish();
    }

    function finish() {
        document.getElementById('play-area').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = score + " ƒêI·ªÇM";
        if(score >= 50) document.getElementById('save-form').classList.remove('hidden');
    }

    function saveData() {
        const name = document.getElementById('p-name').value;
        const cls = document.getElementById('p-class').value;
        if(!name || !cls) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin em nh√©!");
        db.ref('scores/tuan22/' + Date.now()).set({ name, class: cls, score, year: 2026 })
        .then(() => { alert("ƒê√£ ghi danh!"); location.reload(); });
    }

    window.onload = initGame;
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√îN T·∫¨P TU·∫¶N 34 - CHINH PH·ª§C ƒê·ªàNH CAO</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Lexend:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #0984e3;
            /* Deep Azure */
            --dark: #2d3436;
            --light: #f1f2f6;
            --accent: #55efc4;
            /* Mountain Spring Green */
            --correct: #00b894;
            --wrong: #d63031;
            --bg: #dfe6e9;
            --silver: #b2bec3;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, #0984e3 0%, #2d3436 100%);
            color: white;
            margin: 0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            padding-bottom: 40px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 20px;
            border: 3px solid var(--accent);
            text-align: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--accent);
            text-transform: uppercase;
            font-family: 'Bungee';
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #000;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            color: #fff;
            font-weight: 600;
            padding: 10px 15px;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .game-stage {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            min-height: 350px;
            position: relative;
            color: var(--dark);
        }

        .stage-label {
            background: var(--primary);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-family: 'Bungee';
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9rem;
            box-shadow: 0 4px 0 #0652dd;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            min-height: 80px;
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .opt-btn {
            background: #f1f2f6;
            border: 2px solid #b2bec3;
            padding: 18px;
            border-radius: 15px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.05rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 70px;
            box-shadow: 0 5px 0 #636e72;
        }

        .opt-btn:hover {
            transform: translateY(-2px);
            background: #fff;
        }

        .opt-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #636e72;
        }

        .opt-btn.correct {
            background: var(--correct);
            border-color: #009432;
            color: white;
            box-shadow: 0 5px 0 #006266;
        }

        .opt-btn.wrong {
            background: var(--wrong);
            border-color: #c0392b;
            color: white;
            box-shadow: 0 5px 0 #922b21;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: #dfe6e9;
            border-radius: 6px;
            margin-top: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.5s ease;
        }

        #result-screen {
            text-align: center;
            padding: 50px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            border: 2px solid var(--accent);
            color: white;
        }

        .trophy {
            font-size: 6rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--accent));
            animation: pulse 2.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        .final-score {
            font-size: 4rem;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 3px 3px 0 #000;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        .btn-restart {
            padding: 15px 40px;
            background: var(--accent);
            border: none;
            border-radius: 50px;
            color: #2d3436;
            font-weight: 800;
            font-family: 'Bungee';
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 6px 0 #00b894;
            margin-top: 30px;
        }

        .game-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 0;
            text-align: center;
            font-size: 0.7rem;
            color: #ccc;
            z-index: 1000;
        }

        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .btn-start {
            background: var(--primary);
            color: white;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Bungee';
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 0 #0652dd;
            text-transform: uppercase;
            margin-top: 20px;
            border: 2px solid var(--accent);
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #0652dd;
            filter: brightness(1.2);
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.1rem;
            }

            .question-box {
                font-size: 1rem;
            }

            .opt-btn {
                font-size: 0.95rem;
                padding: 12px;
                min-height: 50px;
            }
        }
    </style>
</head>

<body>
    <div id="start-screen">
        <h1
            style="color: var(--accent); font-size: 2.2rem; font-family: 'Bungee'; text-align: center; text-shadow: 2px 2px 0 #000;">
            TU·∫¶N 34: CHINH PH·ª§C ƒê·ªàNH CAO</h1>
        <p id="welcome-msg" style="margin-bottom: 20px; font-weight: bold; color: white;"></p>
        <button class="btn-start" onclick="startGame()">B·∫ÆT ƒê·∫¶U LEO N√öI</button>
    </div>

    <div class="container hidden" id="game-ui">
        <div class="header">
            <h1>√îN T·∫¨P TU·∫¶N 34 - TO√ÅN L·ªöP 5</h1>
            <p style="margin: 5px 0; color: var(--accent); font-weight: bold; font-size: 0.85rem;">√îN T·∫¨P T·ªîNG H·ª¢P -
                GIAI ƒêO·∫†N 1</p>
            <div class="info-bar">
                <span>üë§ <b id="user-name">---</b></span>
                <span>üè´ <b id="user-class">---</b></span>
                <span>‚≠ê <b id="current-score" style="color:var(--accent)">0</b>/100</span>
                <span>‚è≥ <b id="timer">00:00</b></span>
            </div>
        </div>

        <div class="game-stage">
            <div id="stage-info">
                <div class="stage-label" id="stage-label">V√íNG 1: KH√ÅM PH√Å</div>
                <div class="question-box" id="q-content">ƒêang chu·∫©n b·ªã c√¢u h·ªèi...</div>
            </div>

            <div id="interaction-area" class="options-grid"></div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#636e72; margin-top:8px; font-weight: 600;">Ti·∫øn ƒë·ªô:
                <span id="progress-text">0/13</span>
            </div>
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <div class="trophy">üèîÔ∏è</div>
        <h2>ƒê√É CH·∫†M ƒê·ªàNH CAO!</h2>
        <div class="final-score" id="final-score">0</div>
        <p style="font-size: 1.2rem;">Th·ªùi gian th√°m hi·ªÉm: <b id="final-time-text"
                style="color: var(--accent);">--:--</b></p>
        <p id="save-msg" style="color:var(--accent); font-weight:bold; margin-top:20px;">ƒêang k·∫øt n·ªëi h·ªá th·ªëng...</p>
        <p id="redirect-msg" style="color:#aaa; font-size:0.9rem;">S·∫Ω quay l·∫°i b·∫£n ƒë·ªì trong gi√¢y l√°t...</p>
        <button class="btn-restart" onclick="location.reload()">CH∆†I L·∫†I</button>
    </div>

    <div class="game-footer">¬© 2026 EduBot - Chinh ph·ª•c To√°n 5 - Thi·∫øt k·∫ø b·ªüi L√™ Th√†nh Long</div>

    <script>
        const firebaseConfig = { databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const savedName = localStorage.getItem('studentName') || "Ng∆∞·ªùi ch∆°i";
        const savedClass = localStorage.getItem('studentClass') || "---";
        const savedSchool = localStorage.getItem('studentSchool') || "---";

        let isPlaying = false;
        let startTime;

        window.onload = () => {
            if (!localStorage.getItem('studentName') || !localStorage.getItem('studentClass')) {
                document.getElementById('welcome-msg').innerHTML = "<b style='color:red'>‚ö†Ô∏è Em c·∫ßn ƒëƒÉng k√Ω ·ªü b·∫£n ƒë·ªì tr∆∞·ªõc!</b>";
                document.querySelector('#start-screen .btn-start').onclick = () => window.location.href = "index.html";
            } else {
                document.getElementById('welcome-msg').innerText = `Th√≠ sinh: ${savedName} - L·ªõp ${savedClass}`;
                document.getElementById('user-name').innerText = savedName;
                document.getElementById('user-class').innerText = savedClass;
            }
        };

        function startGame() {
            isPlaying = true;
            startTime = Date.now();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            initGame();
            startTimer();
        }

        const questions = {
            r1: [
                { q: "Trong s·ªë 3 461 285, ch·ªØ s·ªë 2 thu·ªôc h√†ng n√†o?", a: ["H√†ng tri·ªáu", "H√†ng ch·ª•c ngh√¨n", "H√†ng trƒÉm", "H√†ng ƒë∆°n v·ªã"], c: "H√†ng trƒÉm" },
                { q: "S·ªë 'Ba tri·ªáu, b·ªën trƒÉm s√°u m∆∞∆°i ngh√¨n, m·ªôt trƒÉm hai m∆∞∆°i t√°m' vi·∫øt l√†:", a: ["3 460 028", "346 128", "3 460 128", "3 046 128"], c: "3 460 128" },
                { q: "S·ªë n√†o b√© nh·∫•t: 67 245; 67 425; 67 524; 65 742?", a: ["67 245", "67 425", "65 742", "67 524"], c: "65 742" },
                { q: "Ph√¢n s·ªë n√†o sau ƒë√¢y b·∫±ng ph√¢n s·ªë 2/3?", a: ["4/8", "6/18", "16/24", "8/9"], c: "16/24" },
                { q: "H√¨nh vu√¥ng chia 8 ph·∫ßn, t√¥ m√†u 5 ph·∫ßn. Ph√¢n s·ªë ch·ªâ ph·∫ßn t√¥ m√†u l√†:", a: ["8/5", "5/8", "3/8", "1/2"], c: "5/8" },
                { q: "S·ªë 'S√°u m∆∞∆°i ƒë∆°n v·ªã, 5 ph·∫ßn m∆∞·ªùi, 7 ph·∫ßn trƒÉm, 2 ph·∫ßn ngh√¨n' vi·∫øt l√†:", a: ["6,572", "60,572", "60,0572", "65,72"], c: "60,572" },
                { q: "ƒê·ªïi 5 m 8 dm sang m√©t (s·ªë th·∫≠p ph√¢n):", a: ["5,08 m", "5,8 m", "58 m", "0,58 m"], c: "5,8 m" },
                { q: "S·ªë th·∫≠p ph√¢n l·ªõn nh·∫•t: 70,571; 70,517; 71,057; 70,715?", a: ["70,571", "70,715", "71,057", "70,517"], c: "71,057" },
                { q: "ƒê·ªïi 425 g sang ƒë∆°n v·ªã ki-l√¥-gam:", a: ["4,25 kg", "42,5 kg", "0,425 kg", "0,0425 kg"], c: "0,425 kg" },
                { q: "Ch·ªØ s·ªë 7 trong s·ªë 71,057 c√≥ gi√° tr·ªã l√† g√¨ (ch·ªçn √Ω ƒë√∫ng nh·∫•t)?", a: ["7 ƒë∆°n v·ªã", "7 ph·∫ßn m∆∞·ªùi", "7 ch·ª•c", "C·∫£ ch·ª•c v√† ph·∫ßn ngh√¨n"], c: "C·∫£ ch·ª•c v√† ph·∫ßn ngh√¨n" },
                { q: "Ph√¢n s·ªë th·∫≠p ph√¢n 317/100 vi·∫øt d∆∞·ªõi d·∫°ng h·ªón s·ªë l√†:", a: ["1 217/100", "2 117/100", "3 17/100", "31 7/100"], c: "3 17/100" },
                { q: "85 ml = ... l. S·ªë th·∫≠p ph√¢n th√≠ch h·ª£p l√†:", a: ["0,85", "0,085", "8,5", "0,0085"], c: "0,085" },
                { q: "RB V√†ng (1,02m), ƒê·ªè (0,89m), Xanh (98cm). B·∫°n n√†o cao nh·∫•t?", a: ["R√¥-b·ªët V√†ng", "R√¥-b·ªët ƒê·ªè", "R√¥-b·ªët Xanh", "Ba b·∫°n b·∫±ng nhau"], c: "R√¥-b·ªët V√†ng" },
                { q: "Gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c 175 - (59,3 + 35,7) l√†:", a: ["90", "80", "115,7", "100"], c: "80" },
                { q: "S·ªë th·∫≠p ph√¢n 0,75 t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë n√†o?", a: ["1/4", "1/2", "3/4", "2/3"], c: "3/4" },
                { q: "L√†m tr√≤n s·ªë 105 362 480 ƒë·∫øn h√†ng ngh√¨n:", a: ["105 363 000", "105 362 000", "105 360 000", "105 400 000"], c: "105 362 000" },
                { q: "Ph√¢n s·ªë n√†o sau ƒë√¢y t·ªëi gi·∫£n?", a: ["15/21", "20/35", "3/4", "72/120"], c: "3/4" },
                { q: "S·ªë th·∫≠p ph√¢n g·ªìm 4 trƒÉm, 5 ƒë∆°n v·ªã v√† 6 ph·∫ßn m∆∞·ªùi l√†:", a: ["45,6", "405,06", "405,6", "450,6"], c: "405,6" },
                { q: "Hi·ªáu c·ªßa hai s·ªë 981 759 v√† 645 267 l√†:", a: ["336 482", "336 492", "336 592", "346 492"], c: "336 492" },
                { q: "S·ªë t·ª± nhi√™n b√© nh·∫•t l√†:", a: ["0", "1", "Kh√¥ng c√≥", "10"], c: "0" }
            ],
            r2: [
                { q: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh 148,32 + 270,84 l√†:", a: ["418,16", "419,16", "419,26", "420,16"], c: "419,16" },
                { q: "T√≠nh nhanh: 137 x 25 + 137 x 75 = ?", a: ["13 775", "1 370", "13 700", "137 000"], c: "13 700" },
                { q: "Th√πng 20 h·ªôp, 12 h·ªôp kh√¥ng ƒë∆∞·ªùng. T·ªâ s·ªë % s·ªØa C√ì ƒë∆∞·ªùng l√†:", a: ["60%", "40%", "12%", "8%"], c: "40%" },
                { q: "G·ª≠i 10tr l√£i 0,5%/th√°ng. Sau 1 th√°ng l√£i bao nhi√™u?", a: ["5 000ƒë", "500 000ƒë", "50 000ƒë", "10 050 000ƒë"], c: "50 000ƒë" },
                { q: "K·∫øt qu·∫£ c·ªßa ph√©p chia 2 625 : 15 l√†:", a: ["15", "175", "185", "275"], c: "175" },
                { q: "14 gi·ªù 36 ph√∫t + 5 gi·ªù 15 ph√∫t = ?", a: ["19 gi·ªù 41 ph√∫t", "19 gi·ªù 51 ph√∫t", "20 gi·ªù 1 ph√∫t", "19 gi·ªù 36 ph√∫t"], c: "19 gi·ªù 51 ph√∫t" },
                { q: "ƒêi 1,49 km trong 3 ph√∫t. V·∫≠n t·ªëc x·∫•p x·ªâ l√†:", a: ["0,5 km/p", "0,496 km/p", "1 km/p", "10 m/s"], c: "0,496 km/p" },
                { q: "S·ªë 0,652 vi·∫øt d∆∞·ªõi d·∫°ng t·ªâ s·ªë ph·∫ßn trƒÉm l√†:", a: ["6,52%", "65,2%", "0,0652%", "652%"], c: "65,2%" },
                { q: "K·∫øt qu·∫£ ph√©p t√≠nh 34,6 x 5,7 l√†:", a: ["197,22", "196,22", "34,657", "200"], c: "197,22" },
                { q: "38,5 ph√∫t : 5 = ?", a: ["7,5 ph√∫t", "7,7 ph√∫t", "7,9 ph√∫t", "8,7 ph√∫t"], c: "7,7" }, // Wait, user said B which is 7.7.
                { q: "ƒê·ªïi 2 kg 45 g sang kg (s·ªë th·∫≠p ph√¢n):", a: ["2,45", "2,045", "20,45", "2,0045"], c: "2,045" },
                { q: "Xe m√°y ƒëi 24 km h·∫øt 15 ph√∫t. V·∫≠n t·ªëc km/gi·ªù l√†:", a: ["80 km/h", "96 km/h", "60 km/h", "120 km/h"], c: "96 km/h" },
                { q: "Trong bi·ªÉu th·ª©c (124,46 + 98,31) + 75,54, n√™n nh√≥m s·ªë n√†o?", a: ["124,46 + 75,54", "98,31 + 75,54", "Kh√¥ng nh√≥m ƒë∆∞·ª£c", "124 + 98"], c: "124,46 + 75,54" },
                { q: "Mai (5 ph·∫ßn), Mi (2 ph·∫ßn). Mai h∆°n Mi 6 c√°i. Mi c√≥ m·∫•y c√°i k·∫πo?", a: ["4 c√°i", "10 c√°i", "14 c√°i", "6 c√°i"], c: "4 c√°i" },
                { q: "10 gi·ªù 15 ph√∫t - 6 gi·ªù 30 ph√∫t = ?", a: ["4 gi·ªù 15 ph√∫t", "3 gi·ªù 45 ph√∫t", "3 gi·ªù 15 ph√∫t", "4 gi·ªù 45 ph√∫t"], c: "3 gi·ªù 45 ph√∫t" },
                { q: "T√≠nh 5% c·ªßa 780 000, ta l√†m th·∫ø n√†o?", a: ["780 000 : 5", "780 000 x 5 : 100", "780 000 : 100", "780 000 x 5"], c: "780 000 x 5 : 100" },
                { q: "Mua 3 v·ªü gi√° 7600ƒë, 5 v·ªü gi√° 6000ƒë. Trung b√¨nh gi√° 1 quy·ªÉn l√†:", a: ["6 800ƒë", "6 600ƒë", "7 000ƒë", "6 500ƒë"], c: "6 600ƒë" },
                { q: "K·∫øt qu·∫£ 0,5 : 100 l√†:", a: ["0,05", "0,005", "50", "0,5"], c: "0,005" },
                { q: "15% c·ªßa 1000 chi·∫øc √°o l√† bao nhi√™u chi·∫øc?", a: ["150 chi·∫øc", "15 chi·∫øc", "500 chi·∫øc", "850 chi·∫øc"], c: "150 chi·∫øc" },
                { q: "K·∫øt qu·∫£ c·ªßa 2 tu·∫ßn 5 ng√†y x 7 l√†:", a: ["14 tu·∫ßn 35 ng√†y", "19 tu·∫ßn", "17 tu·∫ßn", "20 tu·∫ßn"], c: "19 tu·∫ßn" }
            ],
            r3: [
                { q: "Tam gi√°c ƒë√°y 14 cm, cao 10 cm. Di·ªán t√≠ch l√†:", a: ["70 cm¬≤", "140 cm¬≤", "24 cm¬≤", "35 cm¬≤"], c: "70 cm¬≤" },
                { q: "H√¨nh thang ƒë√°y 12 cm, 8 cm; cao 8 cm. Di·ªán t√≠ch l√†:", a: ["160 cm¬≤", "80 cm¬≤", "40 cm¬≤", "96 cm¬≤"], c: "80 cm¬≤" },
                { q: "H√¨nh tr√≤n b√°n k√≠nh 5 cm. Chu vi h√¨nh tr√≤n ƒë√≥ l√†:", a: ["15,7 cm", "31,4 cm", "78,5 cm", "25 cm"], c: "31,4 cm" },
                { q: "H√¨nh M (c·∫°nh 5cm) v√† h√¨nh N (10x3x4cm). H√¨nh n√†o c√≥ S to√†n ph·∫ßn l·ªõn h∆°n?", a: ["H√¨nh M l·ªõn h∆°n", "H√¨nh N l·ªõn h∆°n", "Hai h√¨nh b·∫±ng nhau", "Kh√¥ng r√µ"], c: "H√¨nh N l·ªõn h∆°n" },
                { q: "Th·ªÉ t√≠ch kh·ªëi l·∫≠p ph∆∞∆°ng c·∫°nh 5 cm l√†:", a: ["25 cm¬≥", "100 cm¬≥", "125 cm¬≥", "150 cm¬≥"], c: "125 cm¬≥" },
                { q: "B√°o sƒÉn ch·∫°y 120 km/h. Trong 24 ph√∫t n√≥ ƒëi ƒë∆∞·ª£c:", a: ["5 km", "48 km", "2880 km", "50 km"], c: "48 km" },
                { q: "B·ªÉ c√° chu vi ƒë√°y 320 cm, r·ªông = 3/5 d√†i. Chi·ªÅu d√†i ƒë√°y b·ªÉ l√†:", a: ["60 cm", "80 cm", "100 cm", "120 cm"], c: "100 cm" },
                { q: "B·ªÉ cao 50 cm, n∆∞·ªõc ƒëang 40 cm. N∆∞·ªõc chi·∫øm bao nhi√™u % th·ªÉ t√≠ch b·ªÉ?", a: ["90%", "80%", "75%", "40%"], c: "80%" },
                { q: "Taxi h·∫øt 2 gi·ªù, th·ªùi gian taxi = 2/3 xe bu√Ωt. Xe bu√Ωt ƒëi h·∫øt:", a: ["4/3 gi·ªù", "3 gi·ªù", "1,5 gi·ªù", "2,5 gi·ªù"], c: "3 gi·ªù" },
                { q: "Di·ªán t√≠ch 10 000 km¬≤, d√¢n s·ªë 800 000 ng∆∞·ªùi. M·∫≠t ƒë·ªô d√¢n s·ªë l√†:", a: ["8 ng∆∞·ªùi/km¬≤", "80 ng∆∞·ªùi/km¬≤", "800 ng∆∞·ªùi/km¬≤", "8000 ng∆∞·ªùi/km¬≤"], c: "80 ng∆∞·ªùi/km¬≤" },
                { q: "TƒÉng m·∫≠t ƒë·ªô t·ª´ 80 l√™n 90/km¬≤ tr√™n 10 000 km¬≤. D√¢n s·ªë ph·∫£i tƒÉng:", a: ["10 000 ng∆∞·ªùi", "100 000 ng∆∞·ªùi", "1 000 ng∆∞·ªùi", "900 000 ng∆∞·ªùi"], c: "100 000 ng∆∞·ªùi" },
                { q: "D·ª±a v√†o b·∫£ng huy ch∆∞∆°ng, m√¥n n√†o c√≥ nhi·ªÅu HCV nh·∫•t?", a: ["V·∫≠t (17)", "B∆°i (11)", "L·∫∑n (10)", "Wushu (10)"], c: "V·∫≠t (17)" },
                { q: "T·ªïng huy ch∆∞∆°ng Wushu (10 V√†ng, 3 B·∫°c, 7 ƒê·ªìng) l√†:", a: ["10", "13", "20", "17"], c: "20" },
                { q: "Kh·ªëi ƒë√° 1m¬≥ n·∫∑ng 2,75 t·∫•n. Kh·ªëi 0,4m¬≥ n·∫∑ng bao nhi√™u t·∫•n?", a: ["11 t·∫•n", "1,1 t·∫•n", "110 kg", "1,1 kg"], c: "1,1 t·∫•n" },
                { q: "ƒêo√†n t√†u ƒëi t·ª´ 6h10p ƒë·∫øn 10h40p. Th·ªùi gian ƒëi l√†:", a: ["4 gi·ªù", "4 gi·ªù 20 ph√∫t", "4 gi·ªù 30 ph√∫t", "5 gi·ªù"], c: "4 gi·ªù 30 ph√∫t" },
                { q: "C√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch h√¨nh h·ªôp ch·ªØ nh·∫≠t l√†:", a: ["V = a x b x c", "V = a x a x a", "V = (a+b) x 2 x c", "V = a x b"], c: "V = a x b x c" },
                { q: "H√¨nh khai tri·ªÉn c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng g·ªìm bao nhi√™u h√¨nh vu√¥ng?", a: ["4", "5", "6", "8"], c: "6" },
                { q: "ƒê∆°n v·ªã ƒëo th·ªÉ t√≠ch n√†o l·ªõn nh·∫•t?", a: ["cm¬≥", "dm¬≥", "m¬≥", "mm"], c: "m¬≥" },
                { q: "B·∫£n ƒë·ªì 1:1 000 000, 5 cm ·ª©ng v·ªõi th·ª±c t·∫ø l√†:", a: ["5 km", "50 km", "500 km", "5000 m"], c: "50 km" },
                { q: "Bi·ªÉu ƒë·ªì qu·∫°t tr√≤n d√πng ƒë·ªÉ bi·ªÉu th·ªã ƒë·∫°i l∆∞·ª£ng n√†o?", a: ["T·ªïng s·ªë l∆∞·ª£ng", "T·ªâ s·ªë ph·∫ßn trƒÉm", "Hi·ªáu s·ªë", "V·∫≠n t·ªëc"], c: "T·ªâ s·ªë ph·∫ßn trƒÉm" }
            ]
        };

        let activeQueue = [];
        let currentIndex = 0;
        let score = 0;
        let seconds = 0;
        let timerItv;

        function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

        function initGame() {
            const r1 = shuffle([...questions.r1]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 1: S·ªê H·ªåC T·ªîNG H·ª¢P" }));
            const r2 = shuffle([...questions.r2]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 2: PH√âP T√çNH & T·ªà S·ªê" }));
            const r3 = shuffle([...questions.r3]).slice(0, 3).map(q => ({ ...q, pts: 10, label: "V√íNG 3: H√åNH H·ªåC & TH·ªêNG K√ä" }));
            activeQueue = [...r1, ...r2, ...r3];
            renderQuestion();
        }

        function renderQuestion() {
            if (currentIndex >= activeQueue.length) { finishGame(); return; }
            const q = activeQueue[currentIndex];
            document.getElementById('stage-label').innerText = q.label;
            document.getElementById('q-content').innerText = q.q;
            document.getElementById('progress-text').innerText = `${currentIndex + 1}/${activeQueue.length}`;
            document.getElementById('progress-bar').style.width = `${(currentIndex / activeQueue.length) * 100}%`;

            const area = document.getElementById('interaction-area');
            area.innerHTML = '';
            shuffle([...q.a]).forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, q.c, q.pts);
                area.appendChild(btn);
            });
        }

        function checkAnswer(btn, choice, correct, pts) {
            document.querySelectorAll('.opt-btn').forEach(b => b.onclick = null);
            if (choice === correct) {
                btn.classList.add('correct');
                score += pts;
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
            }
            document.getElementById('current-score').innerText = score;
            setTimeout(() => { currentIndex++; renderQuestion(); }, 1500);
        }

        function startTimer() {
            timerItv = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(523, t); osc.frequency.exponentialRampToValueAtTime(880, t + 0.1);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            } else {
                osc.type = 'square'; osc.frequency.setValueAtTime(110, t); osc.frequency.linearRampToValueAtTime(80, t + 0.2);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            }
        }

        function finishGame() {
            clearInterval(timerItv);
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-time-text').innerText = document.getElementById('timer').innerText;

            db.ref('scores/Tuan_34').push({
                fullName: savedName, className: savedClass, schoolName: savedSchool,
                score: score, duration: seconds, date: new Date().toLocaleString('vi-VN')
            }, () => {
                document.getElementById('save-msg').innerText = "Th√†nh t√≠ch ƒë√£ ƒë∆∞·ª£c ghi l·∫°i th√†nh c√¥ng!";
                let count = 5;
                const rd = document.getElementById('redirect-msg');
                const itv2 = setInterval(() => {
                    count--;
                    rd.innerText = `S·∫Ω quay l·∫°i b·∫£n ƒë·ªì trong ${count}s...`;
                    if (count <= 0) { clearInterval(itv2); window.location.href = "index.html"; }
                }, 1000);
            });
        }
    </script>
</body>

</html>
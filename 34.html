<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinh Ph·ª•c ƒê·ªânh Cao - Tu·∫ßn 34</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --peak-blue: #0984e3; --peak-dark: #2d3436; --peak-white: #dfe6e9; --peak-gold: #fdcb6e; --peak-green: #27ae60; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; background: var(--peak-dark); color: var(--peak-white); user-select: none; }
        .peak-container { max-width: 750px; width: 100%; background: #353b48; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-top: 6px solid var(--peak-blue); transition: all 0.3s; }
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; color: var(--peak-gold); width: 100%; max-width: 750px; font-size: 1.1rem; }
        .display-screen { background: #2f3640; border-radius: 15px; padding: 25px; margin-bottom: 25px; border: 1px solid #718093; min-height: 150px; display: flex; flex-direction: column; justify-content: center; }
        .q-label { font-size: 0.8rem; color: var(--peak-blue); text-transform: uppercase; margin-bottom: 10px; letter-spacing: 2px; }
        .q-text { font-size: 1.25rem; line-height: 1.6; color: #fff; text-align: center; }
        .options-area { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { background: var(--peak-white); border: none; padding: 18px; border-radius: 12px; font-family: 'Lexend'; font-weight: 600; cursor: pointer; transition: 0.2s; color: var(--peak-dark); font-size: 1.1rem; }
        .opt-btn:hover { background: var(--peak-blue); color: #fff; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(9, 132, 227, 0.4); }
        .input-group { display: flex; flex-direction: column; gap: 15px; }
        .input-main { padding: 20px; border-radius: 12px; border: 3px solid var(--peak-blue); background: #fff; color: #2d3436; font-size: 1.6rem; text-align: center; font-family: 'Lexend'; font-weight: bold; outline: none; }
        .btn-confirm { background: var(--peak-green); color: white; padding: 18px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1.2rem; box-shadow: 0 5px 0 #1e8449; }
        .btn-confirm:active { transform: translateY(3px); box-shadow: 0 2px 0 #1e8449; }
        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); padding: 15px 40px; border-radius: 30px; font-weight: bold; z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; border: 2px solid #fff; }
        .show-toast { opacity: 1 !important; top: 50px !important; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="status-bar">
    <span id="vong-ten">V√íNG 1: CHUY·ªÇN ƒê·ªòNG PH·ª®C T·∫†P</span>
    <span id="diem-so">ƒêI·ªÇM: 0</span>
</div>

<div class="peak-container">
    <div id="game-play">
        <div class="display-screen">
            <span class="q-label" id="q-stt">C√¢u h·ªèi 1/4</span>
            <div id="q-noi-dung" class="q-text">ƒêang tri·ªáu h·ªìi th·ª≠ th√°ch...</div>
        </div>
        <div id="vung-tuong-tac"></div>
    </div>

    <div id="man-hinh-ket-thuc" class="hidden" style="text-align: center;">
        <h2 style="color: var(--peak-gold); margin-bottom: 10px;">CHINH PH·ª§C TH√ÄNH C√îNG! üèîÔ∏è</h2>
        <p>B·∫°n ƒë√£ ch·∫°m tay v√†o ƒë·ªânh cao tri th·ª©c.</p>
        <h1 id="diem-cuoi" style="font-size: 5rem; color: #fff; margin: 20px 0;">0</h1>
        <div id="form-luu" class="hidden">
            <input type="text" id="hs-ten" style="width:80%; padding:15px; margin:5px; border-radius:10px; border:none;" placeholder="H·ªç v√† t√™n h·ªçc sinh...">
            <input type="text" id="hs-lop" style="width:80%; padding:15px; margin:5px; border-radius:10px; border:none;" placeholder="L·ªõp...">
            <br>
            <button class="btn-confirm" style="width:85%; margin-top:15px;" onclick="saveData()">GHI DANH B·∫¢NG V√ÄNG</button>
        </div>
        <button class="btn-confirm" style="background:#636e72; box-shadow: 0 5px 0 #2d3436; margin-top:20px;" onclick="location.reload()">TH√ÅCH ƒê·∫§U L·∫†I</button>
    </div>
</div>

<script>
    let score = 0;
    let stage = 1;
    let currentQ = 0;
    let isGameActive = true;

    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    const KHO_CHUYEN_DONG = [
        {q: "V·∫≠n t·ªëc xu√¥i d√≤ng c·ªßa thuy·ªÅn ƒë∆∞·ª£c t√≠nh b·∫±ng c√¥ng th·ª©c n√†o?", opts: ["V th·ª±c + V d√≤ng n∆∞·ªõc", "V th·ª±c - V d√≤ng n∆∞·ªõc", "V th·ª±c x 2", "V d√≤ng n∆∞·ªõc x 2"], c: 0},
        {q: "M·ªôt ƒëo√†n t√†u d√†i 200m v∆∞·ª£t qua m·ªôt c·ªôt ƒëi·ªán h·∫øt 10 gi√¢y. V·∫≠n t·ªëc t√†u l√†:", opts: ["20 m/s", "200 m/s", "20 km/h", "10 m/s"], c: 0},
        {q: "V·∫≠n t·ªëc ng∆∞·ª£c d√≤ng l√† 15 km/h, v·∫≠n t·ªëc d√≤ng n∆∞·ªõc l√† 2 km/h. V·∫≠n t·ªëc th·ª±c l√†:", opts: ["13 km/h", "17 km/h", "19 km/h", "11 km/h"], c: 1},
        {q: "ƒêo√†n t√†u d√†i 200m ƒëi qua h·∫ßm d√†i 800m. Qu√£ng ƒë∆∞·ªùng t√†u ƒë√£ ƒëi ƒë·ªÉ qua h·∫øt h·∫ßm l√†:", opts: ["800m", "200m", "1000m", "600m"], c: 2},
        {q: "M·ªôt t√†u th·ªßy ƒëi xu√¥i d√≤ng 28 km/h, ng∆∞·ª£c d√≤ng 22 km/h. V·∫≠n t·ªëc d√≤ng n∆∞·ªõc l√†:", opts: ["6 km/h", "3 km/h", "50 km/h", "25 km/h"], c: 1}
    ];

    const KHO_TONG_HOP = [
        {q: "T√≠nh nhanh: 2,6 gi·ªù b·∫±ng bao nhi√™u ph√∫t?", opts: ["156 ph√∫t", "126 ph√∫t", "146 ph√∫t", "260 ph√∫t"], c: 0},
        {q: "Di·ªán t√≠ch to√†n ph·∫ßn h√¨nh l·∫≠p ph∆∞∆°ng c√≥ c·∫°nh 10cm l√†:", opts: ["400 cm¬≤", "600 cm¬≤", "1000 cm¬≤", "600 cm¬≥"], c: 1},
        {q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 15 v√† 40 l√† bao nhi√™u?", opts: ["37,5%", "3,75%", "0,375%", "375%"], c: 0},
        {q: "M·ªôt b·ªÉ ch·ª©a ƒë∆∞·ª£c 2 m¬≥ n∆∞·ªõc. S·ªë l√≠t n∆∞·ªõc t·ªëi ƒëa b·ªÉ ch·ª©a ƒë∆∞·ª£c l√†:", opts: ["20 l√≠t", "200 l√≠t", "2000 l√≠t", "20000 l√≠t"], c: 2}
    ];

    const KHO_TU_LUAN = [
        {q: "M·ªôt ƒëo√†n t√†u d√†i 200m qua h·∫ßm d√†i 800m h·∫øt 50 gi√¢y. V·∫≠n t·ªëc t√†u (m/s) l√†:", a: "20"},
        {q: "T√¨m 15% c·ªßa s·ªë 120 (Ch·ªâ ƒëi·ªÅn s·ªë):", a: "18"},
        {q: "B·ªÉ c√≥ th·ªÉ t√≠ch 120 cm¬≥, di·ªán t√≠ch ƒë√°y 30 cm¬≤. Chi·ªÅu cao b·ªÉ (cm) l√†:", a: "4"}
    ];

    let v1 = shuffle([...KHO_CHUYEN_DONG]).slice(0, 4);
    let v2 = shuffle([...KHO_TONG_HOP]).slice(0, 4);
    let v3 = shuffle([...KHO_TU_LUAN]).slice(0, 2);

    function loadStage(s) {
        stage = s; currentQ = 0;
        document.getElementById('vong-ten').innerText = s === 1 ? "V√íNG 1: CHUY·ªÇN ƒê·ªòNG PH·ª®C T·∫†P" : (s === 2 ? "V√íNG 2: T·ªîNG H·ª¢P CU·ªêI NƒÇM" : "V√íNG 3: V·ªÄ ƒê√çCH");
        showQuestion();
    }

    function showQuestion() {
        let pool = stage === 1 ? v1 : (stage === 2 ? v2 : v3);
        let item = pool[currentQ];
        document.getElementById('q-stt').innerText = `Th·ª≠ th√°ch ${currentQ + 1}/${pool.length}`;
        document.getElementById('q-noi-dung').innerHTML = item.q;
        
        let html = '';
        if(stage < 3) {
            html = '<div class="options-area">';
            item.opts.forEach((o, i) => html += `<button class="opt-btn" onclick="checkAnswer(${i})">${o}</button>`);
            html += '</div>';
        } else {
            html = `<div class="input-group"><input type="text" id="ans-in" class="input-main" placeholder="Nh·∫≠p ƒë√°p √°n..." autofocus><button class="btn-confirm" onclick="checkInput()">X√ÅC NH·∫¨N K·∫æT QU·∫¢</button></div>`;
        }
        document.getElementById('vung-tuong-tac').innerHTML = html;
    }

    function checkAnswer(idx) {
        let pool = stage === 1 ? v1 : v2;
        if(idx === pool[currentQ].c) { score += 10; toast("CH√çNH X√ÅC! üåü", "#27ae60"); }
        else { toast("SAI R·ªíI! ‚ùå", "#e74c3c"); }
        updateUI();
        setTimeout(next, 1000);
    }

    function checkInput() {
        let val = document.getElementById('ans-in').value.trim();
        if(val === v3[currentQ].a) { score += 10; toast("TUY·ªÜT V·ªúI! üåü", "#27ae60"); }
        else { toast("CH∆ØA ƒê√öNG! ‚ùå", "#e74c3c"); }
        updateUI();
        setTimeout(next, 1000);
    }

    function next() {
        currentQ++;
        let pool = stage === 1 ? v1 : (stage === 2 ? v2 : v3);
        if(currentQ < pool.length) {
            showQuestion();
        } else {
            if(stage < 3) loadStage(stage + 1);
            else finish();
        }
    }

    function updateUI() { document.getElementById('diem-so').innerText = "ƒêI·ªÇM: " + score; }

    function toast(m, c) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.background = c;
        t.classList.add('show-toast');
        setTimeout(() => t.classList.remove('show-toast'), 800);
    }

    function finish() {
        isGameActive = false;
        document.getElementById('game-play').classList.add('hidden');
        document.getElementById('man-hinh-ket-thuc').classList.remove('hidden');
        document.getElementById('diem-cuoi').innerText = score;
        if(score >= 40) document.getElementById('form-luu').classList.remove('hidden');
    }

    function saveData() {
        const t = document.getElementById('hs-ten').value;
        const l = document.getElementById('hs-lop').value;
        if(!t || !l) { alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin!"); return; }
        db.ref('ketqua/tuan34/' + Date.now()).set({ hoTen: t, lop: l, diem: score, time: Date.now() })
        .then(() => { alert("ƒê√£ ghi danh B·∫£ng V√†ng th√†nh c√¥ng!"); location.reload(); });
    }

    window.onload = () => loadStage(1);
</script>
</body>
</html>
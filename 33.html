<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√îN T·∫¨P TU·∫¶N 33 - CHINH PH·ª§C R·ª™NG XANH</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Lexend:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="js/fireworks.js"></script>
    <style>
        :root {
            --primary: #2d3436;
            --jungle: #27ae60;
            --wood: #7158e2;
            /* Changed to a vibrant purple-ish for better contrast, or keep wood brown */
            --brown: #8d6e63;
            --sun: #fbc531;
            --leaf: #2ecc71;
            --correct: #27ae60;
            --wrong: #e74c3c;
            --bg: #f5f6fa;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, #16a085 0%, #2ecc71 100%);
            color: white;
            margin: 0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            padding-bottom: 40px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }

        .header {
            background: rgba(45, 52, 54, 0.4);
            padding: 15px;
            border-radius: 20px;
            border: 3px solid var(--sun);
            text-align: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--sun);
            text-transform: uppercase;
            font-family: 'Bungee';
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #000;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            color: #fff;
            font-weight: 600;
            padding: 10px 15px;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .game-stage {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            min-height: 350px;
            position: relative;
            color: #2c3e50;
        }

        .stage-label {
            background: var(--jungle);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-family: 'Bungee';
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9rem;
            box-shadow: 0 4px 0 #1e8449;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            min-height: 80px;
            border-left: 5px solid var(--jungle);
            padding-left: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .opt-btn {
            background: #f0f0f0;
            border: 2px solid #ddd;
            padding: 18px;
            border-radius: 15px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.05rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 70px;
            box-shadow: 0 5px 0 #bdc3c7;
        }

        .opt-btn:hover {
            transform: translateY(-2px);
            background: #e9e9e9;
        }

        .opt-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #bdc3c7;
        }

        .opt-btn.correct {
            background: var(--correct);
            border-color: #27ae60;
            color: white;
            box-shadow: 0 5px 0 #1e8449;
        }

        .opt-btn.wrong {
            background: var(--wrong);
            border-color: #c0392b;
            color: white;
            box-shadow: 0 5px 0 #922b21;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: #dfe6e9;
            border-radius: 6px;
            margin-top: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--jungle), var(--sun));
            width: 0%;
            transition: width 0.5s ease;
        }

        #result-screen {
            text-align: center;
            padding: 50px 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            border: 2px solid var(--sun);
            color: white;
        }

        .trophy {
            font-size: 6rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--sun));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .final-score {
            font-size: 4rem;
            font-weight: bold;
            color: var(--sun);
            text-shadow: 3px 3px 0 #000;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        .btn-restart {
            padding: 15px 40px;
            background: var(--sun);
            border: none;
            border-radius: 50px;
            color: #2c3e50;
            font-weight: 800;
            font-family: 'Bungee';
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 6px 0 #d35400;
            margin-top: 30px;
        }

        .game-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 0;
            text-align: center;
            font-size: 0.7rem;
            color: #ddd;
            z-index: 1000;
        }

        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #16a085;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .btn-start {
            background: var(--sun);
            color: #2d3436;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Bungee';
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 0 #d35400;
            text-transform: uppercase;
            margin-top: 20px;
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #d35400;
            filter: brightness(1.1);
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.1rem;
            }

            .question-box {
                font-size: 1rem;
            }

            .opt-btn {
                font-size: 0.95rem;
                padding: 12px;
                min-height: 50px;
            }
        }
    </style>
</head>

<body>
    <div id="start-screen">
        <h1
            style="color: var(--sun); font-size: 2.2rem; font-family: 'Bungee'; text-align: center; text-shadow: 2px 2px 0 #000;">
            TU·∫¶N 33: CHINH PH·ª§C R·ª™NG XANH</h1>
        <p id="welcome-msg" style="margin-bottom: 20px; font-weight: bold; color: white;"></p>
        <button class="btn-start" onclick="startGame()">B·∫ÆT ƒê·∫¶U TH√ÅM HI·ªÇM</button>
    </div>

    <div class="container hidden" id="game-ui">
        <div class="header">
            <h1>√îN T·∫¨P TU·∫¶N 33 - TO√ÅN L·ªöP 5</h1>
            <p style="margin: 5px 0; color: #f1f2f6; font-weight: bold; font-size: 0.85rem;">CH·ª¶ ƒê·ªÄ: H√åNH H·ªåC V√Ä ƒêO
                L∆Ø·ªúNG</p>
            <div class="info-bar">
                <span>üë§ <b id="user-name">---</b></span>
                <span>üè´ <b id="user-class">---</b></span>
                <span>‚≠ê <b id="current-score" style="color:var(--sun)">0</b>/100</span>
                <span>‚è≥ <b id="timer">00:00</b></span>
            </div>
        </div>

        <div class="game-stage">
            <div id="stage-info">
                <div class="stage-label" id="stage-label">V√íNG 1: KH√ÅM PH√Å</div>
                <div class="question-box" id="q-content">ƒêang chu·∫©n b·ªã c√¢u h·ªèi...</div>
            </div>

            <div id="interaction-area" class="options-grid"></div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#636e72; margin-top:8px; font-weight: 600;">Ti·∫øn ƒë·ªô:
                <span id="progress-text">0/13</span>
            </div>
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <div class="trophy">üå¥</div>
        <h2>TH√ÄNH QU·∫¢ TH√ÅM HI·ªÇM!</h2>
        <div class="final-score" id="final-score">0</div>
        <p style="font-size: 1.2rem;">Th·ªùi gian ho√†n th√†nh: <b id="final-time-text" style="color: var(--sun);">--:--</b>
        </p>
        <p id="save-msg" style="color:#55efc4; font-weight:bold; margin-top:20px;">ƒêang k·∫øt n·ªëi h·ªá th·ªëng...</p>
        <p id="redirect-msg" style="color:#dfe6e9; font-size:0.9rem;">S·∫Ω quay l·∫°i trang ch·ªß trong gi√¢y l√°t...</p>
        <button class="btn-restart" onclick="location.reload()">CH∆†I L·∫†I</button>
    </div>

    <div class="game-footer">¬© 2026 EduBot - Chinh ph·ª•c To√°n 5 - Thi·∫øt k·∫ø b·ªüi L√™ Th√†nh Long</div>

    <script>
        const firebaseConfig = { databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const savedName = localStorage.getItem('studentName') || "Ng∆∞·ªùi ch∆°i";
        const savedClass = localStorage.getItem('studentClass') || "---";
        const savedSchool = localStorage.getItem('studentSchool') || "---";

        let isPlaying = false;
        let startTime;

        window.onload = () => {
            if (!localStorage.getItem('studentName') || !localStorage.getItem('studentClass')) {
                document.getElementById('welcome-msg').innerHTML = "<b style='color:red'>‚ö†Ô∏è Em c·∫ßn ƒëƒÉng k√Ω ·ªü b·∫£n ƒë·ªì tr∆∞·ªõc!</b>";
                document.querySelector('#start-screen .btn-start').onclick = () => window.location.href = "index.html";
            } else {
                document.getElementById('welcome-msg').innerText = `Th√≠ sinh: ${savedName} - L·ªõp ${savedClass}`;
                document.getElementById('user-name').innerText = savedName;
                document.getElementById('user-class').innerText = savedClass;
            }
        };

        function startGame() {
            isPlaying = true;
            startTime = Date.now();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            initGame();
            startTimer();
        }

        const questions = {
            r1: [
                { q: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh ch·ªØ nh·∫≠t (d√†i a, r·ªông b) l√†:", a: ["S = a + b", "S = a √ó b", "S = (a + b) √ó 2", "S = a √ó a"], c: "S = a √ó b" },
                { q: "Mu·ªën t√≠nh chu vi h√¨nh vu√¥ng c√≥ c·∫°nh a, ta l√†m th·∫ø n√†o?", a: ["P = a √ó a", "P = a √ó 4", "P = a + 4", "P = a √ó 2"], c: "P = a √ó 4" },
                { q: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh tam gi√°c l√† S = (a √ó h) : ?", a: ["2", "3", "4", "1"], c: "2" },
                { q: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh thang (ƒë√°y a, b; cao h) l√†:", a: ["S = (a + b) √ó h", "S = (a + b) √ó h : 2", "S = a √ó b √ó h", "S = a + b + h"], c: "S = (a + b) √ó h : 2" },
                { q: "Chu vi h√¨nh tr√≤n b√°n k√≠nh r ƒë∆∞·ª£c t√≠nh theo c√¥ng th·ª©c:", a: ["C = r √ó 3,14", "C = r √ó 2 √ó 3,14", "C = r √ó r √ó 3,14", "C = d √ó 2"], c: "C = r √ó 2 √ó 3,14" },
                { q: "Di·ªán t√≠ch to√†n ph·∫ßn h√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh a b·∫±ng S m·ªôt m·∫∑t nh√¢n v·ªõi m·∫•y?", a: ["4", "6", "8", "12"], c: "6" },
                { q: "Th·ªÉ t√≠ch h√¨nh h·ªôp ch·ªØ nh·∫≠t (a, b, c) l√†:", a: ["V = a + b + c", "V = a √ó b √ó c", "V = (a + b) √ó c", "V = a √ó b"], c: "V = a √ó b √ó c" },
                { q: "1 ki-l√¥-m√©t (km) b·∫±ng bao nhi√™u m√©t (m)?", a: ["10 m", "100 m", "1000 m", "10 000 m"], c: "1000 m" },
                { q: "ƒê∆°n v·ªã di·ªán t√≠ch 'ha' t∆∞∆°ng ·ª©ng v·ªõi ƒë∆°n v·ªã n√†o?", a: ["m¬≤", "dm¬≤", "hm¬≤", "km¬≤"], c: "hm¬≤" },
                { q: "M·ªôt t·∫•n b·∫±ng bao nhi√™u ki-l√¥-gam (kg)?", a: ["100 kg", "1000 kg", "10 000 kg", "10 kg"], c: "1000 kg" },
                { q: "1 l√≠t n∆∞·ªõc t∆∞∆°ng ƒë∆∞∆°ng v·ªõi ?", a: ["1 cm¬≥", "1 dm¬≥", "1 m¬≥", "10 dm¬≥"], c: "1 dm¬≥" },
                { q: "M·ªôt th·∫ø k·ªâ c√≥ bao nhi√™u nƒÉm?", a: ["10 nƒÉm", "50 nƒÉm", "100 nƒÉm", "1000 nƒÉm"], c: "100 nƒÉm" },
                { q: "M·ªôt ng√†y c√≥ bao nhi√™u gi·ªù?", a: ["12 gi·ªù", "24 gi·ªù", "48 gi·ªù", "60 gi·ªù"], c: "24 gi·ªù" },
                { q: "T√≠nh di·ªán t√≠ch h√¨nh tr√≤n ta l·∫•y b√°n k√≠nh nh√¢n b√°n k√≠nh r·ªìi nh√¢n v·ªõi:", a: ["2", "3,14", "4", "r"], c: "3,14" },
                { q: "ƒê∆°n v·ªã n√†o th∆∞·ªùng d√πng ƒëo kh·ªëi l∆∞·ª£ng v·∫≠t r·∫•t l·ªõn nh∆∞ xe t·∫£i?", a: ["Gam", "Y·∫øn", "T·∫°", "T·∫•n"], c: "T·∫•n" },
                { q: "H√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ bao nhi√™u m·∫∑t?", a: ["4 m·∫∑t", "6 m·∫∑t", "8 m·∫∑t", "12 m·∫∑t"], c: "6 m·∫∑t" },
                { q: "1 m¬≥ b·∫±ng bao nhi√™u dm¬≥?", a: ["10 dm¬≥", "100 dm¬≥", "1000 dm¬≥", "1 000 000 dm¬≥"], c: "1000 dm¬≥" },
                { q: "Di·ªán t√≠ch xung quanh h√¨nh h·ªôp ch·ªØ nh·∫≠t (a, b, c) l√†:", a: ["S = (a + b) √ó 2", "S = (a + b) √ó 2 √ó c", "S = a √ó b √ó c", "S = a + b + c"], c: "S = (a + b) √ó 2 √ó c" },
                { q: "ƒê∆°n v·ªã ƒëo th·ªùi gian n√†o nh·ªè h∆°n ph√∫t?", a: ["Ng√†y", "Gi·ªù", "Gi√¢y", "Th√°ng"], c: "Gi√¢y" },
                { q: "1 m√©t vu√¥ng (m¬≤) b·∫±ng bao nhi√™u ƒë·ªÅ-xi-m√©t vu√¥ng (dm¬≤)?", a: ["10 dm¬≤", "100 dm¬≤", "1000 dm¬≤", "10 000 dm¬≤"], c: "100 dm¬≤" }
            ],
            r2: [
                { q: "T√≠nh di·ªán t√≠ch tam gi√°c ƒë√°y 10 cm, cao 6 cm:", a: ["60 cm¬≤", "30 cm¬≤", "16 cm¬≤", "20 cm¬≤"], c: "30 cm¬≤" },
                { q: "H√¨nh thang ƒë√°y 12 dm, 8 dm; cao 5 dm. Di·ªán t√≠ch l√†:", a: ["100 dm¬≤", "50 dm¬≤", "25 dm¬≤", "200 dm¬≤"], c: "50 dm¬≤" },
                { q: "Chu vi h√¨nh tr√≤n ƒë∆∞·ªùng k√≠nh 5 m l√†:", a: ["15,7 m", "31,4 m", "7,85 m", "10 m"], c: "15,7 m" },
                { q: "H√¨nh vu√¥ng c·∫°nh 0,5 m. Di·ªán t√≠ch l√†:", a: ["2 m¬≤", "1 m¬≤", "0,25 m¬≤", "0,5 m¬≤"], c: "0,25 m¬≤" },
                { q: "ƒê·ªïi 1,5 km sang m√©t (m):", a: ["150 m", "1500 m", "15 000 m", "15 m"], c: "1500 m" },
                { q: "ƒê·ªïi 2 t·∫° 30 kg sang kg:", a: ["23 kg", "230 kg", "2300 kg", "50 kg"], c: "230 kg" },
                { q: "Th·ªÉ t√≠ch h√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 4 cm:", a: ["16 cm¬≥", "64 cm¬≥", "12 cm¬≥", "40 cm¬≥"], c: "64 cm¬≥" },
                { q: "H√¨nh ch·ªØ nh·∫≠t S = 48 m¬≤, d√†i 8 m. Chi·ªÅu r·ªông l√†:", a: ["6 m", "40 m", "12 m", "4 m"], c: "6 m" },
                { q: "ƒê·ªïi 4000 cm¬≤ sang dm¬≤:", a: ["4 dm¬≤", "40 dm¬≤", "400 dm¬≤", "0,4 dm¬≤"], c: "40 dm¬≤" },
                { q: "ƒê·ªïi 0,42 m¬≥ sang dm¬≥:", a: ["42 dm¬≥", "420 dm¬≥", "4200 dm¬≥", "0,042 dm¬≥"], c: "420 dm¬≥" },
                { q: "Di·ªán t√≠ch xung quanh l·∫≠p ph∆∞∆°ng l√† 100 cm¬≤. Di·ªán t√≠ch 1 m·∫∑t l√†:", a: ["10 cm¬≤", "25 cm¬≤", "20 cm¬≤", "16 cm¬≤"], c: "25 cm¬≤" },
                { q: "Di·ªán t√≠ch h√¨nh tr√≤n b√°n k√≠nh 2 dm:", a: ["6,28 dm¬≤", "12,56 dm¬≤", "4 dm¬≤", "3,14 dm¬≤"], c: "12,56 dm¬≤" },
                { q: "M·ªôt nƒÉm r∆∞·ª°i c√≥ bao nhi√™u th√°ng?", a: ["12 th√°ng", "15 th√°ng", "18 th√°ng", "24 th√°ng"], c: "18 th√°ng" },
                { q: "ƒê·ªïi 3 gi·ªù 15 ph√∫t sang ph√∫t:", a: ["180 ph√∫t", "195 ph√∫t", "210 ph√∫t", "315 ph√∫t"], c: "195 ph√∫t" },
                { q: "Th·ªÉ t√≠ch h√¨nh h·ªôp ch·ªØ nh·∫≠t k√≠ch th∆∞·ªõc 5 dm, 4 dm, 3 dm:", a: ["12 dm¬≥", "60 dm¬≥", "20 dm¬≥", "15 dm¬≥"], c: "60 dm¬≥" },
                { q: "ƒê·ªïi 7500 kg sang t·∫•n:", a: ["75 t·∫•n", "7,5 t·∫•n", "0,75 t·∫•n", "750 t·∫•n"], c: "7,5 t·∫•n" },
                { q: "Tam gi√°c vu√¥ng c√≥ c·∫°nh g√≥c vu√¥ng 4 cm v√† 5 cm. Di·ªán t√≠ch l√†:", a: ["20 cm¬≤", "10 cm¬≤", "9 cm¬≤", "40 cm¬≤"], c: "10 cm¬≤" },
                { q: "ƒê·ªïi 1,6 ha sang m¬≤:", a: ["160 m¬≤", "1600 m¬≤", "16 000 m¬≤", "160 000 m¬≤"], c: "16 000 m¬≤" },
                { q: "ƒê·ªïi 2 ph√∫t 30 gi√¢y sang gi√¢y:", a: ["120 gi√¢y", "150 gi√¢y", "230 gi√¢y", "130 gi√¢y"], c: "150 gi√¢y" },
                { q: "L·∫≠p ph∆∞∆°ng c·∫°nh 10 cm. Di·ªán t√≠ch to√†n ph·∫ßn l√†:", a: ["100 cm¬≤", "400 cm¬≤", "600 cm¬≤", "1000 cm¬≤"], c: "600 cm¬≤" }
            ],
            r3: [
                { q: "B·ªÉ c√° ƒë√°y 60 cm x 40 cm. Di·ªán t√≠ch ƒë√°y b·ªÉ l√†:", a: ["240 cm¬≤", "2400 cm¬≤", "200 cm¬≤", "100 cm¬≤"], c: "2400 cm¬≤" },
                { q: "B·ªÉ ƒë√°y 2400 cm¬≤, n∆∞·ªõc cao 30 cm. Th·ªÉ t√≠ch n∆∞·ªõc theo l√≠t l√†:", a: ["7,2 l√≠t", "72 l√≠t", "720 l√≠t", "24 l√≠t"], c: "72 l√≠t" },
                { q: "ƒêƒ©a tr√≤n ƒë∆∞·ªùng k√≠nh 24 cm. Chu vi ƒëƒ©a l√†:", a: ["37,68 cm", "75,36 cm", "150,72 cm", "24 cm"], c: "75,36 cm" },
                { q: "Ph√≤ng 8m x 6m, l√°t g·∫°ch 0,4m x 0,4m. S·ªë g·∫°ch c·∫ßn l√†:", a: ["120 vi√™n", "300 vi√™n", "480 vi√™n", "600 vi√™n"], c: "300 vi√™n" },
                { q: "Ph√≤ng 8x6x4m, tr·∫ßn 48m¬≤, c·ª≠a 6,5m¬≤. Di·ªán t√≠ch qu√©t v√¥i t∆∞·ªùng+tr·∫ßn l√†:", a: ["160 m¬≤", "153,5 m¬≤", "200 m¬≤", "112 m¬≤"], c: "153,5 m¬≤" },
                { q: "ƒê√° 1 m¬≥ n·∫∑ng 2,75 t·∫•n. Kh·ªëi 0,4 m¬≥ n·∫∑ng bao nhi√™u kg?", a: ["110 kg", "1100 kg", "275 kg", "400 kg"], c: "1100 kg" },
                { q: "B·ªÉ 480 m¬≥ n∆∞·ªõc, ƒë√£ h√∫t 5/8 l∆∞·ª£ng n∆∞·ªõc. C√≤n l·∫°i:", a: ["300 m¬≥", "180 m¬≥", "240 m¬≥", "60 m¬≥"], c: "180 m¬≥" },
                { q: "V∆∞·ªùn vu√¥ng chu vi 240 m. Di·ªán t√≠ch theo ha l√†:", a: ["0,036 ha", "0,36 ha", "3,6 ha", "24 ha"], c: "0,36 ha" },
                { q: "C·∫°nh l·∫≠p ph∆∞∆°ng tƒÉng 2 l·∫ßn. Th·ªÉ t√≠ch tƒÉng m·∫•y l·∫ßn?", a: ["2 l·∫ßn", "4 l·∫ßn", "6 l·∫ßn", "8 l·∫ßn"], c: "8 l·∫ßn" },
                { q: "ƒêi t·ª´ 6h10p ƒë·∫øn 18h ng√†y h√¥m sau. T·ªïng th·ªùi gian l√†:", a: ["12h", "24h", "35h 50p", "36h 10p"], c: "35h 50p" },
                { q: "H√¨nh thang cao 40m, ƒë√°y l·ªõn 60m (g·∫•p r∆∞·ª°i ƒë√°y b√©). Di·ªán t√≠ch l√†:", a: ["2000 m¬≤", "2400 m¬≤", "3000 m¬≤", "4000 m¬≤"], c: "2000 m¬≤" },
                { q: "H·ªôp l·∫≠p ph∆∞∆°ng c·∫°nh 12 cm. Di·ªán t√≠ch gi·∫•y d√°n c√°c m·∫∑t (dm¬≤) l√†:", a: ["864 dm¬≤", "8,64 dm¬≤", "0,864 dm¬≤", "1,44 dm¬≤"], c: "8,64 dm¬≤" },
                { q: "B·ªÉ 10dm x 6dm, ƒë√° l√†m n∆∞·ªõc d√¢ng 0,2dm. Th·ªÉ t√≠ch ƒë√° (dm¬≥):", a: ["12", "1,2", "120", "20"], c: "12" },
                { q: "ƒê·ªìng h·ªì ch·∫≠m 25p/ng√†y. Sau 4 ng√†y ch·∫≠m bao l√¢u?", a: ["1h", "1h 40p", "2h", "100p"], c: "1h 40p" },
                { q: "S√¢n b√≥ng 28m x 15m. Chu vi s√¢n l√†:", a: ["43 m", "86 m", "420 m", "100 m"], c: "86 m" },
                { q: "B·ªÉ 60x40x50cm, n∆∞·ªõc chi·∫øm 90%. L∆∞·ª£ng n∆∞·ªõc (l√≠t) l√†:", a: ["120", "108", "90", "54"], c: "108" },
                { q: "B√¨a tr√≤n r=10cm, c·∫Øt b·ªè 1/4. Di·ªán t√≠ch c√≤n l·∫°i l√†:", a: ["314 cm¬≤", "235,5 cm¬≤", "78,5 cm¬≤", "100 cm¬≤"], c: "235,5 cm¬≤" },
                { q: "ƒê·ªïi 2,4 gi·ªù sang gi·ªù v√† ph√∫t:", a: ["2h 40p", "2h 24p", "2h 4p", "2h 15p"], c: "2h 24p" },
                { q: "H·ªôp ch·ªØ nh·∫≠t a=8,5, b=4, c=4 (cm). S to√†n ph·∫ßn l√†:", a: ["68 cm¬≤", "136 cm¬≤", "168 cm¬≤", "200 cm¬≤"], c: "168 cm¬≤" },
                { q: "D√†i tƒÉng 20%, r·ªông gi·ªØ nguy√™n. Di·ªán t√≠ch tƒÉng bao nhi√™u %?", a: ["10%", "20%", "40%", "0%"], c: "20%" }
            ]
        };

        let queue = [];
        let currIdx = 0;
        let score = 0;
        let timer = 0;
        let itv;

        function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

        function initGame() {
            const r1 = shuffle([...questions.r1]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 1: KH√ÅM PH√Å" }));
            const r2 = shuffle([...questions.r2]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 2: LUY·ªÜN T·∫¨P" }));
            const r3 = shuffle([...questions.r3]).slice(0, 3).map(q => ({ ...q, pts: 10, label: "V√íNG 3: ·ª®NG D·ª§NG" }));
            queue = [...r1, ...r2, ...r3];
            renderQ();
        }

        function renderQ() {
            if (currIdx >= queue.length) { finish(); return; }
            const q = queue[currIdx];
            document.getElementById('stage-label').innerText = q.label;
            document.getElementById('q-content').innerText = q.q;
            document.getElementById('progress-text').innerText = `${currIdx + 1}/${queue.length}`;
            document.getElementById('progress-bar').style.width = `${(currIdx / queue.length) * 100}%`;

            const area = document.getElementById('interaction-area');
            area.innerHTML = '';
            shuffle([...q.a]).forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => check(btn, opt, q.c, q.pts);
                area.appendChild(btn);
            });
        }

        function check(btn, choice, correct, pts) {
            document.querySelectorAll('.opt-btn').forEach(b => b.onclick = null);
            if (choice === correct) {
                btn.classList.add('correct');
                score += pts;
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
            }
            document.getElementById('current-score').innerText = score;
            setTimeout(() => { currIdx++; renderQ(); }, 1500);
        }

        function startTimer() {
            itv = setInterval(() => {
                timer++;
                const m = Math.floor(timer / 60).toString().padStart(2, '0');
                const s = (timer % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(523, t); osc.frequency.exponentialRampToValueAtTime(880, t + 0.1);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            } else {
                osc.type = 'square'; osc.frequency.setValueAtTime(110, t); osc.frequency.linearRampToValueAtTime(80, t + 0.2);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            }
        }

        function finish() {
            clearInterval(itv);
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-time-text').innerText = document.getElementById('timer').innerText;

            // Hi·ªáu ·ª©ng ph√°o hoa n·∫øu ƒëi·ªÉm >= 90
            if (score >= 90) {
                if (typeof startFireworks === 'function') {
                    startFireworks();
                }
            }

            db.ref('scores/Tuan_33').push({
                fullName: savedName, className: savedClass, schoolName: savedSchool,
                score: score, duration: timer, date: new Date().toLocaleString('vi-VN')
            }, () => {
                document.getElementById('save-msg').innerText = "Th√°m hi·ªÉm ho√†n t·∫•t! K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c l∆∞u.";
                let count = 5;
                const rd = document.getElementById('redirect-msg');
                const itv2 = setInterval(() => {
                    count--;
                    rd.innerText = `S·∫Ω quay l·∫°i trang ch·ªß trong ${count}s...`;
                    if (count <= 0) { clearInterval(itv2); window.location.href = "index.html"; }
                }, 1000);
            });
        }
    </script>
</body>

</html>
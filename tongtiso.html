<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i 38: T√¨m hai s·ªë khi bi·∫øt T·ªïng v√† T·ªâ s·ªë</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root { --primary: #FF9800; --secondary: #2196F3; --bg: #fff9f0; }
        body { font-family: 'Lexend', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 750px; width: 100%; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 10px solid var(--primary); }
        
        .header-title { text-align: center; color: var(--primary); margin-bottom: 20px; }
        .progress-bar { height: 10px; background: #eee; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.5s; }

        .lvl-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .lvl-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; background: #f5f5f5; cursor: pointer; font-weight: bold; }
        .lvl-btn.active { background: var(--primary); color: white; }

        .question-box { background: #fdf2e9; padding: 20px; border-radius: 15px; border: 2px dashed var(--primary); margin-bottom: 20px; font-size: 1.1rem; line-height: 1.6; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { padding: 15px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 1rem; transition: 0.2s; text-align: left; }
        .opt-btn:hover:not(:disabled) { border-color: var(--primary); background: #fff8f0; }

        .robot-hint { background: #e3f2fd; padding: 15px; border-radius: 12px; margin-top: 20px; display: flex; align-items: center; gap: 10px; border-left: 5px solid var(--secondary); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-title">
        <h2>ü§ñ Th·ª≠ Th√°ch T·ªïng - T·ªâ</h2>
        <p>H·ªçc c√°ch t√¨m hai s·ªë theo s∆° ƒë·ªì ƒëo·∫°n th·∫≥ng</p>
    </div>

    <div class="lvl-nav">
        <button id="btn-0" class="lvl-btn active" onclick="startLvl(0)">Ch·∫∑ng 1</button>
        <button id="btn-1" class="lvl-btn" onclick="startLvl(1)" disabled>Ch·∫∑ng 2</button>
        <button id="btn-2" class="lvl-btn" onclick="startLvl(2)" disabled>Ch·∫∑ng 3</button>
    </div>

    <div class="progress-bar"><div id="fill" class="progress-fill"></div></div>

    <div id="quiz-area">
        <div class="question-box" id="q-text">B·∫•m v√†o "Ch·∫∑ng 1" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>
        <div class="options-grid" id="q-opts"></div>
        <div id="hint-box" class="robot-hint hidden">
            <span>ü§ñ:</span> <span id="hint-text"></span>
        </div>
    </div>

    <div id="res-box" class="hidden" style="text-align: center;">
        <h2>V∆∞·ª£t ch·∫∑ng th√†nh c√¥ng!</h2>
        <p id="res-score"></p>
        <input type="text" id="p-name" placeholder="Nh·∫≠p t√™n kƒ© s∆∞ nh√≠..." style="padding:12px; border-radius:8px; border:1px solid #ccc; width:70%;">
        <button class="opt-btn" style="background: var(--primary); color: white; margin-top:15px; text-align:center; width:100%" onclick="save()">L∆∞u B·∫£ng V√†ng</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // D·ªØ li·ªáu b√°m s√°t B√†i 38 SGK trang 11
    const data = [
        [ // CH·∫∂NG 1: L√ù THUY·∫æT & S∆† ƒê·ªí
            { q: "T·ªïng hai s·ªë l√† 15. T·ªâ s·ªë c·ªßa hai s·ªë l√† 2/3. T·ªïng s·ªë ph·∫ßn b·∫±ng nhau l√†:", a: ["2 ph·∫ßn", "3 ph·∫ßn", "5 ph·∫ßn", "6 ph·∫ßn"], c: 2, h: "L·∫•y t·ª≠ s·ªë c·ªông m·∫´u s·ªë: 2 + 3 = 5 ph·∫ßn." },
            { q: "N·∫øu t·ªïng l√† 20, t·ªïng s·ªë ph·∫ßn l√† 4. Gi√° tr·ªã c·ªßa m·ªôt ph·∫ßn l√†:", a: ["4", "5", "80", "16"], c: 1, h: "Gi√° tr·ªã 1 ph·∫ßn = T·ªïng : T·ªïng s·ªë ph·∫ßn = 20 : 4 = 5." },
            { q: "Hai s·ªë c√≥ t·ªâ s·ªë 1/4. S·ªë b√© chi·∫øm m·∫•y ph·∫ßn?", a: ["1 ph·∫ßn", "4 ph·∫ßn", "5 ph·∫ßn", "3 ph·∫ßn"], c: 0, h: "T·ª≠ s·ªë l√† s·ªë ph·∫ßn c·ªßa s·ªë b√©." }
        ],
        [ // CH·∫∂NG 2: T√çNH TO√ÅN C∆† B·∫¢N
            { q: "T·ªïng hai s·ªë l√† 45, t·ªâ s·ªë l√† 2/3. S·ªë b√© l√†:", a: ["18", "27", "15", "9"], c: 0, h: "T·ªïng ph·∫ßn: 5. M·ªôt ph·∫ßn: 45:5=9. S·ªë b√©: 9x2=18." },
            { q: "T·ªïng hai s·ªë l√† 72, t·ªâ s·ªë l√† 1/5. S·ªë l·ªõn l√†:", a: ["12", "60", "62", "50"], c: 1, h: "T·ªïng ph·∫ßn: 6. M·ªôt ph·∫ßn: 72:6=12. S·ªë l·ªõn: 12x5=60." },
            { q: "M·ªôt s·ª£i d√¢y d√†i 28m ƒë∆∞·ª£c c·∫Øt th√†nh 2 ƒëo·∫°n c√≥ t·ªâ l·ªá 3/4. ƒêo·∫°n d√†i h∆°n l√†:", a: ["12m", "16m", "4m", "7m"], c: 1, h: "T·ªïng ph·∫ßn: 7. M·ªôt ph·∫ßn: 28:7=4. ƒêo·∫°n d√†i: 4x4=16m." }
        ],
        [ // CH·∫∂NG 3: V·∫¨N D·ª§NG (B√ÄI T·∫¨P TRANG 12)
            { q: "L·ªõp 5A c√≥ 35 h·ªçc sinh. S·ªë h·ªçc sinh nam b·∫±ng 3/4 s·ªë h·ªçc sinh n·ªØ. S·ªë h·ªçc sinh n·ªØ l√†:", a: ["15 b·∫°n", "20 b·∫°n", "12 b·∫°n", "23 b·∫°n"], c: 1, h: "T·ªïng ph·∫ßn: 7. M·ªôt ph·∫ßn: 35:7=5. N·ªØ chi·∫øm 4 ph·∫ßn: 5x4=20." },
            { q: "Chu vi h√¨nh ch·ªØ nh·∫≠t l√† 40cm. Chi·ªÅu r·ªông b·∫±ng 2/3 chi·ªÅu d√†i. N·ª≠a chu vi l√†:", a: ["40cm", "20cm", "10cm", "8cm"], c: 1, h: "N·ª≠a chu vi = T·ªïng chi·ªÅu d√†i + chi·ªÅu r·ªông = 40 : 2 = 20cm." },
            { q: "T·ª´ c√¢u tr√™n (T·ªïng l√† 20, t·ªâ l·ªá 2/3), chi·ªÅu d√†i h√¨nh ch·ªØ nh·∫≠t ƒë√≥ l√†:", a: ["8cm", "12cm", "10cm", "15cm"], c: 1, h: "T·ªïng ph·∫ßn: 5. M·ªôt ph·∫ßn: 20:5=4. D√†i (3 ph·∫ßn): 4x3=12cm." }
        ]
    ];

    let curLvl = -1, curQ = 0, score = 0;

    function startLvl(l) {
        curLvl = l; curQ = 0; score = 0;
        document.querySelectorAll('.lvl-btn').forEach((b, i) => b.classList.toggle('active', i === l));
        document.getElementById('quiz-area').classList.remove('hidden');
        document.getElementById('res-box').classList.add('hidden');
        show();
    }

    function show() {
        let q = data[curLvl][curQ];
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('fill').style.width = (curQ / data[curLvl].length * 100) + "%";
        document.getElementById('q-opts').innerHTML = q.a.map((o, i) => `<button class="opt-btn" onclick="check(${i})">${o}</button>`).join('');
        document.getElementById('hint-box').classList.add('hidden');
    }

    function check(i) {
        let q = data[curLvl][curQ];
        let btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);
        if(i === q.c) {
            score++; btns[i].style.background = "#c8e6c9";
            hint("Ch√≠nh x√°c! B·∫°n gi·∫£i to√°n r·∫•t t·ªët. üåü");
        } else {
            btns[i].style.background = "#ffcdd2";
            btns[q.c].style.background = "#c8e6c9";
            hint(q.h);
        }
        setTimeout(() => {
            curQ++;
            if(curQ < data[curLvl].length) show();
            else finish();
        }, 2500);
    }

    function hint(m) {
        document.getElementById('hint-box').classList.remove('hidden');
        document.getElementById('hint-text').innerText = m;
    }

    function finish() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('res-box').classList.remove('hidden');
        document.getElementById('res-score').innerText = `K·∫øt qu·∫£: ${score}/${data[curLvl].length} c√¢u ƒë√∫ng.`;
        if(score >= 2 && curLvl < 2) document.getElementById('btn-' + (curLvl + 1)).disabled = false;
    }

    function save() {
        const name = document.getElementById('p-name').value || "·∫®n danh";
        db.ref('leaderboard_tongtiso').push({ name, score, date: Date.now() });
        alert("ƒê√£ l∆∞u ƒëi·ªÉm th√†nh c√¥ng!"); location.reload();
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh√† Th√°m Hi·ªÉm T·ªâ L·ªá B·∫£n ƒê·ªì - To√°n 5</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --map-blue: #00bcd4; --success: #4CAF50; --bg: #fdfdfd; }
        body { font-family: 'Lexend', sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 750px; width: 100%; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid var(--map-blue); }
        
        .header-img { width: 100%; border-radius: 15px; height: 80px; margin-bottom: 20px; background: linear-gradient(135deg, #e0f7fa, #b2ebf2); display: flex; align-items: center; justify-content: center; border: 2px solid #EEE; }
        .header-img h2 { font-size: 1.4rem; margin: 0; color: #007c91; display: flex; align-items: center; gap: 10px; }

        .lvl-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .lvl-btn { flex: 1; padding: 10px; border: none; border-radius: 10px; background: #eee; font-weight: bold; font-family: 'Lexend'; color: #999; font-size: 0.85rem; }
        .lvl-btn.active { background: var(--map-blue); color: white; border-bottom: 3px solid #0097a7; }
        
        .question-box { background: #f9f9f9; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #eee; margin-bottom: 20px; min-height: 140px; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 0.95rem; font-family: 'Lexend'; transition: 0.2s; }
        .opt-btn:hover:not(:disabled) { border-color: var(--map-blue); background: #e0f7fa; }
        
        .robot-feedback { display: flex; align-items: center; gap: 10px; padding: 12px; background: #e8f5e9; border-radius: 12px; margin-top: 15px; border-left: 5px solid #4caf50; font-size: 0.9rem; }
        .hidden { display: none; }
        .action-btn { padding: 12px 25px; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-family: 'Lexend'; font-size: 1rem; }
        input { padding: 12px; border-radius: 10px; border: 2px solid #ddd; width: 85%; font-family: 'Lexend'; margin-bottom: 15px; font-size: 1rem; }
        footer { margin-top: 25px; text-align: center; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-img">
        <h2>üß≠ TH√ÅM HI·ªÇM B·∫¢N ƒê·ªí</h2>
    </div>

    <div class="lvl-nav">
        <button id="btn-0" class="lvl-btn active">Ch·∫∑ng 1: Kh√°m ph√°</button>
        <button id="btn-1" class="lvl-btn">Ch·∫∑ng 2: T√≠nh to√°n</button>
        <button id="btn-2" class="lvl-btn">Ch·∫∑ng 3: Th·ª±c ƒë·ªãa</button>
    </div>

    <div id="play-area">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; color: var(--map-blue);">
            <span id="q-counter">C√¢u: 1/4</span>
            <span id="score-counter">ƒêi·ªÉm: 0/12</span>
        </div>
        <div class="question-box">
            <p id="q-text" style="font-size: 1.1rem; font-weight: 500;"></p>
            <div id="options" class="option-grid"></div>
        </div>
        <div id="feedback" class="robot-feedback hidden">
            <span>üß≠ H∆∞·ªõng d·∫´n:</span> <span id="feedback-text"></span>
        </div>
    </div>

    <div id="next-lvl-screen" class="hidden" style="text-align: center; padding: 20px;">
        <h2>Chuy·∫øn ƒëi thu·∫≠n l·ª£i! üåü</h2>
        <p id="lvl-score-info" style="font-size: 1.2rem;"></p>
        <button class="action-btn" onclick="continueToNext()">ƒêi ti·∫øp Ch·∫∑ng ti·∫øp theo ‚ûî</button>
    </div>

    <div id="result-box" class="hidden" style="text-align: center; padding: 20px;">
        <h2>Chuy·∫øn th√°m hi·ªÉm k·∫øt th√∫c! üèÜ</h2>
        <p id="total-score-info" style="font-size: 1.8rem; color: var(--map-blue); font-weight: bold;"></p>
        <input type="text" id="player-name" placeholder="Nh·∫≠p t√™n Nh√† th√°m hi·ªÉm...">
        <input type="text" id="player-class" placeholder="Nh·∫≠p L·ªõp c·ªßa em (V√≠ d·ª•: 5/2)...">
        <br>
        <button class="action-btn" onclick="saveResult()">Ghi danh B·∫£ng V√†ng</button>
    </div>
</div>

<footer style="text-align: center; padding: 20px; color: #888; font-size: 0.8rem;">
    &copy; 2025 EduRobot - Ph√°t tri·ªÉn b·ªüi GV. L√™ Th√†nh Long
</footer>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const allMapData = [
        [ // Ch·∫∑ng 1: Kh√°m ph√° (8 c√¢u)
            { q: "T·ªâ l·ªá 1 : 1000 nghƒ©a l√† th·ª±c t·∫ø g·∫•p bao nhi√™u l·∫ßn b·∫£n ƒë·ªì?", a: ["10", "100", "1000", "10000"], c: 2, h: "G·∫•p 1000 l·∫ßn theo m·∫´u s·ªë t·ªâ l·ªá." },
            { q: "Tr√™n b·∫£n ƒë·ªì 1 : 500, 1cm ·ª©ng v·ªõi bao nhi√™u cm th·ª±c t·∫ø?", a: ["5", "500", "50", "5000"], c: 1, h: "1 x 500 = 500cm." },
            { q: "T·ªâ l·ªá 1 : 200 th√¨ 1cm tr√™n b·∫£n ƒë·ªì b·∫±ng m·∫•y m√©t th·ª±c t·∫ø?", a: ["200m", "20m", "2m", "0.2m"], c: 2, h: "200cm = 2m." },
            { q: "ƒê·ªô d√†i thu nh·ªè 3cm, t·ªâ l·ªá 1:100. ƒê·ªô d√†i th·∫≠t l√†:", a: ["300cm", "30cm", "3000cm", "3m"], c: 0, h: "3 x 100 = 300cm." },
            { q: "S·ªë ƒë·ª©ng tr∆∞·ªõc d·∫•u ':' trong t·ªâ l·ªá b·∫£n ƒë·ªì (th∆∞·ªùng l√† 1) ch·ªâ ƒë·∫°i l∆∞·ª£ng n√†o?", a: ["ƒê·ªô d√†i th·∫≠t", "ƒê·ªô d√†i thu nh·ªè", "M·∫´u s·ªë", "K·∫øt qu·∫£"], c: 1, h: "ƒê√≥ l√† ƒë·ªô d√†i ƒëo ƒë∆∞·ª£c tr√™n b·∫£n ƒë·ªì." },
            { q: "M·∫´u s·ªë c·ªßa t·ªâ l·ªá b·∫£n ƒë·ªì c√†ng l·ªõn th√¨ h√¨nh v·∫Ω s·∫Ω:", a: ["C√†ng l·ªõn", "C√†ng nh·ªè", "Kh√¥ng ƒë·ªïi", "C√†ng ƒë·∫≠m"], c: 1, h: "M·∫´u s·ªë l·ªõn nghƒ©a l√† v·∫≠t th·∫≠t b·ªã thu nh·ªè nhi·ªÅu l·∫ßn h∆°n." },
            { q: "T·ªâ l·ªá b·∫£n ƒë·ªì th∆∞·ªùng ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng n√†o?", a: ["S·ªë th·∫≠p ph√¢n", "H·ªón s·ªë", "Ph√¢n s·ªë c√≥ t·ª≠ s·ªë l√† 1", "S·ªë t·ª± nhi√™n"], c: 2, h: "V√≠ d·ª• 1:500 ho·∫∑c 1/500." },
            { q: "T·ªâ l·ªá 1 : 100.000, ƒë∆°n v·ªã 1cm tr√™n b·∫£n ƒë·ªì t∆∞∆°ng ·ª©ng bao nhi√™u km?", a: ["1km", "10km", "100km", "0.1km"], c: 0, h: "100.000cm = 1000m = 1km." }
        ],
        [ // Ch·∫∑ng 2: T√≠nh to√°n (8 c√¢u)
            { q: "T·ªâ l·ªá 1 : 10 000. B·∫£n ƒë·ªì d√†i 2cm. Th·ª±c t·∫ø d√†i:", a: ["200m", "20.000m", "20m", "2km"], c: 0, h: "2 x 10.000 = 20.000cm = 200m." },
            { q: "B·∫£n ƒë·ªì 1 : 2.000.000. 3cm tr√™n b·∫£n ƒë·ªì d√†i bao nhi√™u km ngo√†i ƒë·ªùi?", a: ["6km", "60km", "600km", "600m"], c: 1, h: "3 x 2.000.000 = 6.000.000cm = 60km." },
            { q: "ƒê·ªÉ t√≠nh ƒë·ªô d√†i th·∫≠t, ta l·∫•y ƒë·ªô d√†i thu nh·ªè ... v·ªõi m·∫´u s·ªë t·ªâ l·ªá:", a: ["C·ªông", "Tr·ª´", "Nh√¢n", "Chia"], c: 2, h: "S·ª≠ d·ª•ng ph√©p nh√¢n." },
            { q: "4cm tr√™n b·∫£n ƒë·ªì 1 : 50 000 l√† bao nhi√™u km th·ª±c t·∫ø?", a: ["20km", "2km", "200km", "0.2km"], c: 1, h: "4 x 50.000 = 200.000cm = 2km." },
            { q: "ƒê·ªô d√†i th·∫≠t 5km, t·ªâ l·ªá 1 : 10.000. ƒê·ªô d√†i b·∫£n ƒë·ªì l√† bao nhi√™u cm?", a: ["50cm", "5cm", "500cm", "0.5cm"], c: 0, h: "500.000 : 10.000 = 50cm." },
            { q: "Tr√™n b·∫£n ƒë·ªì 1 : 400, m·ªôt m·∫£nh v∆∞·ªùn d√†i 5cm. Chi·ªÅu d√†i th·∫≠t l√†:", a: ["200m", "20m", "2m", "2000m"], c: 1, h: "5 x 400 = 2000cm = 20m." },
            { q: "Kho·∫£ng c√°ch AB th·∫≠t l√† 12km. Tr√™n b·∫£n ƒë·ªì 1:100.000, AB d√†i bao nhi√™u cm?", a: ["1.2cm", "120cm", "12cm", "6cm"], c: 2, h: "1.200.000 : 100.000 = 12cm." },
            { q: "T·ªâ l·ªá 1 : 250, ƒë·ªô d√†i thu nh·ªè 8cm. ƒê·ªô d√†i th·∫≠t l√† bao nhi√™u m√©t?", a: ["20m", "200m", "2m", "2000m"], c: 0, h: "8 x 250 = 2000cm = 20m." }
        ],
        [ // Ch·∫∑ng 3: Th·ª±c ƒë·ªãa (8 c√¢u)
            { q: "Th·ª±c t·∫ø 50m. V·∫Ω t·ªâ l·ªá 1 : 1000 th√¨ tr√™n gi·∫•y d√†i m·∫•y cm?", a: ["50", "5", "0.5", "500"], c: 1, h: "5000 : 1000 = 5cm." },
            { q: "Ph√≤ng h·ªçc th·∫≠t d√†i 8m, v·∫Ω tr√™n gi·∫•y d√†i 4cm. T·ªâ l·ªá l√†:", a: ["1:2", "1:20", "1:200", "1:2000"], c: 2, h: "800 : 4 = 200." },
            { q: "S√¢n tr∆∞·ªùng th·∫≠t 100m. Tr√™n b·∫£n ƒë·ªì 1:2000 d√†i bao nhi√™u cm?", a: ["50", "5", "2", "10"], c: 1, h: "10000 : 2000 = 5cm." },
            { q: "T·ªâ l·ªá 1 : 1 th√¨ h√¨nh v·∫Ω s·∫Ω:", a: ["Nh·ªè ƒëi", "L·ªõn l√™n", "B·∫±ng v·∫≠t th·∫≠t", "Kh√¥ng v·∫Ω ƒë∆∞·ª£c"], c: 2, h: "K√≠ch th∆∞·ªõc th·∫≠t v√† v·∫Ω b·∫±ng nhau." },
            { q: "M·ªôt con ƒë∆∞·ªùng d√†i 1km, v·∫Ω tr√™n b·∫£n ƒë·ªì d√†i 10cm. T·ªâ l·ªá b·∫£n ƒë·ªì l√†:", a: ["1:100", "1:1000", "1:10.000", "1:100.000"], c: 2, h: "100.000 : 10 = 10.000." },
            { q: "Qu√£ng ƒë∆∞·ªùng t·ª´ nh√† ƒë·∫øn tr∆∞·ªùng l√† 2.5km. T·ªâ l·ªá 1:50.000 d√†i bao nhi√™u cm?", a: ["50cm", "5cm", "0.5cm", "25cm"], c: 1, h: "250.000 : 50.000 = 5cm." },
            { q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1:1.000.000, qu√£ng ƒë∆∞·ªùng H√† N·ªôi - H·∫£i Ph√≤ng d√†i 10cm. ƒê·ªô d√†i th·∫≠t l√†:", a: ["10km", "100km", "1000km", "1km"], c: 1, h: "10 x 1.000.000 = 10.000.000cm = 100km." },
            { q: "C·∫°nh m·ªôt s√¢n g·∫°ch vu√¥ng l√† 20m. Tr√™n b·∫£n ƒë·ªì 1:500, c·∫°nh s√¢n d√†i bao nhi√™u cm?", a: ["40cm", "4cm", "10cm", "2cm"], c: 1, h: "2000 : 500 = 4cm." }
        ]
    ];

    let curLvl = 0, curQ = 0, totalScore = 0;
    let currentPool = [];
    let startTime;

    function shuffleAndPrepare() {
        let pool = [...allMapData[curLvl]];
        pool.sort(() => Math.random() - 0.5);
        currentPool = pool.slice(0, 4);
        curQ = 0;
    }

    function show() {
        if (!startTime) startTime = Date.now();
        let q = currentPool[curQ];
        document.getElementById('q-text').innerHTML = `<b>C√¢u ${curLvl * 4 + curQ + 1}:</b> ${q.q}`;
        document.getElementById('options').innerHTML = q.a.map((opt, i) => `<button class="opt-btn" onclick="check(${i})">${opt}</button>`).join('');
        document.getElementById('feedback').classList.add('hidden');
        document.getElementById('q-counter').innerText = `C√¢u: ${curQ + 1}/4`;
        document.getElementById('score-counter').innerText = `ƒêi·ªÉm: ${totalScore}/12`;
    }

    function check(idx) {
        let q = currentPool[curQ];
        let btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);
        if(idx === q.c) {
            totalScore++;
            btns[idx].style.background = "#c8e6c9";
            showFeedback("Ch√≠nh x√°c! üß≠");
        } else {
            btns[idx].style.background = "#ffcdd2";
            btns[q.c].style.background = "#c8e6c9";
            showFeedback("G·ª£i √Ω: " + q.h);
        }
        setTimeout(() => {
            curQ++;
            if(curQ < 4) show();
            else finishStage();
        }, 2000);
    }

    function showFeedback(m) {
        document.getElementById('feedback').classList.remove('hidden');
        document.getElementById('feedback-text').innerText = m;
    }

    function finishStage() {
        document.getElementById('play-area').classList.add('hidden');
        if (curLvl < 2) {
            document.getElementById('next-lvl-screen').classList.remove('hidden');
            document.getElementById('lvl-score-info').innerText = `Xong Ch·∫∑ng ${curLvl + 1}. T·ªïng ƒëi·ªÉm: ${totalScore}/12`;
        } else {
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('total-score-info').innerText = `${totalScore} / 12 ƒêI·ªÇM`;
        }
    }

    function continueToNext() {
        curLvl++;
        shuffleAndPrepare();
        document.querySelectorAll('.lvl-btn').forEach((b, i) => b.classList.toggle('active', i === curLvl));
        document.getElementById('next-lvl-screen').classList.add('hidden');
        document.getElementById('play-area').classList.remove('hidden');
        show();
    }

    function saveResult() {
        const name = document.getElementById('player-name').value.trim();
        const className = document.getElementById('player-class').value.trim();
        if (!name || !className) { alert("Em nh·∫≠p t√™n v√† l·ªõp nh√©!"); return; }

        const durationSeconds = Math.floor((Date.now() - startTime) / 1000);
        const userKey = (className + "_" + name).replace(/[\s\/.\#\$\[\]]/g, '_');

        db.ref('scores/Ti_Le_Ban_Do/' + userKey).set({
            fullName: name,
            className: "'" + className,
            score: totalScore,
            duration: durationSeconds,
            date: new Date().toLocaleString('vi-VN'),
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            alert("ƒê√£ ghi danh B·∫£ng V√†ng th√†nh c√¥ng!");
            location.href = "index.html";
        });
    }

    window.onload = () => {
        shuffleAndPrepare();
        show();
    };
</script>
</body>
</html>
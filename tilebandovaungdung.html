<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh√† Th√°m Hi·ªÉm T·ªâ L·ªá B·∫£n ƒê·ªì - To√°n 5</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --map-blue: #00bcd4; --success: #4CAF50; --bg: #fdfdfd; }
        body { font-family: 'Lexend', sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 750px; width: 100%; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid var(--map-blue); }
        
        /* PH·∫¶N ƒê·∫¶U TRANG ƒê√É THU NH·ªé */
        .header-img { 
            width: 100%; 
            border-radius: 15px; 
            height: 80px; /* Thu nh·ªè t·ª´ 180px xu·ªëng 80px */
            margin-bottom: 20px; 
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border: 2px solid #EEE;
        }
        .header-img h2 { 
            font-size: 1.4rem; 
            margin: 0; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }

        .lvl-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .lvl-btn { flex: 1; padding: 10px; border: none; border-radius: 10px; background: #eee; font-weight: bold; font-family: 'Lexend'; color: #999; font-size: 0.85rem; }
        .lvl-btn.active { background: var(--map-blue); color: white; border-bottom: 3px solid #0097a7; }
        
        .question-box { background: #f9f9f9; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #eee; margin-bottom: 20px; min-height: 140px; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 0.95rem; font-family: 'Lexend'; transition: 0.2s; }
        .opt-btn:hover:not(:disabled) { border-color: var(--map-blue); background: #e0f7fa; }
        
        .robot-feedback { display: flex; align-items: center; gap: 10px; padding: 12px; background: #e8f5e9; border-radius: 12px; margin-top: 15px; border-left: 5px solid #4caf50; font-size: 0.9rem; }
        .hidden { display: none; }
        .action-btn { padding: 12px 25px; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-family: 'Lexend'; font-size: 1rem; }
        input { padding: 12px; border-radius: 10px; border: 2px solid #ddd; width: 85%; font-family: 'Lexend'; margin-bottom: 15px; font-size: 1rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-img">
        <h2 style="color: #007c91;">üß≠ TH√ÅM HI·ªÇM B·∫¢N ƒê·ªí</h2>
    </div>

    <div class="lvl-nav">
        <button id="btn-0" class="lvl-btn active">Ch·∫∑ng 1</button>
        <button id="btn-1" class="lvl-btn">Ch·∫∑ng 2</button>
        <button id="btn-2" class="lvl-btn">Ch·∫∑ng 3</button>
    </div>

    <div id="play-area">
        <div class="question-box">
            <p id="q-text" style="font-size: 1.1rem; font-weight: 500;"></p>
            <div id="options" class="option-grid"></div>
        </div>
        <div id="feedback" class="robot-feedback hidden">
            <span>üß≠:</span> <span id="feedback-text"></span>
        </div>
    </div>

    <div id="next-lvl-screen" class="hidden" style="text-align: center; padding: 20px;">
        <h2>V∆∞·ª£t ch·∫∑ng th√†nh c√¥ng! üéâ</h2>
        <p id="lvl-score-info" style="font-size: 1.2rem;"></p>
        <button class="action-btn" onclick="continueToNext()">ƒêi ti·∫øp Ch·∫∑ng ti·∫øp theo ‚ûî</button>
    </div>

    <div id="result-box" class="hidden" style="text-align: center; padding: 20px;">
        <h2>Chuy·∫øn th√°m hi·ªÉm k·∫øt th√∫c! üèÜ</h2>
        <p id="total-score-info" style="font-size: 1.8rem; color: var(--map-blue); font-weight: bold;"></p>
        <input type="text" id="player-name" placeholder="Nh·∫≠p t√™n Nh√† th√°m hi·ªÉm...">
        <input type="text" id="player-class" placeholder="Nh·∫≠p L·ªõp c·ªßa em (V√≠ d·ª•: 5/2)...">
        <br>
        <button class="action-btn" onclick="saveResult()">Ghi danh B·∫£ng V√†ng</button>
    </div>
</div>

<script>
    // Logic Firebase v√† Game c·ªßa b·∫°n ƒë∆∞·ª£c gi·ªØ nguy√™n
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const mapData = [
        [ // C1
            { q: "T·ªâ l·ªá 1 : 1000 nghƒ©a l√† th·ª±c t·∫ø g·∫•p bao nhi√™u l·∫ßn b·∫£n ƒë·ªì?", a: ["10", "100", "1000", "10000"], c: 2, h: "G·∫•p 1000 l·∫ßn." },
            { q: "Tr√™n b·∫£n ƒë·ªì 1 : 500, 1cm ·ª©ng v·ªõi bao nhi√™u cm th·ª±c t·∫ø?", a: ["5", "500", "50", "5000"], c: 1, h: "1 x 500 = 500cm." },
            { q: "T·ªâ l·ªá 1 : 200 th√¨ 1cm tr√™n b·∫£n ƒë·ªì b·∫±ng m·∫•y m√©t th·ª±c t·∫ø?", a: ["200m", "20m", "2m", "0.2m"], c: 2, h: "200cm = 2m." },
            { q: "ƒê·ªô d√†i thu nh·ªè 3cm, t·ªâ l·ªá 1:100. ƒê·ªô d√†i th·∫≠t l√†:", a: ["300cm", "30cm", "3000cm", "3m"], c: 0, h: "3 x 100 = 300cm." }
        ],
        [ // C2
            { q: "T·ªâ l·ªá 1 : 10 000. B·∫£n ƒë·ªì d√†i 2cm. Th·ª±c t·∫ø d√†i:", a: ["200m", "20.000m", "20m", "2km"], c: 0, h: "20.000cm = 200m." },
            { q: "B·∫£n ƒë·ªì 1 : 2 tri·ªáu. 3cm tr√™n b·∫£n ƒë·ªì d√†i bao nhi√™u ngo√†i ƒë·ªùi?", a: ["6km", "60km", "600km", "600m"], c: 1, h: "6.000.000cm = 60km." },
            { q: "T√≠nh ƒë·ªô d√†i th·∫≠t ta l·∫•y ƒë·ªô d√†i b·∫£n ƒë·ªì ... m·∫´u s·ªë t·ªâ l·ªá:", a: ["C·ªông", "Tr·ª´", "Nh√¢n", "Chia"], c: 2, h: "D√πng ph√©p nh√¢n." },
            { q: "4cm tr√™n b·∫£n ƒë·ªì 1 : 50 000 l√† bao nhi√™u km th·ª±c t·∫ø?", a: ["20km", "2km", "200km", "0.2km"], c: 1, h: "200.000cm = 2km." }
        ],
        [ // C3
            { q: "Th·ª±c t·∫ø 50m. V·∫Ω t·ªâ l·ªá 1 : 1000 th√¨ d√†i m·∫•y cm?", a: ["50", "5", "0.5", "500"], c: 1, h: "5000 : 1000 = 5cm." },
            { q: "Ph√≤ng h·ªçc 8m, v·∫Ω tr√™n gi·∫•y d√†i 4cm. T·ªâ l·ªá l√†:", a: ["1:2", "1:20", "1:200", "1:2000"], c: 2, h: "800 : 4 = 200." },
            { q: "S√¢n tr∆∞·ªùng 100m. Tr√™n b·∫£n ƒë·ªì 1:2000 d√†i bao nhi√™u cm?", a: ["50", "5", "2", "10"], c: 1, h: "10000 : 2000 = 5cm." },
            { q: "T·ªâ l·ªá 1 : 1 th√¨ h√¨nh v·∫Ω s·∫Ω:", a: ["Nh·ªè ƒëi", "L·ªõn l√™n", "B·∫±ng v·∫≠t th·∫≠t", "Kh√¥ng v·∫Ω ƒë∆∞·ª£c"], c: 2, h: "B·∫±ng v·∫≠t th·∫≠t." }
        ]
    ];

    let curLvl = 0, curQ = 0, totalScore = 0;
    let startTime; 

    function startTimer() { startTime = Date.now(); }

    function show() {
        if (!startTime) startTimer();
        let q = mapData[curLvl][curQ];
        document.getElementById('q-text').innerHTML = `<b>C√¢u ${curLvl * 4 + curQ + 1}:</b> ${q.q}`;
        document.getElementById('options').innerHTML = q.a.map((opt, i) => `<button class="opt-btn" onclick="check(${i})">${opt}</button>`).join('');
        document.getElementById('feedback').classList.add('hidden');
    }

    function check(idx) {
        let q = mapData[curLvl][curQ];
        let btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);
        if(idx === q.c) {
            totalScore++;
            btns[idx].style.background = "#c8e6c9";
            showFeedback("ƒê√∫ng r·ªìi! ‚úÖ");
        } else {
            btns[idx].style.background = "#ffcdd2";
            btns[q.c].style.background = "#c8e6c9";
            showFeedback("G·ª£i √Ω: " + q.h);
        }
        setTimeout(() => {
            curQ++;
            if(curQ < 4) show();
            else finishStage();
        }, 1800);
    }

    function showFeedback(m) {
        document.getElementById('feedback').classList.remove('hidden');
        document.getElementById('feedback-text').innerText = m;
    }

    function finishStage() {
        document.getElementById('play-area').classList.add('hidden');
        if (curLvl < 2) {
            document.getElementById('next-lvl-screen').classList.remove('hidden');
            document.getElementById('lvl-score-info').innerText = `ƒêi·ªÉm hi·ªán t·∫°i: ${totalScore}/12`;
        } else {
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('total-score-info').innerText = `${totalScore} / 12 ƒêI·ªÇM`;
        }
    }

    function continueToNext() {
        curLvl++; curQ = 0;
        document.querySelectorAll('.lvl-btn').forEach((b, i) => b.classList.toggle('active', i === curLvl));
        document.getElementById('next-lvl-screen').classList.add('hidden');
        document.getElementById('play-area').classList.remove('hidden');
        show();
    }

    function saveResult() {
        const name = document.getElementById('player-name').value.trim();
        const className = document.getElementById('player-class').value.trim();
        if (!name || !className) { alert("Em nh·∫≠p t√™n v√† l·ªõp nh√©!"); return; }

        const durationSeconds = Math.floor((Date.now() - startTime) / 1000);
        const userKey = (className + "_" + name).replace(/[\s\/.\#\$\[\]]/g, '_');

        db.ref('scores/Ti_Le_Ban_Do/' + userKey).set({
            fullName: name,
            className: "'" + className,
            score: totalScore,
            duration: durationSeconds,
            date: new Date().toLocaleString('vi-VN'),
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            alert("ƒê√£ ghi danh th√†nh c√¥ng!");
            location.href = "index.html";
        });
    }
    window.onload = show;
</script>
</body>
</html>
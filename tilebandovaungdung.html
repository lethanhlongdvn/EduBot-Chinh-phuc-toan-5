<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh√† Th√°m Hi·ªÉm T·ªâ L·ªá B·∫£n ƒê·ªì</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root { --map-blue: #00bcd4; --map-green: #8bc34a; --map-brown: #795548; --bg: #fdfdfd; }
        body { font-family: 'Lexend', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 750px; width: 100%; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid var(--map-blue); }
        
        .header-img { width: 100%; border-radius: 15px; margin-bottom: 15px; border: 2px solid #ddd; height: 250px; object-fit: cover; }
        
        .map-legend { background: #fffde7; padding: 10px; border-radius: 10px; margin-bottom: 20px; border: 1px dashed #fbc02d; font-size: 0.9rem; color: #555; }
        
        .level-nav { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .nav-btn { padding: 12px; border: none; border-radius: 10px; background: #eceff1; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .nav-btn.active { background: var(--map-blue); color: white; transform: translateY(-3px); }
        .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .question-box { background: #f9f9f9; padding: 20px; border-radius: 15px; text-align: center; min-height: 120px; margin-bottom: 20px; }
        .q-text { font-size: 1.2rem; margin-bottom: 20px; color: #263238; font-weight: 500; }
        
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { padding: 15px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .opt-btn:hover:not(:disabled) { border-color: var(--map-blue); background: #e0f7fa; }

        .robot-feedback { display: flex; align-items: center; gap: 10px; padding: 15px; background: #e8f5e9; border-radius: 12px; margin-top: 15px; border-left: 5px solid #4caf50; }
        .hidden { display: none; }
        
        /* B·∫£ng x·∫øp h·∫°ng */
        .leaderboard { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <img src="tilebandovaungdung.jpg" class="header-img" alt="T·ªâ l·ªá b·∫£n ƒë·ªì">

    <div class="map-legend">
        üìç <b>Ghi ch√∫ t·ª´ th√°m hi·ªÉm:</b> T·ªâ l·ªá 1 : 10 000 nghƒ©a l√† 1cm tr√™n b·∫£n ƒë·ªì t∆∞∆°ng ·ª©ng v·ªõi 10 000cm (hay 100m) tr√™n th·ª±c t·∫ø.
    </div>

    <div class="level-nav">
        <button id="btn-0" class="nav-btn active" onclick="startLevel(0)">1. ƒê·ªçc B·∫£n ƒê·ªì</button>
        <button id="btn-1" class="nav-btn" onclick="startLevel(1)" disabled>2. K·ªπ S∆∞ Nh√≠</button>
        <button id="btn-2" class="nav-btn" onclick="startLevel(2)" disabled>3. Th√°m Hi·ªÉm</button>
    </div>

    <div id="play-area">
        <div class="question-box">
            <p id="q-text" class="q-text">Ch√†o m·ª´ng b·∫°n! H√£y ch·ªçn ch·∫∑ng ƒë∆∞·ªùng ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
            <div id="options" class="option-grid"></div>
        </div>

        <div id="feedback" class="robot-feedback hidden">
            <span>üß≠</span> <span id="feedback-text"></span>
        </div>
    </div>

    <div id="result-box" class="hidden" style="text-align: center;">
        <h2>Chuy·∫øn ƒëi ho√†n t·∫•t!</h2>
        <p id="score-info"></p>
        <input type="text" id="player-name" placeholder="T√™n nh√† th√°m hi·ªÉm..." style="padding:10px; width:60%; border-radius:8px; border:1px solid #ccc;">
        <button onclick="saveResult()" style="padding:10px 20px; background:var(--map-blue); color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">L∆∞u t√™n v√†o B·∫£n ƒê·ªì Sao</button>
    </div>

    <div class="leaderboard">
        <h3>üèÜ Top 10 Th√°m Hi·ªÉm Cao Nh·∫•t</h3>
        <table id="lead-table">
            <thead><tr><th>H·∫°ng</th><th>T√™n</th><th>ƒêi·ªÉm</th></tr></thead>
            <tbody id="lead-body"></tbody>
        </table>
    </div>
</div>

<script>
    // 1. C·∫§U H√åNH FIREBASE (D√πng chung database c·ªßa b·∫°n)
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. D·ªÆ LI·ªÜU B√ÄI H·ªåC T·ªà L·ªÜ B·∫¢N ƒê·ªí
    const mapData = [
        [ // CH·∫∂NG 1: KH√ÅM PH√Å (ƒê·ªçc hi·ªÉu t·ªâ l·ªá)
            { q: "T·ªâ l·ªá 1 : 1000 cho bi·∫øt ƒë·ªô d√†i th·ª±c t·∫ø l·ªõn g·∫•p bao nhi√™u l·∫ßn ƒë·ªô d√†i tr√™n b·∫£n ƒë·ªì?", a: ["10 l·∫ßn", "100 l·∫ßn", "1000 l·∫ßn", "10.000 l·∫ßn"], c: 2, h: "S·ªë ƒë·ª©ng sau d·∫•u ':' l√† s·ªë l·∫ßn g·∫•p." },
            { q: "Tr√™n b·∫£n ƒë·ªì t·ªâ l·ªá 1 : 500, ƒë·ªô d√†i 1cm ·ª©ng v·ªõi th·ª±c t·∫ø l√† bao nhi√™u?", a: ["5cm", "500cm", "50cm", "5000cm"], c: 1, h: "1 x 500 = 500" },
            { q: "T·ªâ l·ªá b·∫£n ƒë·ªì th∆∞·ªùng ƒë∆∞·ª£c ghi ·ªü ƒë√¢u?", a: ["G√≥c b·∫£n ƒë·ªì", "Gi·ªØa b·∫£n ƒë·ªì", "Trong ti√™u ƒë·ªÅ", "M·∫∑t sau"], c: 0, h: "Th∆∞·ªùng ·ªü c√°c g√≥c ƒë·ªÉ ng∆∞·ªùi xem d·ªÖ th·∫•y." }
        ],
        [ // CH·∫∂NG 2: LUY·ªÜN T·∫¨P (T√≠nh ƒë·ªô d√†i th·ª±c t·∫ø)
            { q: "T·ªâ l·ªá 1 : 10 000. Kho·∫£ng c√°ch b·∫£n ƒë·ªì l√† 2cm. Kho·∫£ng c√°ch th·∫≠t l√†?", a: ["200m", "20.000m", "20m", "2km"], c: 0, h: "2 x 10.000 = 20.000cm = 200m." },
            { q: "B·∫£n ƒë·ªì 1 : 2 000 000. Qu√£ng ƒë∆∞·ªùng 3cm ·ª©ng v·ªõi th·ª±c t·∫ø l√†?", a: ["6km", "60km", "600km", "600m"], c: 1, h: "3 x 2.000.000 = 6.000.000cm = 60km." },
            { q: "ƒê·ªÉ t√≠nh ƒë·ªô d√†i th·∫≠t, ta l·∫•y ƒë·ªô d√†i b·∫£n ƒë·ªì ... v·ªõi s·ªë ƒëo t·ªâ l·ªá:", a: ["C·ªông", "Tr·ª´", "Nh√¢n", "Chia"], c: 2, h: "Mu·ªën ph√≥ng to v·ªÅ th·ª±c t·∫ø ph·∫£i d√πng ph√©p nh√¢n." }
        ],
        [ // CH·∫∂NG 3: V·∫¨N D·ª§NG (V·∫Ω b·∫£n ƒë·ªì & Th·ª±c t·∫ø)
            { q: "Kho·∫£ng c√°ch th·∫≠t l√† 50m. V·∫Ω b·∫£n ƒë·ªì t·ªâ l·ªá 1 : 1000 th√¨ d√†i bao nhi√™u cm?", a: ["50cm", "5cm", "0.5cm", "500cm"], c: 1, h: "50m = 5000cm. 5000 : 1000 = 5cm." },
            { q: "Chi·ªÅu d√†i ph√≤ng h·ªçc l√† 8m. V·∫Ω tr√™n gi·∫•y d√†i 4cm. T·ªâ l·ªá l√†?", a: ["1 : 2", "1 : 20", "1 : 200", "1 : 2000"], c: 2, h: "8m = 800cm. 800 : 4 = 200." },
            { q: "·ª®ng d·ª•ng n√†o c·∫ßn t·ªâ l·ªá b·∫£n ƒë·ªì nh·∫•t?", a: ["Ch∆°i game", "X√¢y d·ª±ng nh√†", "Xem phim", "Nghe nh·∫°c"], c: 1, h: "Ki·∫øn tr√∫c s∆∞ d√πng t·ªâ l·ªá ƒë·ªÉ v·∫Ω thi·∫øt k·∫ø nh√†." }
        ]
    ];

    let currentLvl = -1, currentQ = 0, score = 0;

    function startLevel(l) {
        currentLvl = l; currentQ = 0; score = 0;
        document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', i === l));
        document.getElementById('play-area').classList.remove('hidden');
        document.getElementById('result-box').classList.add('hidden');
        showQuestion();
    }

    function showQuestion() {
        let data = mapData[currentLvl][currentQ];
        document.getElementById('q-text').innerText = data.q;
        let html = data.a.map((opt, i) => `<button class="opt-btn" onclick="check(${i})">${opt}</button>`).join('');
        document.getElementById('options').innerHTML = html;
        document.getElementById('feedback').classList.add('hidden');
    }

    function check(idx) {
        let data = mapData[currentLvl][currentQ];
        let btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);

        if(idx === data.c) {
            score++;
            btns[idx].style.background = "#c8e6c9";
            showFeedback("L·ªánh th√°m hi·ªÉm ch√≠nh x√°c! ‚úÖ");
        } else {
            btns[idx].style.background = "#ffcdd2";
            btns[data.c].style.background = "#c8e6c9";
            showFeedback("La b√†n ch·ªâ sai r·ªìi! " + data.h);
        }

        setTimeout(() => {
            currentQ++;
            if(currentQ < mapData[currentLvl].length) showQuestion();
            else finishLvl();
        }, 2500);
    }

    function showFeedback(m) {
        document.getElementById('feedback').classList.remove('hidden');
        document.getElementById('feedback-text').innerText = m;
    }

    function finishLvl() {
        document.getElementById('play-area').classList.add('hidden');
        document.getElementById('result-box').classList.remove('hidden');
        document.getElementById('score-info').innerText = `B·∫°n ƒë√£ thu th·∫≠p ƒë∆∞·ª£c ${score}/${mapData[currentLvl].length} m·∫£nh b·∫£n ƒë·ªì!`;
        
        if(score >= 2) {
            if(currentLvl < 2) document.getElementById('btn-' + (currentLvl + 1)).disabled = false;
        }
    }

    function saveResult() {
        const name = document.getElementById('player-name').value || "Ng∆∞·ªùi l·∫°";
        db.ref('leaderboard_map').push({ name, score, date: Date.now() });
        alert("Th√¥ng tin ƒë√£ ƒë∆∞·ª£c l∆∞u!");
        location.reload();
    }

    function loadLeaderboard() {
        db.ref('leaderboard_map').orderByChild('score').limitToLast(10).on('value', snap => {
            let list = []; snap.forEach(c => { list.push(c.val()) });
            document.getElementById('lead-body').innerHTML = list.reverse().map((s, i) => 
                `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.score}</td></tr>`).join('');
        });
    }
    window.onload = loadLeaderboard;
</script>
</body>
</html>
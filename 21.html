<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si√™u c·∫•p Casio - Tu·∫ßn 21</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { 
            --primary: #34495e; --casio-body: #2c3e50; --screen-bg: #a3cb38; 
            --btn-gray: #ecf0f1; --btn-dark: #7f8c8d; --btn-orange: #f39c12; --danger: #e74c3c; 
        }

        body { 
            font-family: 'Lexend', sans-serif; margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            background: #1a252f; color: white; min-height: 100vh;
        }

        /* Th√¢n m√°y Casio */
        .casio-case {
            max-width: 650px; width: 100%; background: var(--casio-body);
            padding: 30px; border-radius: 20px 20px 60px 60px;
            box-shadow: 0 25px 0 #141a21, 0 40px 60px rgba(0,0,0,0.6);
            border: 5px solid #141a21; margin-bottom: 20px;
        }

        /* M√†n h√¨nh hi·ªÉn th·ªã */
        .screen {
            background: var(--screen-bg); border-radius: 12px; padding: 20px;
            margin-bottom: 30px; border: 8px solid #57606f;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
            min-height: 150px; color: #1e272e;
        }

        .screen-header { 
            display: flex; justify-content: space-between; 
            font-family: 'Montserrat', sans-serif; font-size: 0.75rem;
            border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; margin-bottom: 10px;
        }

        .screen-content { font-size: 1.15rem; font-weight: 600; line-height: 1.5; }

        .score-info { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: #bdc3c7; width: 100%; max-width: 650px;}

        /* L∆∞·ªõi gh√©p ƒë√¥i */
        .match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .match-column { display: flex; flex-direction: column; gap: 10px; }
        .match-item {
            background: var(--btn-gray); color: #2d3436; padding: 15px;
            border-radius: 10px; cursor: pointer; text-align: center;
            font-weight: 600; font-size: 0.95rem; border-bottom: 5px solid #bdc3c7;
            transition: all 0.2s; min-height: 60px; display: flex; align-items: center; justify-content: center;
        }
        .match-item:hover { background: #fff; transform: translateY(-2px); }
        .match-item.active { background: var(--btn-orange); color: white; border-bottom-color: #d35400; }
        .match-item.matched { opacity: 0; pointer-events: none; visibility: hidden; }

        /* N√∫t tr·∫Øc nghi·ªám */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-opt {
            background: var(--btn-gray); color: #2d3436; border: none; padding: 20px;
            border-radius: 12px; font-family: 'Lexend'; font-weight: bold; font-size: 1.05rem;
            cursor: pointer; border-bottom: 5px solid #bdc3c7; transition: 0.2s;
        }
        .btn-opt:hover { background: white; }

        .hidden { display: none; }
        .footer-edu { text-align: center; width: 100%; padding: 20px 0; color: #7f8c8d; font-size: 0.9rem; letter-spacing: 1px; }
        .btn-action { background: var(--btn-orange); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="score-info">
    <span id="stage-title">V√íNG 1: KH√ÅM PH√Å</span>
    <span id="score-text">ƒêI·ªÇM: 0/100</span>
</div>

<div class="casio-case">
    <div class="screen">
        <div class="screen-header">
            <span>CASIO fx-580VN X</span>
            <span id="hearts-count">‚ù§Ô∏è M·∫†NG: 3/3</span>
        </div>
        <div class="screen-content" id="main-display">
            Ch√†o m·ª´ng c√°c em! H√£y v∆∞·ª£t qua 10 th·ª≠ th√°ch ƒë·ªÉ tr·ªü th√†nh Si√™u c·∫•p Casio.
        </div>
    </div>

    <div id="play-area"></div>

    <div id="result-screen" class="hidden">
        <div style="text-align: center;">
            <h2 id="status-msg">K·∫æT QU·∫¢ B√ÄI THI</h2>
            <div style="font-size: 4rem; color: var(--btn-orange); margin: 10px 0;" id="score-val">0/100</div>
            <p id="sub-msg" style="color: #bdc3c7;"></p>
            
            <div id="save-form" class="hidden">
                <input type="text" id="p-name" style="width: 85%; padding: 15px; border-radius: 10px; margin-bottom: 10px;" placeholder="H·ªç v√† T√™n...">
                <input type="text" id="p-class" style="width: 85%; padding: 15px; border-radius: 10px; margin-bottom: 20px;" placeholder="L·ªõp...">
                <button class="btn-action" onclick="saveData()">GHI DANH B·∫¢NG V√ÄNG</button>
            </div>
            <button id="retry-btn" class="btn-action" style="background:#7f8c8d; margin-top:10px;" onclick="location.reload()">TH·ª¨ L·∫†I</button>
        </div>
    </div>
</div>

<div class="footer-edu">
    ¬© 2026 EduRobot - L√™ Th√†nh Long
</div>

<script>
    // C·∫•u h√¨nh Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const Q_POOL1 = [
        {q: "Mu·ªën t√¨m 60% c·ªßa 300, em t√≠nh?", a: "300 √ó 60 √∑ 100"},
        {q: "ƒê·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng m√°y t√≠nh, nh·∫•n?", a: "Ph√≠m ON/C"},
        {q: "Mu·ªën x√≥a s·ªë v·ª´a nh·∫≠p ƒë·ªÉ nh·∫≠p l·∫°i?", a: "Ph√≠m CE"},
        {q: "Ph√≠m bi·ªÉu di·ªÖn k√Ω hi·ªáu ph·∫ßn trƒÉm l√†?", a: "Ph√≠m %"},
        {q: "5% c·ªßa 780.000 c√≥ k·∫øt qu·∫£ l√†?", a: "39.000"},
        {q: "10% c·ªßa s·ªë 60 c√≥ gi√° tr·ªã l√†?", a: "S·ªë 6"},
        {q: "T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa 3 v√† 40 l√†?", a: "7,5"},
        {q: "M√°y t√≠nh gi√∫p t√≠nh to√°n th·∫ø n√†o?", a: "Nhanh v√† Ch√≠nh x√°c"}
    ];

    const Q_POOL2 = [
        {q: "70% c·ªßa 120 m¬≤ l√†:", opts: ["84 m¬≤", "70 m¬≤", "94 m¬≤", "80 m¬≤"], c: 0, h: "120 √ó 70 √∑ 100"},
        {q: "24,5% c·ªßa 2 kg l√†:", opts: ["0,5 kg", "0,49 kg", "4,9 kg", "0,24 kg"], c: 1, h: "2 √ó 24,5 √∑ 100"},
        {q: "Ba l√¥ 250.000ƒë gi·∫£m gi√° 15%. S·ªë ti·ªÅn gi·∫£m l√†:", opts: ["25.000ƒë", "30.000ƒë", "37.500ƒë", "40.000ƒë"], c: 2, h: "250.000 √ó 15 √∑ 100"},
        {q: "May 850 b·ªô ƒë·ªì, ƒë√£ xong 70%. S·ªë b·ªô ƒë√£ xong:", opts: ["595 b·ªô", "600 b·ªô", "500 b·ªô", "700 b·ªô"], c: 0, h: "850 √ó 70 √∑ 100"},
        {q: "Th·ªãt b√≤ c√≥ 18% ƒë·∫°m. 250g th·ªãt c√≥ bao nhi√™u ƒë·∫°m?", opts: ["45 g", "18 g", "50 g", "35 g"], c: 0, h: "250 √ó 18 √∑ 100"},
        {q: "ƒê·ªôi 300 ng∆∞·ªùi, 40% m·∫∑c √°o ƒë·ªè. S·ªë ng∆∞·ªùi √°o ƒë·ªè:", opts: ["100", "120", "150", "200"], c: 1, h: "300 √ó 40 √∑ 100"},
        {q: "G·ª≠i 250 tri·ªáu l√£i su·∫•t 8%/nƒÉm. Ti·ªÅn l√£i 1 nƒÉm:", opts: ["15 tri·ªáu", "20 tri·ªáu", "25 tri·ªáu", "10 tri·ªáu"], c: 1, h: "250tr √ó 8 √∑ 100"},
        {q: "K·∫øt qu·∫£ bi·ªÉu th·ª©c: 1,975 + 2,025 l√†:", opts: ["3,9", "4,0", "4,1", "4,2"], c: 1, h: "1,975 + 2,025 = 4"}
    ];

    const Q_POOL3 = [
        {q: "Ho√†n ti·ªÅn 10% cho ƒë∆°n 1.004.000ƒë. S·ªë ti·ªÅn ho√†n:", opts: ["100.000ƒë", "100.400ƒë", "10.040ƒë", "1.004ƒë"], c: 1, h: "1.004.000 √ó 10 √∑ 100"},
        {q: "Th√πng 33,2 m¬≥. H√†ng chi·∫øm 80%, th·ªÉ t√≠ch tr·ªëng l√†:", opts: ["26,56 m¬≥", "6,64 m¬≥", "7,2 m¬≥", "10 m¬≥"], c: 1, h: "Tr·ªëng 20%: 33,2 √ó 20 √∑ 100"},
        {q: "G·ª≠i 35 tri·ªáu l√£i 7,4%/nƒÉm. T·ªïng g·ªëc + l√£i 1 nƒÉm:", opts: ["37.590.000ƒë", "35.740.000ƒë", "38.000.000ƒë", "2.590.000ƒë"], c: 0, h: "L√£i 2.590.000 + G·ªëc 35.000.000"},
        {q: "B√°n 7 v√≤ng gi√° 25k/c√°i. Ban GK g√≥p 20% s·ªë ti·ªÅn ƒë√≥:", opts: ["25.000ƒë", "35.000ƒë", "40.000ƒë", "15.000ƒë"], c: 1, h: "T·ªïng 175.000 √ó 20 √∑ 100"}
    ];

    let game1, game2, game3;
    let score = 0, currentStage = 1, qIdx = 0, lives = 3;
    let selQ = null, selA = null;

    function shuffle(arr) { return arr.sort(() => 0.5 - Math.random()); }

    function initStage1() {
        game1 = shuffle([...Q_POOL1]).slice(0, 4);
        game2 = shuffle([...Q_POOL2]).slice(0, 4);
        game3 = shuffle([...Q_POOL3]).slice(0, 2);

        document.getElementById('main-display').innerText = "V√íNG 1: Gh√©p 4 c·∫∑p c√¢u h·ªèi v√† ƒë√°p √°n ƒë√∫ng. Ch√∫ √Ω: Sai 3 l·∫ßn s·∫Ω b·ªã kh√≥a b√†n ph√≠m!";
        
        let qs = game1.map((item, idx) => ({txt: item.q, id: idx}));
        let as = game1.map((item, idx) => ({txt: item.a, id: idx}));
        
        qs = shuffle(qs); as = shuffle(as);

        let html = `<div class="match-grid"><div class="match-column">`;
        qs.forEach(item => html += `<div class="match-item" id="q-${item.id}" onclick="match('q', ${item.id})">${item.txt}</div>`);
        html += `</div><div class="match-column">`;
        as.forEach(item => html += `<div class="match-item" id="a-${item.id}" onclick="match('a', ${item.id})">${item.txt}</div>`);
        html += `</div></div>`;
        
        document.getElementById('play-area').innerHTML = html;
    }

    function match(type, id) {
        if(type === 'q') {
            if(selQ !== null) document.getElementById(`q-${selQ}`).classList.remove('active');
            selQ = id; document.getElementById(`q-${id}`).classList.add('active');
        } else {
            if(selA !== null) document.getElementById(`a-${selA}`).classList.remove('active');
            selA = id; document.getElementById(`a-${id}`).classList.add('active');
        }

        if(selQ !== null && selA !== null) {
            if(selQ === selA) {
                score += 10; updateScore();
                document.getElementById(`q-${selQ}`).classList.add('matched');
                document.getElementById(`a-${selA}`).classList.add('matched');
                if(document.querySelectorAll('.match-item:not(.matched)').length === 0) setTimeout(startStage2, 800);
            } else {
                lives--; document.getElementById('hearts-count').innerText = "‚ù§Ô∏è M·∫†NG: " + lives + "/3";
                if(lives <= 0) startStage2();
                else { 
                    document.getElementById(`q-${selQ}`).classList.remove('active'); 
                    document.getElementById(`a-${selA}`).classList.remove('active'); 
                }
            }
            selQ = null; selA = null;
        }
    }

    function startStage2() {
        currentStage = 2; qIdx = 0;
        document.getElementById('stage-title').innerText = "V√íNG 2: LUY·ªÜN T·∫¨P";
        document.getElementById('hearts-count').classList.add('hidden');
        renderQ();
    }

    function renderQ() {
        let data = (currentStage === 2) ? game2 : game3;
        let item = data[qIdx];
        document.getElementById('main-display').innerHTML = `<div style="opacity:0.6; font-size:0.8rem">C√¢u h·ªèi ${qIdx+1}:</div>${item.q}`;
        let html = `<div class="options-grid">`;
        item.opts.forEach((opt, i) => html += `<button class="btn-opt" onclick="check(${i})">${opt}</button>`);
        document.getElementById('play-area').innerHTML = html + `</div>`;
    }

    function check(idx) {
        let data = (currentStage === 2) ? game2 : game3;
        if(idx === data[qIdx].c) score += 10;
        else alert("G·ª£i √Ω: " + data[qIdx].h);
        
        updateScore();
        qIdx++;
        if(qIdx < data.length) renderQ();
        else if(currentStage === 2) { 
            currentStage = 3; qIdx = 0; 
            document.getElementById('stage-title').innerText = "V√íNG 3: N√ÇNG CAO"; 
            renderQ(); 
        } else finish();
    }

    function updateScore() { document.getElementById('score-text').innerText = "ƒêI·ªÇM: " + score + "/100"; }

    function finish() {
        document.getElementById('play-area').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('score-val').innerText = score + "/100";
        if(score >= 50) {
            document.getElementById('status-msg').innerText = "üéâ CH√öC M·ª™NG SI√äU C·∫§P CASIO!";
            document.getElementById('save-form').classList.remove('hidden');
            document.getElementById('retry-btn').classList.add('hidden');
        } else {
            document.getElementById('status-msg').innerText = "‚ùå C·∫¶N C·ªê G·∫ÆNG H∆†N";
            document.getElementById('sub-msg').innerText = "H√£y luy·ªán t·∫≠p th√™m ƒë·ªÉ ƒë·∫°t √≠t nh·∫•t 50 ƒëi·ªÉm nh√©!";
        }
    }

    function saveData() {
        const name = document.getElementById('p-name').value;
        const cls = document.getElementById('p-class').value;
        if(!name || !cls) return alert("ƒêi·ªÅn ƒë·ªß th√¥ng tin em nh√©!");
        db.ref('scores/tuan21/' + Date.now()).set({ name, class: cls, score, year: 2026 })
        .then(() => { alert("ƒê√£ ghi danh B·∫£ng V√†ng!"); location.reload(); });
    }

    window.onload = initStage1;
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cán Cân Công Lý - Tuần 20</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --justice-blue: #2c3e50; --gold: #f1c40f; --marble: #ecf0f1; --law-red: #e74c3c; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; background: var(--justice-blue); color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .game-container { max-width: 750px; width: 100%; background: #34495e; padding: 30px; border-radius: 20px; border: 4px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; }
        .status-bar { display: flex; justify-content: space-between; width: 100%; max-width: 750px; color: var(--gold); font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .screen { background: var(--marble); color: var(--justice-blue); border-radius: 15px; padding: 25px; margin-bottom: 25px; min-height: 140px; text-align: center; border-bottom: 5px solid #bdc3c7; }
        .q-text { font-size: 1.25rem; line-height: 1.6; font-weight: 500; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-opt { background: #fff; border: 2px solid var(--justice-blue); padding: 15px; border-radius: 10px; font-family: 'Lexend'; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 1rem; color: var(--justice-blue); }
        .btn-opt:hover { background: var(--gold); transform: translateY(-2px); border-color: var(--gold); }
        .footer-edu { text-align: center; width: 100%; padding: 25px 0; color: #95a5a6; font-size: 0.9rem; letter-spacing: 1px; margin-top: auto; }
        #toast { position: fixed; top: 30px; padding: 15px 40px; border-radius: 50px; font-weight: bold; z-index: 1000; opacity: 0; transition: 0.3s; }
        .show-toast { opacity: 1 !important; top: 50px !important; }
        .hidden { display: none; }
        .btn-action { background: var(--law-red); color: white; padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="status-bar">
    <span id="vong-name">Vòng 1: Tìm Điểm Cân Bằng</span>
    <span id="score-val">ĐIỂM: 0</span>
</div>

<div class="game-container">
    <div id="play-zone">
        <div class="status-bar" style="color: #bdc3c7; font-size: 0.8rem;">
            <span id="q-progress">Câu hỏi: 1/4</span>
            <span id="lives">Lượt sai: 3/3</span>
        </div>
        <div class="screen">
            <div id="q-content" class="q-text">Đang thiết lập bàn cân...</div>
        </div>
        <div id="options-zone" class="options-grid"></div>
    </div>

    <div id="result-zone" class="hidden" style="text-align: center;">
        <h2 style="color: var(--gold);">CÁN CÂN HOÀN TẤT</h2>
        <h1 id="final-score" style="font-size: 4rem; margin: 20px 0;">0</h1>
        <input type="text" id="hs-name" style="width:80%; padding:15px; margin:5px; border-radius:8px;" placeholder="Tên học sinh...">
        <input type="text" id="hs-class" style="width:80%; padding:15px; margin:5px; border-radius:8px;" placeholder="Lớp...">
        <button class="btn-action" style="margin-top:15px;" onclick="saveData()">LƯU BẢNG VÀNG</button>
        <button class="btn-action" style="background:#7f8c8d; margin-top:10px;" onclick="location.reload()">CHƠI LẠI</button>
    </div>
</div>

<div class="footer-edu">
    © 2026 EduRobot - Lê Thành Long
</div>

<script>
    let score = 0;
    let life = 3;
    let currentStage = 1;
    let currentIdx = 0;
    let gameDe = [];

    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // DỮ LIỆU TUẦN 20
    const POOL_V1_V2 = [
        {q: "Sóc chị nhiều hơn sóc em 6 hạt dẻ. Tỉ số hạt dẻ em và chị là 3/5. Số hạt dẻ sóc em là:", opts: ["9 hạt", "15 hạt", "12 hạt", "6 hạt"], c: 0},
        {q: "Lớp có 40 bạn, 37 bạn đạt chuẩn bơi lội. Tỉ số phần trăm bạn đạt chuẩn là:", opts: ["37%", "92,5%", "85%", "90%"], c: 1},
        {q: "Tìm hai số có hiệu là 10 và tỉ số là 2/3. Số lớn là:", opts: ["20", "30", "15", "25"], c: 1},
        {q: "Tính tỉ số phần trăm của 18 bạn thích bóng đá trong tổng số 50 học sinh:", opts: ["18%", "36%", "40%", "25%"], c: 1},
        {q: "Hiệu số phần bằng nhau của tỉ số 3/7 là mấy phần?", opts: ["10 phần", "4 phần", "3 phần", "7 phần"], c: 1},
        {q: "Để tìm tỉ số phần trăm của 2 và 5, ta lấy 2 chia 5 bằng 0,4 rồi:", opts: ["Cộng 100", "Nhân 100 và viết %", "Chia 100", "Viết thêm %"], c: 1},
        {q: "Hiệu là 20, tỉ số là 1/5. Giá trị một phần là:", opts: ["4", "5", "10", "20"], c: 1},
        {q: "Trong đợt kiểm tra, có 9 bạn chưa đạt trên tổng 100 bạn. Tỉ số phần trăm đạt là:", opts: ["9%", "91%", "100%", "81%"], c: 1}
    ];

    const POOL_V3 = [
        {q: "Rác loại A bằng 3/7 loại B và ít hơn loại B là 8kg. Khối lượng rác loại B là:", opts: ["14 kg", "6 kg", "8 kg", "21 kg"], c: 0},
        {q: "Trong 40kg nước biển có 1,4kg muối. Tỉ số phần trăm muối là:", opts: ["35%", "3,5%", "0,35%", "1,4%"], c: 1},
        {q: "Số nam nhiều hơn nữ 10 bạn. Nữ bằng 2/3 nam. Tổng số bạn tham gia là:", opts: ["50 bạn", "30 bạn", "20 bạn", "40 bạn"], c: 0},
        {q: "Một cửa hàng lãi 20% so với giá vốn. Nếu vốn là 1 triệu, số tiền lãi là:", opts: ["20.000đ", "200.000đ", "100.000đ", "120.000đ"], c: 1}
    ];

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function initGame() {
        if(currentStage === 1) gameDe = shuffle([...POOL_V1_V2]).slice(0, 4);
        else if(currentStage === 2) gameDe = shuffle([...POOL_V1_V2]).slice(0, 4);
        else gameDe = shuffle([...POOL_V3]).slice(0, 2);
        
        currentIdx = 0;
        showQuestion();
    }

    function showQuestion() {
        const item = gameDe[currentIdx];
        document.getElementById('vong-name').innerText = `Vòng ${currentStage}: ${currentStage < 3 ? "Cân Bằng Hiệu Số" : "Công Lý Thực Tế"}`;
        document.getElementById('q-progress').innerText = `Câu hỏi: ${currentIdx + 1}/${gameDe.length}`;
        document.getElementById('q-content').innerText = item.q;
        
        let html = "";
        item.opts.forEach((o, i) => {
            html += `<button class="btn-opt" onclick="checkAnswer(${i})">${o}</button>`;
        });
        document.getElementById('options-zone').innerHTML = html;
    }

    function checkAnswer(i) {
        if(i === gameDe[currentIdx].c) {
            score += (currentStage * 10);
            toast("CHÍNH XÁC! ⚖️", "#27ae60");
        } else {
            life--;
            toast("MẤT CÂN BẰNG! ❌", "#e74c3c");
            document.getElementById('lives').innerText = `Lượt sai: ${life}/3`;
            if(life <= 0) return end();
        }
        document.getElementById('score-val').innerText = "ĐIỂM: " + score;
        setTimeout(next, 800);
    }

    function next() {
        currentIdx++;
        if(currentIdx < gameDe.length) showQuestion();
        else if(currentStage < 3) {
            currentStage++;
            initGame();
        } else end();
    }

    function toast(m, c) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.background = c; t.style.color = "#fff";
        t.classList.add('show-toast');
        setTimeout(() => t.classList.remove('show-toast'), 700);
    }

    function end() {
        document.getElementById('play-zone').classList.add('hidden');
        document.getElementById('result-zone').classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
    }

    function saveData() {
        const n = document.getElementById('hs-name').value;
        const l = document.getElementById('hs-class').value;
        if(!n || !l) return alert("Nhập đủ thông tin em nhé!");
        db.ref('ketqua/tuan20/' + Date.now()).set({ ten: n, lop: l, diem: score, nam: 2026 })
        .then(() => { alert("Đã ghi danh vào sổ công lý!"); location.reload(); });
    }

    window.onload = initGame;
</script>
</body>
</html>
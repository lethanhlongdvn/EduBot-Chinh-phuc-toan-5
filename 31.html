<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√îN T·∫¨P TU·∫¶N 31 - H·ªåC VI·ªÜN S·ªê H·ªåC</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Lexend:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #800000;
            /* Burgundy */
            --dark: #2c0000;
            --light: #f5f5dc;
            /* Beige/Parchment */
            --accent: #d4af37;
            /* Metallic Gold */
            --correct: #2e7d32;
            --wrong: #c62828;
            --bg: #1a0000;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, #2c0000 0%, #1a0000 100%);
            color: #f5f5dc;
            margin: 0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            padding-bottom: 40px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }

        .header {
            background: rgba(128, 0, 0, 0.3);
            padding: 15px;
            border-radius: 20px;
            border: 3px solid var(--accent);
            text-align: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--accent);
            text-transform: uppercase;
            font-family: 'Bungee';
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #000;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            color: #f5f5dc;
            font-weight: 600;
            padding: 10px 15px;
            margin-top: 10px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 10px;
        }

        .game-stage {
            background: #fff;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            min-height: 400px;
            position: relative;
            color: #2c0000;
            border: 1px solid var(--accent);
        }

        .stage-label {
            background: var(--primary);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-family: 'Bungee';
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9rem;
            box-shadow: 0 4px 0 #4d0000;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            min-height: 80px;
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .opt-btn {
            background: #fbf8f0;
            border: 2px solid #ddd6c1;
            padding: 18px;
            border-radius: 15px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.05rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 70px;
            box-shadow: 0 5px 0 #c4b998;
        }

        .opt-btn:hover {
            transform: translateY(-2px);
            background: #f0e6cc;
        }

        .opt-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #c4b998;
        }

        .opt-btn.correct {
            background: var(--correct);
            border-color: #1b5e20;
            color: white;
            box-shadow: 0 5px 0 #1b5e20;
        }

        .opt-btn.wrong {
            background: var(--wrong);
            border-color: #b71c1c;
            color: white;
            box-shadow: 0 5px 0 #b71c1c;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin-top: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.5s ease;
        }

        #result-screen {
            text-align: center;
            padding: 50px 20px;
            background: rgba(128, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            border: 2px solid var(--accent);
            color: var(--light);
        }

        .trophy {
            font-size: 6rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--accent));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .final-score {
            font-size: 4rem;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 3px 3px 0 #000;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        .btn-restart {
            padding: 15px 40px;
            background: var(--accent);
            border: none;
            border-radius: 50px;
            color: #000;
            font-weight: 800;
            font-family: 'Bungee';
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 6px 0 #8c7325;
            margin-top: 30px;
        }

        .game-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 0;
            text-align: center;
            font-size: 0.7rem;
            color: #aaa;
            z-index: 1000;
        }

        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .btn-start {
            background: var(--primary);
            color: white;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Bungee';
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 0 #000;
            text-transform: uppercase;
            margin-top: 20px;
            border: 2px solid var(--accent);
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #000;
            filter: brightness(1.2);
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.1rem;
            }

            .question-box {
                font-size: 1rem;
            }

            .opt-btn {
                font-size: 0.95rem;
                padding: 12px;
                min-height: 50px;
            }
        }
    </style>
</head>

<body>
    <div id="start-screen">
        <h1 style="color: var(--accent); font-size: 2rem; font-family: 'Bungee'; text-align: center;">√îN T·∫¨P TU·∫¶N 31 -
            H·ªåC VI·ªÜN S·ªê H·ªåC</h1>
        <p id="welcome-msg" style="margin-bottom: 20px; font-weight: bold; color: var(--light);"></p>
        <button class="btn-start" onclick="startGame()">B·∫ÆT ƒê·∫¶U TH√ç NGHI·ªÜM</button>
    </div>

    <div class="container hidden" id="game-ui">
        <div class="header">
            <h1>√îN T·∫¨P TU·∫¶N 31 - TO√ÅN L·ªöP 5</h1>
            <p style="margin: 5px 0; color: var(--accent); font-weight: bold; font-size: 0.85rem;">CH·ª¶ ƒê·ªÄ: S·ªê T·ª∞ NHI√äN,
                PH√ÇN S·ªê, S·ªê TH·∫¨P PH√ÇN</p>
            <div class="info-bar">
                <span>üë§ <b id="user-name">---</b></span>
                <span>üè´ <b id="user-class">---</b></span>
                <span>‚≠ê <b id="current-score" style="color:var(--accent)">0</b>/100</span>
                <span>‚è≥ <b id="timer">00:00</b></span>
            </div>
        </div>

        <div class="game-stage">
            <div id="stage-info">
                <div class="stage-label" id="stage-label">V√íNG 1: NH·∫¨N BI·∫æT</div>
                <div class="question-box" id="q-content">ƒêang chu·∫©n b·ªã c√¢u h·ªèi...</div>
            </div>

            <div id="interaction-area" class="options-grid"></div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#636e72; margin-top:8px; font-weight: 600;">Ti·∫øn ƒë·ªô:
                <span id="progress-text">0/13</span>
            </div>
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <div class="trophy">üéì</div>
        <h2>S·ª® M·ªÜNH HO√ÄN TH√ÄNH!</h2>
        <div class="final-score" id="final-score">0</div>
        <p style="font-size: 1.2rem;">Th·ªùi gian ho√†n th√†nh: <b id="final-time-text"
                style="color: var(--accent);">--:--</b></p>
        <p id="save-msg" style="color:#2ecc71; font-weight:bold; margin-top:20px;">ƒêang k·∫øt n·ªëi h·ªá th·ªëng...</p>
        <p id="redirect-msg" style="color:#aaa; font-size:0.9rem;">S·∫Ω quay l·∫°i trang ch·ªß trong gi√¢y l√°t...</p>
        <button class="btn-restart" onclick="location.reload()">CH∆†I L·∫†I</button>
    </div>

    <div class="game-footer">¬© 2026 EduBot - Chinh ph·ª•c To√°n 5 - Thi·∫øt k·∫ø b·ªüi L√™ Th√†nh Long</div>

    <script>
        const firebaseConfig = { databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const savedName = localStorage.getItem('studentName') || "Ng∆∞·ªùi ch∆°i";
        const savedClass = localStorage.getItem('studentClass') || "---";
        const savedSchool = localStorage.getItem('studentSchool') || "---";

        let isPlaying = false;
        let startTime;

        window.onload = () => {
            if (!localStorage.getItem('studentName') || !localStorage.getItem('studentClass')) {
                document.getElementById('welcome-msg').innerHTML = "<b style='color:red'>‚ö†Ô∏è Em c·∫ßn ƒëƒÉng k√Ω ·ªü b·∫£n ƒë·ªì tr∆∞·ªõc!</b>";
                document.querySelector('#start-screen .btn-start').onclick = () => window.location.href = "index.html";
            } else {
                document.getElementById('welcome-msg').innerText = `Th√≠ sinh: ${savedName} - L·ªõp ${savedClass}`;
                document.getElementById('user-name').innerText = savedName;
                document.getElementById('user-class').innerText = savedClass;
            }
        };

        function startGame() {
            isPlaying = true;
            startTime = Date.now();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            initGame();
            startTimer();
        }

        const questions = {
            r1: [
                { q: "ƒê·ªçc s·ªë t·ª± nhi√™n sau: 204 506 700", a: ["Hai trƒÉm linh b·ªën tri·ªáu nƒÉm trƒÉm linh s√°u ngh√¨n b·∫£y trƒÉm", "Hai trƒÉm b·ªën m∆∞∆°i tri·ªáu nƒÉm trƒÉm s√°u m∆∞∆°i ngh√¨n b·∫£y trƒÉm", "Hai trƒÉm linh b·ªën tri·ªáu nƒÉm m∆∞∆°i s√°u ngh√¨n b·∫£y trƒÉm", "Hai m∆∞∆°i b·ªën tri·ªáu nƒÉm trƒÉm linh s√°u ngh√¨n b·∫£y trƒÉm"], c: "Hai trƒÉm linh b·ªën tri·ªáu nƒÉm trƒÉm linh s√°u ngh√¨n b·∫£y trƒÉm" },
                { q: "Gi√° tr·ªã c·ªßa ch·ªØ s·ªë 5 trong s·ªë 153 280 l√†:", a: ["500", "5 000", "50 000", "500 000"], c: "50 000" },
                { q: "L√†m tr√≤n s·ªë 8 362 ƒë·∫øn h√†ng trƒÉm ƒë∆∞·ª£c k·∫øt qu·∫£ l√†:", a: ["8 300", "8 360", "8 400", "8 000"], c: "8 400" },
                { q: "Vi·∫øt s·ªë g·ªìm 5 tri·ªáu, 4 ngh√¨n v√† 2 ƒë∆°n v·ªã:", a: ["5 000 402", "5 004 002", "5 400 002", "5 004 020"], c: "5 004 002" },
                { q: "Vi·∫øt ba s·ªë t·ª± nhi√™n li√™n ti·∫øp bi·∫øt s·ªë l·ªõn nh·∫•t l√† 1 001:", a: ["1 001, 1 002, 1 003", "999, 1 000, 1 001", "1 000, 1 001, 1 002", "998, 999, 1 000"], c: "999, 1 000, 1 001" },
                { q: "Ph√¢n s·ªë ch·ªâ ph·∫ßn ƒë√£ t√¥ m√†u c·ªßa h√¨nh vu√¥ng chia 9 ph·∫ßn, t√¥ 4 ph·∫ßn l√†:", a: ["9/4", "4/9", "5/9", "4/5"], c: "4/9" },
                { q: "R√∫t g·ªçn ph√¢n s·ªë 18/24 v·ªÅ t·ªëi gi·∫£n:", a: ["9/12", "6/8", "3/4", "1/2"], c: "3/4" },
                { q: "M·∫´u s·ªë chung nh·ªè nh·∫•t c·ªßa 2/3 v√† 5/6 l√†:", a: ["3", "6", "12", "18"], c: "6" },
                { q: "Vi·∫øt h·ªón s·ªë ·ª©ng v·ªõi 2 h√¨nh tr√≤n nguy√™n v√† 1/2 h√¨nh tr√≤n kh√°c:", a: ["1 1/2", "2 1/2", "3 1/2", "2 2/1"], c: "2 1/2" },
                { q: "Vi·∫øt ph√¢n s·ªë 3/5 d∆∞·ªõi d·∫°ng ph√¢n s·ªë th·∫≠p ph√¢n c√≥ m·∫´u l√† 10:", a: ["3/10", "6/10", "30/10", "15/10"], c: "6/10" },
                { q: "ƒê·ªçc s·ªë th·∫≠p ph√¢n: 15,08", a: ["M∆∞·ªùi lƒÉm ph·∫©y t√°m", "M∆∞·ªùi lƒÉm ph·∫©y kh√¥ng t√°m", "M∆∞·ªùi lƒÉm ph·∫©y kh√¥ng m∆∞∆°i t√°m", "M·ªôt nƒÉm ph·∫©y kh√¥ng t√°m"], c: "M∆∞·ªùi lƒÉm ph·∫©y kh√¥ng t√°m" },
                { q: "S·ªë th·∫≠p ph√¢n 4,25 g·ªìm:", a: ["4 ƒë∆°n v·ªã v√† 25 ph·∫ßn m∆∞·ªùi", "4 ch·ª•c v√† 25 ƒë∆°n v·ªã", "4 ƒë∆°n v·ªã v√† 25 ph·∫ßn trƒÉm", "42 ƒë∆°n v·ªã v√† 5 ph·∫ßn m∆∞·ªùi"], c: "4 ƒë∆°n v·ªã v√† 25 ph·∫ßn trƒÉm" },
                { q: "So s√°nh 7,9 v√† 7,89:", a: ["7,9 < 7,89", "7,9 = 7,89", "7,9 > 7,89", "Kh√¥ng so s√°nh ƒë∆∞·ª£c"], c: "7,9 > 7,89" },
                { q: "Vi·∫øt s·ªë th·∫≠p ph√¢n th√≠ch h·ª£p: 5m 8dm = ... m", a: ["5,08 m", "5,8 m", "58 m", "0,58 m"], c: "5,8 m" },
                { q: "L√†m tr√≤n s·ªë 12,38 ƒë·∫øn h√†ng ph·∫ßn m∆∞·ªùi ƒë∆∞·ª£c:", a: ["12,3", "12,4", "12,0", "13"], c: "12,4" },
                { q: "S·ªë t·ª± nhi√™n b√© nh·∫•t l√† s·ªë n√†o?", a: ["S·ªë 1", "S·ªë 0", "Kh√¥ng c√≥", "S·ªë 0,1"], c: "S·ªë 0" },
                { q: "Vi·∫øt h·ªón s·ªë 3 v√† 1/4 th√†nh ph√¢n s·ªë:", a: ["7/4", "11/4", "13/4", "3/4"], c: "13/4" },
                { q: "Vi·∫øt ph√¢n s·ªë 21/30 d∆∞·ªõi d·∫°ng s·ªë th·∫≠p ph√¢n:", a: ["0,21", "0,3", "0,7", "0,07"], c: "0,7" },
                { q: "S·∫Øp x·∫øp 0,5; 0,45; 0,52 t·ª´ b√© ƒë·∫øn l·ªõn:", a: ["0,45; 0,52; 0,5", "0,45; 0,5; 0,52", "0,5; 0,45; 0,52", "0,52; 0,5; 0,45"], c: "0,45; 0,5; 0,52" },
                { q: "Ch·ªØ s·ªë 7 trong s·ªë 70,517 thu·ªôc c√°c h√†ng n√†o?", a: ["H√†ng ch·ª•c v√† h√†ng ph·∫ßn ngh√¨n", "H√†ng ƒë∆°n v·ªã v√† h√†ng ph·∫ßn trƒÉm", "H√†ng ch·ª•c v√† h√†ng ph·∫ßn m∆∞·ªùi", "H√†ng trƒÉm v√† h√†ng ƒë∆°n v·ªã"], c: "H√†ng ch·ª•c v√† h√†ng ph·∫ßn ngh√¨n" }
            ],
            r2: [
                { q: "T√¨m x bi·∫øt 50 000 + x + 300 + 40 + 6 = 57 346", a: ["x = 70", "x = 700", "x = 7 000", "x = 70 000"], c: "x = 7 000" },
                { q: "T√¨m s·ªë t·ª± nhi√™n l·ªõn nh·∫•t c√≥ 4 ch·ªØ s·ªë kh√°c nhau:", a: ["9999", "9876", "9786", "1234"], c: "9876" },
                { q: "N∆∞·ªõc A (98 500 000 ng∆∞·ªùi), n∆∞·ªõc B (110 200 000 ng∆∞·ªùi). N∆∞·ªõc n√†o √≠t h∆°n?", a: ["N∆∞·ªõc A", "N∆∞·ªõc B", "Hai n∆∞·ªõc b·∫±ng nhau", "Kh√¥ng r√µ"], c: "N∆∞·ªõc A" },
                { q: "T√¨m x ƒë·ªÉ x/5 = 12/20:", a: ["x = 2", "x = 3", "x = 4", "x = 5"], c: "x = 3" },
                { q: "S·∫Øp x·∫øp 71,5; 68,93; 71,09 t·ª´ l·ªõn ƒë·∫øn b√©:", a: ["71,5; 68,93; 71,09", "71,5; 71,09; 68,93", "68,93; 71,09; 71,5", "71,09; 71,5; 68,93"], c: "71,5; 71,09; 68,93" },
                { q: "T√∫i t√°o n·∫∑ng 2kg 50g vi·∫øt d∆∞·ªõi d·∫°ng s·ªë th·∫≠p ph√¢n kg l√†:", a: ["2,5 kg", "2,05 kg", "2,005 kg", "250 kg"], c: "2,05 kg" },
                { q: "Vi·∫øt ph√¢n s·ªë 6 024 / 1 000 th√†nh s·ªë th·∫≠p ph√¢n:", a: ["60,24", "6,024", "602,4", "0,6024"], c: "6,024" },
                { q: "T√¨m s·ªë t·ª± nhi√™n n sao cho 3,5 < n < 4,5:", a: ["n = 3", "n = 4", "n = 5", "n = 4,0"], c: "n = 4" },
                { q: "Ph√¢n s·ªë n√†o l·ªõn h∆°n: 15/21 hay 20/35?", a: ["15/21", "20/35", "B·∫±ng nhau", "Kh√¥ng r√µ"], c: "15/21" },
                { q: "S·∫£n l∆∞·ª£ng th√°ng 3 g·∫•p r∆∞·ª°i th√°ng 2. Th√°ng 3 b·∫±ng bao nhi√™u % th√°ng 2?", a: ["50%", "100%", "150%", "200%"], c: "150%" },
                { q: "S·ªë th·∫≠p ph√¢n g·ªìm 6 ch·ª•c, 5 ph·∫ßn m∆∞·ªùi, 7 ph·∫ßn ngh√¨n l√†:", a: ["60,57", "60,507", "6,507", "60,570"], c: "60,507" },
                { q: "T√¨m s·ªë li·ªÅn sau c·ªßa s·ªë l·ªõn nh·∫•t c√≥ s√°u ch·ªØ s·ªë kh√°c nhau (987 654):", a: ["987 653", "987 655", "999 999", "1 000 000"], c: "987 655" },
                { q: "Mai l√†m b√†i h·∫øt 1/3 gi·ªù, Lan h·∫øt 0,3 gi·ªù. Ai l√†m nhanh h∆°n?", a: ["Mai", "Lan", "B·∫±ng nhau", "Kh√¥ng r√µ"], c: "Lan" },
                { q: "Ti·ªÅn ƒëi·ªán 105 362 ƒë·ªìng, l√†m tr√≤n ƒë·∫øn h√†ng ngh√¨n ƒë·ªÉ tr·∫£ l√†:", a: ["105 400", "105 000", "106 000", "105 300"], c: "105 000" },
                { q: "Ph√¢n s·ªë l·ªõn h∆°n 1 c√≥ m·∫´u 5 v√† t·ª≠ l·∫ª b√© h∆°n 10 c√≥ th·ªÉ l√†:", a: ["3/5", "5/5", "7/5", "11/5"], c: "7/5" },
                { q: "ƒê·ªïi ƒë∆°n v·ªã: 85 ml = ... l", a: ["0,85 l", "0,085 l", "8,5 l", "0,0085 l"], c: "0,085 l" },
                { q: "T√¨m ch·ªØ s·ªë x sao cho 16,x7 < 16,17:", a: ["x = 0", "x = 1", "x = 2", "Kh√¥ng c√≥"], c: "x = 0" },
                { q: "S·ªë th·∫≠p ph√¢n n√†o b·∫±ng 9,8?", a: ["9,08", "9,80", "9,81", "0,98"], c: "9,80" },
                { q: "Vi·∫øt b·ªën s·ªë l·∫ª li√™n ti·∫øp t·ª´ 2 587:", a: ["2587, 2588, 2589, 2590", "2587, 2589, 2591, 2592", "2587, 2589, 2591, 2593", "2589, 2591, 2593, 2595"], c: "2587, 2589, 2591, 2593" },
                { q: "S·ªë th·∫≠p ph√¢n 0,25 t∆∞∆°ng ·ª©ng v·ªõi ph√¢n s·ªë t·ªëi gi·∫£n n√†o?", a: ["1/4", "1/2", "25/100", "1/5"], c: "1/4" }
            ],
            r3: [
                { q: "S·ªë t·ª± nhi√™n nh·ªè nh·∫•t c√≥ 6 ch·ªØ s·ªë kh√°c nhau t·ªïng b·∫±ng 18 l√†:", a: ["102 345", "102 348", "123 456", "100 000"], c: "102 348" },
                { q: "So s√°nh 2023/2024 v√† 2024/2025:", a: ["<", ">", "=", "Kh√¥ng so s√°nh ƒë∆∞·ª£c"], c: "<" },
                { q: "D√¢n s·ªë 98,5 tr, tƒÉng 1% m·ªói nƒÉm. L√†m tr√≤n d√¢n s·ªë nƒÉm sau ƒë·∫øn h√†ng trƒÉm ngh√¨n:", a: ["99 400 000", "99 500 000", "98 600 000", "100 000 000"], c: "99 500 000" },
                { q: "S·ªë th·∫≠p ph√¢n c√≥ 2 ch·ªØ s·ªë sau ph·∫©y, th√™m 5 v√†o b√™n tr√°i ƒë∆∞·ª£c s·ªë g·∫•p 26 l·∫ßn l√†:", a: ["0,15", "0,20", "0,25", "0,30"], c: "0,20" },
                { q: "T√¨m c√°c ph√¢n s·ªë m·∫´u 12 gi·ªØa 1/2 v√† 3/4:", a: ["5/12; 6/12", "7/12; 8/12", "9/12; 10/12", "1/12; 2/12"], c: "7/12; 8/12" },
                { q: "R√¥ b·ªët cao 1,02m v√† 0,89m. L√†m tr√≤n ƒë·∫øn h√†ng m√©t c√≥ b·∫±ng nhau kh√¥ng?", a: ["C√≥", "Kh√¥ng", "G·∫ßn b·∫±ng", "T√πy c√°ch t√≠nh"], c: "C√≥" },
                { q: "S·ªë t·ª± nhi√™n x l·ªõn nh·∫•t sao cho x < 15,99:", a: ["14", "15", "16", "0"], c: "15" },
                { q: "Ng√†y ƒë·∫ßu 1,5 km, ng√†y sau 80% ng√†y ƒë·∫ßu. Hai ng√†y s·ª≠a ƒë∆∞·ª£c:", a: ["2,5 km", "2,7 km", "3,0 km", "2,8 km"], c: "2,7 km" },
                { q: "S·∫Øp x·∫øp 3/4; 0,8; 5/8; 0,75 t·ª´ b√© ƒë·∫øn l·ªõn:", a: ["3/4; 5/8; 0,75; 0,8", "5/8; 3/4; 0,75; 0,8", "5/8; 0,75; 3/4; 0,8", "D√£y b·∫•t k·ª≥"], c: "5/8; 3/4; 0,75; 0,8" },
                { q: "D√†i g·∫•p ƒë√¥i r·ªông, r·ªông tƒÉng 5m th√¨ d√†i = 1,5 r·ªông m·ªõi. Di·ªán t√≠ch m·∫£nh ƒë·∫•t ban ƒë·∫ßu?", a: ["100 m¬≤", "150 m¬≤", "200 m¬≤", "400 m¬≤"], c: "200 m¬≤" }
            ]
        };

        let queue = [];
        let currIdx = 0;
        let score = 0;
        let timer = 0;
        let itv;

        function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

        function initGame() {
            const r1 = shuffle([...questions.r1]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 1: NH·∫¨N BI·∫æT & TH√îNG HI·ªÇU" }));
            const r2 = shuffle([...questions.r2]).slice(0, 5).map(q => ({ ...q, pts: 7, label: "V√íNG 2: V·∫¨N D·ª§NG C∆† B·∫¢N" }));
            const r3 = shuffle([...questions.r3]).slice(0, 3).map(q => ({ ...q, pts: 10, label: "V√íNG 3: V·∫¨N D·ª§NG N√ÇNG CAO" }));
            queue = [...r1, ...r2, ...r3];
            renderQ();
        }

        function renderQ() {
            if (currIdx >= queue.length) { finish(); return; }
            const q = queue[currIdx];
            document.getElementById('stage-label').innerText = q.label;
            document.getElementById('q-content').innerText = q.q;
            document.getElementById('progress-text').innerText = `${currIdx + 1}/${queue.length}`;
            document.getElementById('progress-bar').style.width = `${(currIdx / queue.length) * 100}%`;

            const area = document.getElementById('interaction-area');
            area.innerHTML = '';
            shuffle([...q.a]).forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => check(btn, opt, q.c, q.pts);
                area.appendChild(btn);
            });
        }

        function check(btn, choice, correct, pts) {
            document.querySelectorAll('.opt-btn').forEach(b => b.onclick = null);
            if (choice === correct) {
                btn.classList.add('correct');
                score += pts;
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
            }
            document.getElementById('current-score').innerText = score;
            setTimeout(() => { currIdx++; renderQ(); }, 1500);
        }

        function startTimer() {
            itv = setInterval(() => {
                timer++;
                const m = Math.floor(timer / 60).toString().padStart(2, '0');
                const s = (timer % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(523, t); osc.frequency.exponentialRampToValueAtTime(880, t + 0.1);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            } else {
                osc.type = 'square'; osc.frequency.setValueAtTime(110, t); osc.frequency.linearRampToValueAtTime(80, t + 0.2);
                g.gain.setValueAtTime(0.3, t); g.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            }
        }

        function finish() {
            clearInterval(itv);
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-time-text').innerText = document.getElementById('timer').innerText;

            db.ref('scores/Tuan_31').push({
                fullName: savedName, className: savedClass, schoolName: savedSchool,
                score: score, duration: timer, date: new Date().toLocaleString('vi-VN')
            }, () => {
                document.getElementById('save-msg').innerText = "Th√≠ nghi·ªám ho√†n t·∫•t! K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c l∆∞u.";
                let count = 5;
                const rd = document.getElementById('redirect-msg');
                const itv2 = setInterval(() => {
                    count--;
                    rd.innerText = `S·∫Ω quay l·∫°i trang ch·ªß trong ${count}s...`;
                    if (count <= 0) { clearInterval(itv2); window.location.href = "index.html"; }
                }, 1000);
            });
        }
    </script>
</body>

</html>
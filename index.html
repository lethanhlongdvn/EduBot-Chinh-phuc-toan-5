<style>
    /* CSS b·ªï sung ƒë·ªÉ kh√≥a v√≤ng v√† l√†m hi·ªáu ·ª©ng ƒë·∫πp h∆°n */
    .station.locked {
        background: #444 !important;
        border-color: #666 !important;
        color: #888 !important;
        cursor: not-allowed !important;
        filter: grayscale(1);
        opacity: 0.7;
    }
    
    .station.locked::after {
        content: 'üîí';
        position: absolute;
        font-size: 10px;
        bottom: -12px;
        left: 50%;
        transform: translateX(-50%);
    }

    /* M√†n h√¨nh ƒë·∫øm ng∆∞·ª£c chuy√™n nghi·ªáp */
    #countdown-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.95);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: white;
        text-align: center;
        padding: 20px;
    }

    .timer-box {
        font-size: 2.5rem;
        font-family: 'Bungee';
        color: var(--gold);
        margin: 20px 0;
        text-shadow: 0 0 20px rgba(255,215,0,0.5);
    }

    .btn-close-cd {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 50px;
        font-weight: bold;
        cursor: pointer;
    }
</style>

<div id="countdown-overlay">
    <h2 style="font-family:'Bungee'; color:var(--primary);">CH∆ØA ƒê·∫æN GI·ªú TH√ÅM HI·ªÇM!</h2>
    <p id="cd-msg">V√≤ng n√†y ƒëang ƒë∆∞·ª£c Robot b·∫£o v·ªá, quay l·∫°i sau nh√©!</p>
    <div class="timer-box" id="timer-display">00:00:00:00</div>
    <button class="btn-close-cd" onclick="closeCountdown()">ƒê√É HI·ªÇU</button>
</div>

<script>
    // C·∫≠p nh·∫≠t l·ªãch m·ªü v√≤ng chu·∫©n c·ªßa th·∫ßy
    const GAME_SCHEDULE = {
        19: "2026-01-16T00:00:00",
        20: "2026-01-23T00:00:00",
        21: "2026-01-30T00:00:00",
        22: "2026-02-06T00:00:00",
        23: "2026-02-23T00:00:00"
    };

    let countdownInterval;

    function handleStageClick(weekNo) {
        if (!currentStudent) { setStudentName(); return; }

        const now = new Date();
        const openTime = new Date(GAME_SCHEDULE[weekNo] || "2026-12-31T00:00:00");

        if (now >= openTime) {
            // ƒê√É M·ªû: Cho ph√©p v√†o ch∆°i
            window.location.href = weekNo + ".html";
        } else {
            // CH∆ØA M·ªû: Kh√≥a v√† hi·ªán ƒë·∫øm ng∆∞·ª£c
            showCountdown(openTime);
        }
    }

    function showCountdown(endTime) {
        const overlay = document.getElementById('countdown-overlay');
        const display = document.getElementById('timer-display');
        overlay.style.display = 'flex';

        if(countdownInterval) clearInterval(countdownInterval);

        countdownInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = endTime.getTime() - now;

            if (distance < 0) {
                clearInterval(countdownInterval);
                location.reload(); // T·ª± ƒë·ªông m·ªü kh√≥a khi h·∫øt gi·ªù
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            display.innerHTML = `${days}d : ${hours}h : ${minutes}m : ${seconds}s`;
        }, 1000);
    }

    function closeCountdown() {
        document.getElementById('countdown-overlay').style.display = 'none';
        clearInterval(countdownInterval);
    }

    function updateStationStyles() {
        const now = new Date();
        Object.keys(GAME_SCHEDULE).forEach(week => {
            const openTime = new Date(GAME_SCHEDULE[week]);
            const el = document.getElementById(`st-${week}`);
            if (el) {
                if (now < openTime) {
                    el.classList.add('locked');
                    el.title = "Ch∆∞a ƒë·∫øn ng√†y m·ªü";
                } else {
                    el.classList.remove('locked');
                }
            }
        });
    }

    // G·ªçi h√†m c·∫≠p nh·∫≠t khi t·∫£i trang
    updateStationStyles();
</script>
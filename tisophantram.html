<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot v√† H√†nh tr√¨nh T·ªâ s·ªë - To√°n 5</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root { --primary: #FF9800; --secondary: #2196F3; --success: #4CAF50; --bg: #FFFBF0; }
        body { font-family: 'Lexend', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid #FFCC80; }
        
        /* Giao di·ªán Header */
        .header-img { width: 100%; border-radius: 15px; border: 2px solid #EEE; margin-bottom: 15px; }
        .status-bar { display: flex; justify-content: space-between; font-weight: bold; color: #555; margin-bottom: 10px; }
        .progress-container { height: 10px; background: #EEE; border-radius: 5px; margin-bottom: 20px; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; border-radius: 5px; transition: 0.5s; }

        /* Ch·ªçn ch·∫∑ng ƒë∆∞·ªùng */
        .level-map { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; }
        .lvl-btn { padding: 15px 5px; border: none; border-radius: 15px; background: #F5F5F5; cursor: pointer; transition: 0.3s; font-size: 0.9rem; border-bottom: 4px solid #DDD; }
        .lvl-btn.active { background: #FFF3E0; border-color: var(--primary); color: var(--primary); font-weight: bold; }
        .lvl-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* V√πng c√¢u h·ªèi */
        .question-area { min-height: 150px; text-align: center; }
        .q-text { font-size: 1.2rem; color: #333; margin-bottom: 20px; line-height: 1.6; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt { padding: 15px; border: 2px solid #F0F0F0; border-radius: 12px; background: white; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .opt:hover:not(:disabled) { border-color: var(--secondary); background: #E3F2FD; }

        /* Robot tr·ª£ gi√∫p */
        .robot-box { display: flex; align-items: center; background: #E1F5FE; padding: 15px; border-radius: 15px; margin-top: 20px; gap: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <img src="ti-so.jpg" class="header-img" alt="H·ªçc c√πng Robot">

    <div class="level-map">
        <button id="btn-0" class="lvl-btn active" onclick="startLevel(0)">üèîÔ∏è CH·∫∂NG 1<br>Kh√°m ph√°</button>
        <button id="btn-1" class="lvl-btn" onclick="startLevel(1)" disabled>üå≤ CH·∫∂NG 2<br>Luy·ªán t·∫≠p</button>
        <button id="btn-2" class="lvl-btn" onclick="startLevel(2)" disabled>üèÜ CH·∫∂NG 3<br>V·ªÅ ƒë√≠ch</button>
    </div>

    <div class="progress-container"><div id="progress" class="progress-bar"></div></div>

    <div id="game-content">
        <div class="status-bar">
            <span id="lvl-title">S·∫µn s√†ng ch∆∞a?</span>
            <span id="score-display">ƒê√∫ng: 0/10</span>
        </div>
        
        <div class="question-area">
            <p class="q-text" id="q-text">Nh·∫•n v√†o m·ªôt ch·∫∑ng ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh!</p>
            <div class="options" id="options"></div>
        </div>

        <div id="robot-hint" class="robot-box hidden">
            <span>ü§ñ:</span> <span id="hint-text">G·ª£i √Ω t·ª´ Robot...</span>
        </div>
    </div>

    <div id="result-screen" class="hidden" style="text-align: center;">
        <h2 id="result-title">K·∫øt qu·∫£</h2>
        <p id="result-msg"></p>
        <input type="text" id="player-name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." style="padding:10px; border-radius:5px; border:1px solid #CCC; width:60%;">
        <button onclick="saveScoreOnline()" style="padding:10px 20px; background:var(--primary); color:white; border:none; border-radius:5px; margin-top:10px; cursor:pointer;">L∆∞u ƒëi·ªÉm danh d·ª±</button>
    </div>
</div>

<script>
    // 1. C·∫§U H√åNH FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
        authDomain: "gamhoctap.firebaseapp.com",
        databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gamhoctap"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. N·ªòI DUNG B√ÄI H·ªåC (T·ªîNG H·ª¢P T·ª™ SGK)
    const lessons = [
        [ // CH·∫∂NG 1: KH√ÅM PH√Å (H√¨nh th√†nh kh√°i ni·ªám)
            { q: "C√≥ 3 xe ƒëi·ªán v√† 7 xe xƒÉng. T·ªâ s·ªë c·ªßa xe ƒëi·ªán v√† xe xƒÉng l√†?", a: ["3 : 7", "7 : 3", "3 : 10", "7 : 10"], c: 0, h: "T·ªâ s·ªë c·ªßa a v√† b l√† a : b" },
            { q: "C√≥ 10 xe, 3 xe ƒëi·ªán. T·ªâ s·ªë c·ªßa xe ƒëi·ªán v√† t·ªïng s·ªë xe l√†?", a: ["3/10", "10/3", "3/7", "7/10"], c: 0, h: "L·∫•y s·ªë xe ƒëi·ªán chia cho t·ªïng s·ªë xe." },
            { q: "Vi·∫øt t·ªâ s·ªë 17/100 d∆∞·ªõi d·∫°ng ph·∫ßn trƒÉm:", a: ["1.7%", "17%", "0.17%", "170%"], c: 1, h: "M·∫´u s·ªë 100 thay b·∫±ng k√≠ hi·ªáu %" },
            { q: "T·ªâ s·ªë c·ªßa 5 v√† 8 vi·∫øt l√†?", a: ["5 : 8", "8 : 5", "5/8", "C·∫£ A v√† C"], c: 3, h: "T·ªâ s·ªë c√≥ th·ªÉ vi·∫øt d·∫°ng ph√©p chia ho·∫∑c ph√¢n s·ªë." }
        ],
        [ // CH·∫∂NG 2: LUY·ªÜN T·∫¨P (K·ªπ nƒÉng chuy·ªÉn ƒë·ªïi)
            { q: "Chuy·ªÉn ph√¢n s·ªë 2/5 th√†nh t·ªâ s·ªë ph·∫ßn trƒÉm:", a: ["20%", "40%", "50%", "25%"], c: 1, h: "ƒê∆∞a m·∫´u s·ªë v·ªÅ 100: 2/5 = 40/100" },
            { q: "S·ªë th·∫≠p ph√¢n 0,65 vi·∫øt th√†nh ph·∫ßn trƒÉm l√†?", a: ["6.5%", "0.65%", "65%", "650%"], c: 2, h: "0,65 = 65/100" },
            { q: "12% c·ªßa 100 √¥ vu√¥ng l√† bao nhi√™u √¥?", a: ["1.2 √¥", "12 √¥", "120 √¥", "10 √¥"], c: 1, h: "12% c·ªßa 100 ch√≠nh l√† 12." },
            { q: "Trong v∆∞·ªùn c√≥ 50 c√¢y, 10 c√¢y cam. T·ªâ s·ªë ph·∫ßn trƒÉm c·ªßa c√¢y cam l√†?", a: ["10%", "20%", "50%", "5%"], c: 1, h: "10/50 = 20/100" }
        ],
        [ // CH·∫∂NG 3: V·ªÄ ƒê√çCH (V·∫≠n d·ª•ng n√¢ng cao)
            { q: "L·ªõp 5A c√≥ 30 HS, 18 HS n·ªØ. T·ªâ s·ªë ph·∫ßn trƒÉm HS n·ªØ l√†?", a: ["18%", "50%", "60%", "30%"], c: 2, h: "18/30 = 6/10 = 60/100" },
            { q: "M·ªôt c·ª≠a h√†ng c√≥ 100 c√°i b√°nh, b√°n h·∫øt 75 c√°i. T·ªâ s·ªë ph·∫ßn trƒÉm b√°nh c√≤n l·∫°i l√†?", a: ["75%", "25%", "100%", "50%"], c: 1, h: "T√≠nh s·ªë b√°nh c√≤n l·∫°i r·ªìi chia cho 100." },
            { q: "C·ª© 100kg n∆∞·ªõc bi·ªÉn c√≥ 4kg mu·ªëi. T·ªâ s·ªë ph·∫ßn trƒÉm mu·ªëi l√†?", a: ["0.4%", "4%", "40%", "400%"], c: 1, h: "4/100 ·ª©ng v·ªõi bao nhi√™u %?" },
            { q: "Gi√° xƒÉng tƒÉng t·ª´ 20k l√™n 22k. S·ªë ti·ªÅn tƒÉng chi·∫øm bao nhi√™u % gi√° c≈©?", a: ["2%", "10%", "20%", "5%"], c: 1, h: "Ti·ªÅn tƒÉng l√† 2k. 2/20 = ?%" }
        ]
    ];

    let curLvl = -1, curQ = 0, curScore = 0;

    function startLevel(l) {
        curLvl = l; curQ = 0; curScore = 0;
        document.querySelectorAll('.lvl-btn').forEach((b,i)=> b.classList.toggle('active', i===l));
        document.getElementById('lvl-title').innerText = "ƒêang ·ªü: Ch·∫∑ng " + (l+1);
        document.getElementById('game-content').classList.remove('hidden');
        document.getElementById('result-screen').classList.add('hidden');
        updateScoreDisplay();
        showQuestion();
    }

    function showQuestion() {
        let q = lessons[curLvl][curQ];
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('progress').style.width = (curQ / lessons[curLvl].length * 100) + "%";
        
        let html = q.a.map((opt, i) => `<button class="opt" onclick="checkAnswer(${i})">${opt}</button>`).join('');
        document.getElementById('options').innerHTML = html;
        document.getElementById('robot-hint').classList.add('hidden');
    }

    function checkAnswer(i) {
        let q = lessons[curLvl][curQ];
        let btns = document.querySelectorAll('.opt');
        btns.forEach(b => b.disabled = true);

        if(i === q.c) {
            curScore++;
            btns[i].style.background = "#C8E6C9";
            showRobot("Ch√≠nh x√°c! B·∫°n th√¥ng minh qu√°! ‚ú®");
        } else {
            btns[i].style.background = "#FFCDD2";
            btns[q.c].style.background = "#C8E6C9";
            showRobot("G·ª£i √Ω: " + q.h);
        }

        setTimeout(() => {
            curQ++;
            if(curQ < lessons[curLvl].length) {
                showQuestion();
                updateScoreDisplay();
            } else {
                finishLevel();
            }
        }, 2000);
    }

    function updateScoreDisplay() {
        document.getElementById('score-display').innerText = `ƒê√∫ng: ${curScore}/${lessons[curLvl].length}`;
    }

    function showRobot(m) {
        document.getElementById('robot-hint').classList.remove('hidden');
        document.getElementById('hint-text').innerText = m;
    }

    function finishLevel() {
        document.getElementById('game-content').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        let p = (curScore / lessons[curLvl].length) * 100;
        document.getElementById('result-msg').innerText = `B·∫°n ƒë·∫°t ${curScore} ƒëi·ªÉm (${p}%)`;
        
        if(p >= 75 && curLvl < 2) {
            document.getElementById('btn-' + (curLvl+1)).disabled = false;
            document.getElementById('result-title').innerText = "Tuy·ªát v·ªùi! ƒê√£ m·ªü kh√≥a ch·∫∑ng ti·∫øp theo! üéâ";
        } else if (p < 75) {
            document.getElementById('result-title').innerText = "C·∫ßn c·ªë g·∫Øng th√™m ƒë·ªÉ qua ch·∫∑ng! üí™";
        }
    }

    function saveScoreOnline() {
        const name = document.getElementById('player-name').value || "Ng∆∞·ªùi ch∆°i ·∫©n danh";
        db.ref('leaderboard').push({ name, totalScore: curScore * 10, date: Date.now() });
        alert("ƒê√£ l∆∞u b·∫£ng v√†ng!");
        location.reload();
    }
</script>
</body>
</html>
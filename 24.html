<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiến trúc sư nhí - Tuần 24</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --blueprint-blue: #1a5f7a; --paper-white: #f4f4f4; --pencil-gray: #333; --draw-orange: #e67e22; }
        body { font-family: 'Lexend', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; background: var(--blueprint-blue); color: white; user-select: none; }
        .game-container { max-width: 750px; width: 100%; background: var(--paper-white); padding: 30px; border-radius: 5px; box-shadow: 10px 10px 0 rgba(0,0,0,0.2); border: 2px solid var(--pencil-gray); color: var(--pencil-gray); }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 40px; border-radius: 4px; font-weight: bold; font-size: 1.2rem; z-index: 1000; transition: 0.3s; opacity: 0; pointer-events: none; }
        .toast-show { opacity: 1 !important; top: 50px !important; }
        .screen { background: white; border: 1px dashed var(--blueprint-blue); padding: 20px; margin-bottom: 25px; min-height: 150px; position: relative; }
        .screen-header { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: bold; color: var(--blueprint-blue); border-bottom: 1px solid #ddd; padding-bottom: 8px; margin-bottom: 15px; text-transform: uppercase; }
        .q-text { font-size: 1.1rem; font-weight: 600; line-height: 1.6; }
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: white; width: 100%; max-width: 750px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { background: white; border: 2px solid var(--blueprint-blue); padding: 15px; border-radius: 4px; font-family: 'Lexend'; font-weight: bold; cursor: pointer; transition: 0.2s; color: var(--blueprint-blue); }
        .opt-btn:hover { background: var(--blueprint-blue); color: white; }
        .action-btn { background: var(--draw-orange); color: white; padding: 15px 30px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 1.1rem; box-shadow: 0 4px 0 #d35400; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="status-bar">
    <span>DỰ ÁN: KIẾN TRÚC SƯ NHÍ</span>
    <span id="score-display">TIẾN ĐỘ: 0%</span>
</div>

<div class="game-container">
    <div class="screen">
        <div class="screen-header">
            <span>BẢN VẼ CHI TIẾT - TUẦN 24</span>
            <span id="lives-count">THƯỚC ĐO: 3/3</span>
        </div>
        <div id="q-content" class="q-text">Đang tải bản thiết kế...</div>
    </div>

    <div id="play-area"></div>

    <div id="result-screen" class="hidden" style="text-align: center;">
        <h2 style="color: var(--blueprint-blue);">CÔNG TRÌNH HOÀN THÀNH</h2>
        <h1 id="final-score" style="font-size: 4rem; color: var(--draw-orange); margin: 15px 0;">0 ĐIỂM</h1>
        <div id="save-form" class="hidden">
            <input type="text" id="p-name" style="width:80%; padding:15px; margin:10px; border:1px solid #ccc;" placeholder="Tên kiến trúc sư...">
            <input type="text" id="p-class" style="width:80%; padding:15px; margin:10px; border:1px solid #ccc;" placeholder="Lớp...">
            <button class="action-btn" style="width:85%; margin-top:10px;" onclick="saveData()">LƯU BẢN VẼ</button>
        </div>
        <button class="action-btn" style="background:#95a5a6; margin-top:20px; box-shadow:0 4px 0 #7f8c8d;" onclick="location.reload()">THIẾT KẾ ĐỀ MỚI</button>
    </div>
</div>

<script>
    let isFinished = false;
    let score = 0;
    let stage = 1;
    let qIdx = 0;
    let lives = 3;

    // NGÂN HÀNG CÂU HỎI TUẦN 24 (Dựa trên tài liệu)
    const POOL1 = [
        {q: "Diện tích xung quanh của hình hộp chữ nhật là tổng diện tích của:", opts: ["2 mặt đáy", "2 mặt bên", "4 mặt bên", "6 mặt"], c: 2}, // [cite: 5, 8, 10]
        {q: "Công thức tính diện tích xung quanh hình hộp chữ nhật là:", opts: ["Chu vi đáy + chiều cao", "Diện tích đáy x chiều cao", "Chu vi đáy x chiều cao", "Dài x rộng x cao"], c: 2}, // [cite: 12, 15, 17]
        {q: "Diện tích toàn phần hình hộp chữ nhật bằng:", opts: ["Sxq + diện tích 1 mặt đáy", "Sxq + diện tích 2 mặt đáy", "Tổng diện tích các mặt bên", "Chu vi đáy x chiều cao"], c: 1}, // [cite: 19, 21, 24]
        {q: "Sxq hình lập phương bằng diện tích một mặt nhân với mấy?", opts: ["2", "4", "6", "12"], c: 1}, // [cite: 26, 28, 31]
        {q: "Stp hình lập phương bằng diện tích một mặt nhân với mấy?", opts: ["4", "5", "6", "8"], c: 2}, // [cite: 33, 36, 38]
        {q: "Đơn vị nào dùng để đo diện tích?", opts: ["cm, m", "cm³, m³", "cm², m²", "kg, g"], c: 2}, // [cite: 47, 50, 52]
        {q: "Hình hộp chữ nhật không nắp có bao nhiêu mặt cần tính diện tích toàn phần?", opts: ["6 mặt", "5 mặt", "4 mặt", "2 mặt"], c: 1}, // [cite: 54, 56, 59]
        {q: "Khi gấp cạnh hình lập phương lên 2 lần, diện tích toàn phần gấp lên mấy lần?", opts: ["2 lần", "4 lần", "6 lần", "8 lần"], c: 1} // [cite: 128, 130, 134]
    ];

    const POOL2 = [
        {q: "HHCN có dài 7cm, rộng 5cm, cao 4cm. Diện tích xung quanh là:", opts: ["96 cm²", "35 cm²", "166 cm²", "140 cm²"], c: 0}, // [cite: 63, 65, 70]
        {q: "Diện tích toàn phần của hình ở câu trên (dài 7, rộng 5, cao 4) là:", opts: ["96 cm²", "131 cm²", "166 cm²", "70 cm²"], c: 2}, // [cite: 72, 75, 78]
        {q: "Hình lập phương cạnh 12cm có diện tích xung quanh là:", opts: ["144 cm²", "576 cm²", "864 cm²", "48 cm²"], c: 1}, // [cite: 80, 82, 85]
        {q: "Diện tích toàn phần hình lập phương cạnh 1,5m là:", opts: ["9 m²", "2,25 m²", "13,5 m²", "6 m²"], c: 2}, // [cite: 87, 90, 92]
        {q: "Thùng không nắp hình lập phương cạnh 30cm có diện tích bìa là:", opts: ["3600 cm²", "4500 cm²", "5400 cm²", "900 cm²"], c: 1}, // [cite: 94, 96, 100]
        {q: "Sơn xung quanh hộp HHCN dài 2m, rộng 1m, cao 1,5m. Diện tích sơn là:", opts: ["9 m²", "13 m²", "3 m²", "6 m²"], c: 0}, // [cite: 102, 104, 108]
        {q: "Khối ru-bích cạnh 9cm có diện tích toàn phần là:", opts: ["324 cm²", "486 cm²", "81 cm²", "729 cm²"], c: 1}, // [cite: 110, 113, 116]
        {q: "Ghép 2 hình lập phương cạnh 4cm sát nhau. Stp của hình mới là:", opts: ["192 cm²", "96 cm²", "160 cm²", "128 cm²"], c: 2} // [cite: 136, 140, 144]
    ];

    // Cấu trúc Game
    let game1 = shuffle([...POOL1]).slice(0, 4);
    let game2 = shuffle([...POOL2]).slice(0, 4);

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function startStage(s) {
        stage = s; qIdx = 0;
        renderQ();
    }

    function renderQ() {
        let data = stage === 1 ? game1 : game2;
        let item = data[qIdx];
        document.getElementById('q-content').innerHTML = `<b>Câu ${qIdx+1}:</b> ${item.q}`;
        let html = '<div class="options-grid">';
        item.opts.forEach((o, i) => html += `<button class="opt-btn" onclick="check(${i})">${o}</button>`);
        html += '</div>';
        document.getElementById('play-area').innerHTML = html;
    }

    function check(idx) {
        let item = (stage === 1) ? game1[qIdx] : game2[qIdx];
        if(idx === item.c) { score += 12.5; showToast(true); } 
        else {
            showToast(false);
            if(stage === 1) { 
                lives--; document.getElementById('lives-count').innerText = "THƯỚC ĐO: "+lives+"/3";
                if(lives <= 0) { finish(); return; }
            }
        }
        updateScore();
        setTimeout(next, 1000);
    }

    function next() {
        qIdx++;
        let data = (stage === 1) ? game1 : game2;
        if(qIdx < data.length) renderQ();
        else if(stage < 2) startStage(2);
        else finish();
    }

    function updateScore() { document.getElementById('score-display').innerText = "TIẾN ĐỘ: " + (score/100*100).toFixed(0) + "%"; }

    function showToast(isCorrect) {
        const toast = document.getElementById('toast');
        toast.innerText = isCorrect ? "BẢN VẼ CHUẨN! ✅" : "SAI THÔNG SỐ! ❌";
        toast.style.background = isCorrect ? "#2ecc71" : "#e74c3c";
        toast.style.color = "white";
        toast.classList.add('toast-show');
        setTimeout(() => { toast.classList.remove('toast-show'); }, 800);
    }

    function finish() {
        isFinished = true;
        document.getElementById('play-area').innerHTML = '';
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = Math.round(score) + " ĐIỂM";
        if(score >= 50) document.getElementById('save-form').classList.remove('hidden');
    }

    window.onload = () => { startStage(1); };
</script>
</body>
</html>